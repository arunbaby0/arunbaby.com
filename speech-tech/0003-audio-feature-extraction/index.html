<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Audio Feature Extraction for Speech ML - Arun Baby</title>
<meta name="description" content="How to transform raw audio waveforms into ML-ready features that capture speech characteristics for robust model training.">


  <meta name="author" content="Arun Baby">
  
  <meta property="article:author" content="Arun Baby">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Arun Baby">
<meta property="og:title" content="Audio Feature Extraction for Speech ML">
<meta property="og:url" content="https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/">


  <meta property="og:description" content="How to transform raw audio waveforms into ML-ready features that capture speech characteristics for robust model training.">



  <meta property="og:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">



  <meta name="twitter:site" content="@arunbaby0">
  <meta name="twitter:title" content="Audio Feature Extraction for Speech ML">
  <meta name="twitter:description" content="How to transform raw audio waveforms into ML-ready features that capture speech characteristics for robust model training.">
  <meta name="twitter:url" content="https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">
    
  

  



  <meta property="article:published_time" content="2025-10-13T23:03:17+05:30">





  

  


<link rel="canonical" href="https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Arun Baby Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
           
          <span class="site-subtitle">Arun Baby</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/dsa/"
                
                
              >DSA</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ml-system-design/"
                
                
              >ML Systems</a>
            </li><li class="masthead__menu-item">
              <a
                href="/speech-tech/"
                
                
              >Speech Tech</a>
            </li><li class="masthead__menu-item">
              <a
                href="/publications/"
                
                
              >Publications</a>
            </li><li class="masthead__menu-item">
              <a
                href="/statuses/"
                
                
              >Statuses</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact/"
                
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://www.arunbaby.com/">
        <img src="/assets/images/profile-photo.png" alt="Arun Baby" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://www.arunbaby.com/" itemprop="url">Arun Baby</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Becoming <strong>Unlabelable</strong></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">India</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i><span class="label">Google Scholar</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Audio Feature Extraction for Speech ML">
    <meta itemprop="description" content="How to transform raw audio waveforms into ML-ready features that capture speech characteristics for robust model training.">
    <meta itemprop="datePublished" content="2025-10-13T23:03:17+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/" itemprop="url">Audio Feature Extraction for Speech ML
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          29 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#problem-definition">Problem Definition</a><ul><li><a href="#functional-requirements">Functional Requirements</a></li><li><a href="#non-functional-requirements">Non-Functional Requirements</a></li></ul></li><li><a href="#audio-basics">Audio Basics</a><ul><li><a href="#waveform-representation">Waveform Representation</a></li></ul></li><li><a href="#feature-1-mel-frequency-cepstral-coefficients-mfccs">Feature 1: Mel-Frequency Cepstral Coefficients (MFCCs)</a><ul><li><a href="#why-mfccs">Why MFCCs?</a></li><li><a href="#how-mfccs-work">How MFCCs Work</a></li><li><a href="#implementation">Implementation</a></li><li><a href="#visualizing-mfccs">Visualizing MFCCs</a></li></ul></li><li><a href="#feature-2-mel-spectrograms">Feature 2: Mel-Spectrograms</a><ul><li><a href="#what-is-a-spectrogram">What is a Spectrogram?</a></li><li><a href="#mel-spectrogram-vs-mfcc">Mel-Spectrogram vs MFCC</a></li><li><a href="#implementation-1">Implementation</a></li><li><a href="#visualizing-mel-spectrogram">Visualizing Mel-Spectrogram</a></li></ul></li><li><a href="#feature-3-raw-spectrograms-stft">Feature 3: Raw Spectrograms (STFT)</a><ul><li><a href="#implementation-2">Implementation</a></li></ul></li><li><a href="#feature-4-time-domain-features">Feature 4: Time-Domain Features</a><ul><li><a href="#implementation-3">Implementation</a></li></ul></li><li><a href="#feature-5-pitch--formants">Feature 5: Pitch &amp; Formants</a><ul><li><a href="#pitch-extraction">Pitch Extraction</a></li></ul></li><li><a href="#production-feature-pipeline">Production Feature Pipeline</a><ul><li><a href="#unified-feature-extractor">Unified Feature Extractor</a></li></ul></li><li><a href="#handling-variable-length-audio">Handling Variable-Length Audio</a><ul><li><a href="#strategy-1-paddingtruncation">Strategy 1: Padding/Truncation</a></li><li><a href="#strategy-2-temporal-pooling">Strategy 2: Temporal Pooling</a></li></ul></li><li><a href="#real-time-feature-extraction">Real-Time Feature Extraction</a><ul><li><a href="#streaming-feature-extractor">Streaming Feature Extractor</a></li></ul></li><li><a href="#performance-optimization">Performance Optimization</a><ul><li><a href="#1-caching-features">1. Caching Features</a></li><li><a href="#2-parallel-processing">2. Parallel Processing</a></li></ul></li><li><a href="#advanced-feature-types">Advanced Feature Types</a><ul><li><a href="#1-learned-features-embeddings">1. Learned Features (Embeddings)</a></li><li><a href="#2-filter-bank-features-fbank">2. Filter Bank Features (FBank)</a></li><li><a href="#3-prosodic-features">3. Prosodic Features</a></li></ul></li><li><a href="#feature-quality--validation">Feature Quality &amp; Validation</a><ul><li><a href="#feature-quality-metrics">Feature Quality Metrics</a></li></ul></li><li><a href="#connection-to-data-preprocessing-pipeline">Connection to Data Preprocessing Pipeline</a><ul><li><a href="#parallel-concepts">Parallel Concepts</a></li><li><a href="#unified-preprocessing-framework">Unified Preprocessing Framework</a></li></ul></li><li><a href="#production-best-practices">Production Best Practices</a><ul><li><a href="#1-feature-versioning">1. Feature Versioning</a></li><li><a href="#2-error-handling">2. Error Handling</a></li><li><a href="#3-monitoring-feature-quality">3. Monitoring Feature Quality</a></li></ul></li><li><a href="#data-augmentation-in-feature-space">Data Augmentation in Feature Space</a><ul><li><a href="#specaugment">SpecAugment</a></li></ul></li><li><a href="#batch-feature-extraction-for-training">Batch Feature Extraction for Training</a><ul><li><a href="#batch-extraction-pipeline">Batch Extraction Pipeline</a></li></ul></li><li><a href="#real-world-systems">Real-World Systems</a><ul><li><a href="#kaldi-traditional-asr-feature-pipeline">Kaldi: Traditional ASR Feature Pipeline</a></li><li><a href="#pytorch-modern-deep-learning-pipeline">PyTorch: Modern Deep Learning Pipeline</a></li><li><a href="#google-production-asr-feature-extraction">Google: Production ASR Feature Extraction</a></li></ul></li><li><a href="#choosing-the-right-features">Choosing the Right Features</a><ul><li><a href="#feature-selection-guide">Feature Selection Guide</a></li><li><a href="#combining-features">Combining Features</a></li></ul></li><li><a href="#key-takeaways">Key Takeaways</a></li></ul>
            </nav>
          </aside>
        
        <p><strong>How to transform raw audio waveforms into ML-ready features that capture speech characteristics for robust model training.</strong></p>

<h2 id="introduction">Introduction</h2>

<p>Raw audio waveforms are high-dimensional, noisy, and difficult for ML models to learn from directly. <strong>Feature extraction</strong> transforms audio into compact, informative representations that:</p>

<ul>
  <li>Capture important speech characteristics</li>
  <li>Reduce dimensionality (16kHz audio = 16,000 samples/sec → ~40 features)</li>
  <li>Provide invariance to irrelevant variations (volume, recording device)</li>
  <li>Enable efficient model training</li>
</ul>

<p><strong>Why it matters:</strong></p>
<ul>
  <li><strong>Improves accuracy:</strong> Good features → better models</li>
  <li><strong>Reduces compute:</strong> Lower dimensionality = faster training/inference</li>
  <li><strong>Enables transfer learning:</strong> Pre-extracted features work across tasks</li>
  <li><strong>Production efficiency:</strong> Feature extraction can be cached</li>
</ul>

<p><strong>What you’ll learn:</strong></p>
<ul>
  <li>Core audio features (MFCCs, spectrograms, mel-scale)</li>
  <li>Time-domain vs frequency-domain features</li>
  <li>Production-grade extraction pipelines</li>
  <li>Optimization for real-time processing</li>
  <li>Feature engineering for speech tasks</li>
</ul>

<hr />

<h2 id="problem-definition">Problem Definition</h2>

<p>Design a feature extraction pipeline for speech ML systems.</p>

<h3 id="functional-requirements">Functional Requirements</h3>

<ol>
  <li><strong>Feature Types</strong>
    <ul>
      <li>Time-domain features (energy, zero-crossing rate)</li>
      <li>Frequency-domain features (spectrograms, MFCCs)</li>
      <li>Temporal features (deltas, delta-deltas)</li>
      <li>Learned features (embeddings)</li>
    </ul>
  </li>
  <li><strong>Input Handling</strong>
    <ul>
      <li>Support multiple sample rates (8kHz, 16kHz, 48kHz)</li>
      <li>Handle variable-length audio</li>
      <li>Process both mono and stereo</li>
      <li>Support batch processing</li>
    </ul>
  </li>
  <li><strong>Output Format</strong>
    <ul>
      <li>Fixed-size feature vectors</li>
      <li>Variable-length sequences</li>
      <li>2D/3D tensors for neural networks</li>
    </ul>
  </li>
</ol>

<h3 id="non-functional-requirements">Non-Functional Requirements</h3>

<ol>
  <li><strong>Performance</strong>
    <ul>
      <li>Real-time: Extract features &lt; 10ms for 1 sec audio</li>
      <li>Batch: Process 10K files/hour on single machine</li>
      <li>Memory: &lt; 100MB RAM for streaming</li>
    </ul>
  </li>
  <li><strong>Quality</strong>
    <ul>
      <li>Robust to noise</li>
      <li>Consistent across devices</li>
      <li>Reproducible (deterministic)</li>
    </ul>
  </li>
  <li><strong>Flexibility</strong>
    <ul>
      <li>Configurable parameters</li>
      <li>Support multiple backends (librosa, torchaudio)</li>
      <li>Easy to extend with new features</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="audio-basics">Audio Basics</h2>

<h3 id="waveform-representation">Waveform Representation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">librosa</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Load audio
</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">speech.wav</span><span class="sh">'</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Sample rate: </span><span class="si">{</span><span class="n">sr</span><span class="si">}</span><span class="s"> Hz</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Duration: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="o">/</span> <span class="n">sr</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Shape: </span><span class="si">{</span><span class="n">audio</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Range: [</span><span class="si">{</span><span class="n">audio</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">audio</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Visualize waveform
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">))</span> <span class="o">/</span> <span class="n">sr</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">audio</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time (s)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Amplitude</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Audio Waveform</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Key properties:</strong></p>
<ul>
  <li><strong>Sample rate (sr):</strong> Samples per second (e.g., 16000 Hz = 16000 samples/sec)</li>
  <li><strong>Duration:</strong> <code class="language-plaintext highlighter-rouge">len(audio) / sr</code> seconds</li>
  <li><strong>Amplitude:</strong> Typically normalized to [-1, 1]</li>
</ul>

<hr />

<h2 id="feature-1-mel-frequency-cepstral-coefficients-mfccs">Feature 1: Mel-Frequency Cepstral Coefficients (MFCCs)</h2>

<p><strong>MFCCs</strong> are the most widely used features in speech recognition.</p>

<h3 id="why-mfccs">Why MFCCs?</h3>

<ol>
  <li><strong>Mimic human hearing:</strong> Use mel scale (perceptual frequency scale)</li>
  <li><strong>Compact:</strong> Represent spectral envelope with 13-40 coefficients</li>
  <li><strong>Robust:</strong> Less sensitive to pitch variations</li>
  <li><strong>Proven:</strong> Gold standard for ASR for decades</li>
</ol>

<h3 id="how-mfccs-work">How MFCCs Work</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Audio Waveform
    ↓
1. Pre-emphasis (boost high frequencies)
    ↓
2. Frame the signal (25ms windows, 10ms hop)
    ↓
3. Apply window function (Hamming)
    ↓
4. FFT (Fast Fourier Transform)
    ↓
5. Mel filterbank (map to mel scale)
    ↓
6. Log (compress dynamic range)
    ↓
7. DCT (Discrete Cosine Transform)
    ↓
MFCCs (13-40 coefficients per frame)
</code></pre></div></div>

<h3 id="implementation">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">librosa</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">MFCCExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract MFCC features from audio
    
    Standard configuration for speech recognition
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
        <span class="n">n_mfcc</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>  <span class="c1"># 10ms at 16kHz
</span>        <span class="n">n_mels</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">fmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">fmax</span><span class="o">=</span><span class="mi">8000</span>
    <span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mfcc</span> <span class="o">=</span> <span class="n">n_mfcc</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mels</span> <span class="o">=</span> <span class="n">n_mels</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract MFCCs
        
        Args:
            audio: Audio waveform (1D array)
        
        Returns:
            MFCCs: (n_mfcc, time_steps)
        </span><span class="sh">"""</span>
        <span class="c1"># Extract MFCCs
</span>        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">mfcc</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_mfcc</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_mfcc</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">n_mels</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_mels</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmin</span><span class="p">,</span>
            <span class="n">fmax</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmax</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">mfccs</span>  <span class="c1"># Shape: (n_mfcc, time)
</span>    
    <span class="k">def</span> <span class="nf">extract_with_deltas</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract MFCCs + deltas + delta-deltas
        
        Deltas capture temporal dynamics
        
        Returns:
            Features: (n_mfcc * 3, time_steps)
        </span><span class="sh">"""</span>
        <span class="c1"># MFCCs
</span>        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Delta (first derivative)
</span>        <span class="n">delta</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">delta</span><span class="p">(</span><span class="n">mfccs</span><span class="p">)</span>
        
        <span class="c1"># Delta-delta (second derivative)
</span>        <span class="n">delta2</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">delta</span><span class="p">(</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Stack
</span>        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">([</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">delta2</span><span class="p">])</span>  <span class="c1"># (120, time)
</span>        
        <span class="k">return</span> <span class="n">features</span>

<span class="c1"># Usage
</span><span class="n">extractor</span> <span class="o">=</span> <span class="nc">MFCCExtractor</span><span class="p">()</span>
<span class="n">mfccs</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">MFCCs shape: </span><span class="si">{</span><span class="n">mfccs</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (40, time_steps)
</span>
<span class="c1"># With deltas
</span><span class="n">features</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">.</span><span class="nf">extract_with_deltas</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">MFCCs+deltas shape: </span><span class="si">{</span><span class="n">features</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (120, time_steps)
</span></code></pre></div></div>

<h3 id="visualizing-mfccs">Visualizing MFCCs</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">plot_mfccs</span><span class="p">(</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Visualize MFCC features</span><span class="sh">"""</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Convert frame indices to time
</span>    <span class="n">times</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">frames_to_time</span><span class="p">(</span>
        <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">mfccs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span>
    <span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span>
        <span class="n">mfccs</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="sh">'</span><span class="s">lower</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mfccs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="sh">'</span><span class="s">%+2.0f dB</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time (s)</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">MFCC Coefficient</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">MFCC Features</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">plot_mfccs</span><span class="p">(</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="feature-2-mel-spectrograms">Feature 2: Mel-Spectrograms</h2>

<p><strong>Mel-spectrograms</strong> preserve more temporal detail than MFCCs.</p>

<h3 id="what-is-a-spectrogram">What is a Spectrogram?</h3>

<p>A <strong>spectrogram</strong> shows how the frequency content of a signal changes over time.</p>

<ul>
  <li><strong>X-axis:</strong> Time</li>
  <li><strong>Y-axis:</strong> Frequency</li>
  <li><strong>Color:</strong> Magnitude (energy)</li>
</ul>

<h3 id="mel-spectrogram-vs-mfcc">Mel-Spectrogram vs MFCC</h3>

<table>
  <thead>
    <tr>
      <th>Aspect</th>
      <th>Mel-Spectrogram</th>
      <th>MFCC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Dimensions</td>
      <td>(n_mels, time)</td>
      <td>(n_mfcc, time)</td>
    </tr>
    <tr>
      <td>Information</td>
      <td>Full spectrum</td>
      <td>Spectral envelope</td>
    </tr>
    <tr>
      <td>Size</td>
      <td>40-128 bins</td>
      <td>13-40 coefficients</td>
    </tr>
    <tr>
      <td>Use case</td>
      <td>CNNs, deep learning</td>
      <td>Traditional ASR</td>
    </tr>
    <tr>
      <td>Temporal resolution</td>
      <td>Higher</td>
      <td>Lower (due to DCT)</td>
    </tr>
  </tbody>
</table>

<h3 id="implementation-1">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MelSpectrogramExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract log mel-spectrogram features
    
    Popular for deep learning models (CNNs, Transformers)
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
        <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>
        <span class="n">n_mels</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
        <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">fmax</span><span class="o">=</span><span class="mi">8000</span>
    <span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mels</span> <span class="o">=</span> <span class="n">n_mels</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract log mel-spectrogram
        
        Returns:
            Log mel-spectrogram: (n_mels, time_steps)
        </span><span class="sh">"""</span>
        <span class="c1"># Compute mel spectrogram
</span>        <span class="n">mel_spec</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">melspectrogram</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">n_mels</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_mels</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmin</span><span class="p">,</span>
            <span class="n">fmax</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmax</span>
        <span class="p">)</span>
        
        <span class="c1"># Convert to log scale (dB)
</span>        <span class="n">log_mel</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">power_to_db</span><span class="p">(</span><span class="n">mel_spec</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">log_mel</span>  <span class="c1"># Shape: (n_mels, time)
</span>    
    <span class="k">def</span> <span class="nf">extract_normalized</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract and normalize to [0, 1]
        
        Better for neural networks
        </span><span class="sh">"""</span>
        <span class="n">log_mel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Normalize to [0, 1]
</span>        <span class="n">log_mel_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">log_mel</span> <span class="o">-</span> <span class="n">log_mel</span><span class="p">.</span><span class="nf">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">log_mel</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">log_mel</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">log_mel_norm</span>

<span class="c1"># Usage
</span><span class="n">mel_extractor</span> <span class="o">=</span> <span class="nc">MelSpectrogramExtractor</span><span class="p">(</span><span class="n">n_mels</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">mel_spec</span> <span class="o">=</span> <span class="n">mel_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Mel-spectrogram shape: </span><span class="si">{</span><span class="n">mel_spec</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (80, time_steps)
</span></code></pre></div></div>

<h3 id="visualizing-mel-spectrogram">Visualizing Mel-Spectrogram</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_mel_spectrogram</span><span class="p">(</span><span class="n">mel_spec</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Visualize mel-spectrogram</span><span class="sh">"""</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="n">librosa</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">specshow</span><span class="p">(</span>
        <span class="n">mel_spec</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
        <span class="n">x_axis</span><span class="o">=</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">y_axis</span><span class="o">=</span><span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="sh">'</span><span class="s">%+2.0f dB</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Mel-Spectrogram</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">plot_mel_spectrogram</span><span class="p">(</span><span class="n">mel_spec</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="feature-3-raw-spectrograms-stft">Feature 3: Raw Spectrograms (STFT)</h2>

<p><strong>Short-Time Fourier Transform (STFT)</strong> provides the highest frequency resolution.</p>

<h3 id="implementation-2">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">STFTExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract raw STFT features
    
    Used when you need full frequency resolution
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>
        <span class="n">win_length</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">win_length</span> <span class="o">=</span> <span class="n">win_length</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract magnitude spectrogram
        
        Returns:
            Spectrogram: (n_fft//2 + 1, time_steps)
        </span><span class="sh">"""</span>
        <span class="c1"># Compute STFT
</span>        <span class="n">stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">win_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">win_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Get magnitude
</span>        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">stft</span><span class="p">)</span>
        
        <span class="c1"># Convert to dB
</span>        <span class="n">magnitude_db</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">amplitude_to_db</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">magnitude_db</span>  <span class="c1"># Shape: (n_fft//2 + 1, time)
</span>    
    <span class="k">def</span> <span class="nf">extract_with_phase</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract magnitude and phase
        
        Phase information useful for reconstruction
        </span><span class="sh">"""</span>
        <span class="n">stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">win_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">win_length</span>
        <span class="p">)</span>
        
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">stft</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">angle</span><span class="p">(</span><span class="n">stft</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span>

<span class="c1"># Usage
</span><span class="n">stft_extractor</span> <span class="o">=</span> <span class="nc">STFTExtractor</span><span class="p">()</span>
<span class="n">spectrogram</span> <span class="o">=</span> <span class="n">stft_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Spectrogram shape: </span><span class="si">{</span><span class="n">spectrogram</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (257, time_steps)
</span></code></pre></div></div>

<hr />

<h2 id="feature-4-time-domain-features">Feature 4: Time-Domain Features</h2>

<p>Simple but effective features computed directly from waveform.</p>

<h3 id="implementation-3">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TimeDomainExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract time-domain features
    
    Fast to compute, useful for simple tasks
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">extract_energy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frame_length</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Frame-wise energy (RMS)
        
        Captures loudness/volume over time
        </span><span class="sh">"""</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">rms</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
            <span class="n">frame_length</span><span class="o">=</span><span class="n">frame_length</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">energy</span>
    
    <span class="k">def</span> <span class="nf">extract_zero_crossing_rate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frame_length</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Zero-crossing rate
        
        Measures how often signal crosses zero
        High ZCR → noisy/unvoiced
        Low ZCR → tonal/voiced
        </span><span class="sh">"""</span>
        <span class="n">zcr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">zero_crossing_rate</span><span class="p">(</span>
            <span class="n">audio</span><span class="p">,</span>
            <span class="n">frame_length</span><span class="o">=</span><span class="n">frame_length</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">zcr</span>
    
    <span class="k">def</span> <span class="nf">extract_all</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Extract all time-domain features</span><span class="sh">"""</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_energy</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        <span class="n">zcr</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_zero_crossing_rate</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Stack features
</span>        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">([</span><span class="n">energy</span><span class="p">,</span> <span class="n">zcr</span><span class="p">])</span>  <span class="c1"># (2, time)
</span>        
        <span class="k">return</span> <span class="n">features</span>

<span class="c1"># Usage
</span><span class="n">time_extractor</span> <span class="o">=</span> <span class="nc">TimeDomainExtractor</span><span class="p">()</span>
<span class="n">time_features</span> <span class="o">=</span> <span class="n">time_extractor</span><span class="p">.</span><span class="nf">extract_all</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Time-domain features shape: </span><span class="si">{</span><span class="n">time_features</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (2, time_steps)
</span></code></pre></div></div>

<hr />

<h2 id="feature-5-pitch--formants">Feature 5: Pitch &amp; Formants</h2>

<p><strong>Pitch</strong> and <strong>formants</strong> are linguistic features important for speech.</p>

<h3 id="pitch-extraction">Pitch Extraction</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PitchExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract fundamental frequency (F0)
    
    Important for:
    - Speaker recognition
    - Emotion detection
    - Prosody modeling
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span>  <span class="c1"># Typical male voice
</span>        <span class="n">self</span><span class="p">.</span><span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span>  <span class="c1"># Typical female voice
</span>    
    <span class="k">def</span> <span class="nf">extract_f0</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract pitch (fundamental frequency)
        
        Returns:
            f0: Pitch values (Hz) per frame
            voiced_flag: Boolean array (voiced vs unvoiced)
        </span><span class="sh">"""</span>
        <span class="c1"># Extract pitch using YIN algorithm
</span>        <span class="n">f0</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">yin</span><span class="p">(</span>
            <span class="n">audio</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmin</span><span class="p">,</span>
            <span class="n">fmax</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">fmax</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Detect voiced regions (f0 &gt; 0)
</span>        <span class="n">voiced_flag</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">&gt;</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">f0</span><span class="p">,</span> <span class="n">voiced_flag</span>
    
    <span class="k">def</span> <span class="nf">extract_pitch_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract pitch statistics
        
        Useful for speaker/emotion recognition
        </span><span class="sh">"""</span>
        <span class="n">f0</span><span class="p">,</span> <span class="n">voiced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_f0</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Statistics on voiced frames
</span>        <span class="n">voiced_f0</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="n">voiced</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">mean_pitch</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">std_pitch</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">min_pitch</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">max_pitch</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">pitch_range</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">voiced_f0</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">voiced_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">voiced</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">voiced</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">mean_pitch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">std_pitch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">min_pitch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">max_pitch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pitch_range</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">voiced_ratio</span><span class="sh">'</span><span class="p">]}</span>
        
        <span class="k">return</span> <span class="n">features</span>

<span class="c1"># Usage
</span><span class="n">pitch_extractor</span> <span class="o">=</span> <span class="nc">PitchExtractor</span><span class="p">()</span>
<span class="n">f0</span><span class="p">,</span> <span class="n">voiced</span> <span class="o">=</span> <span class="n">pitch_extractor</span><span class="p">.</span><span class="nf">extract_f0</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Pitch shape: </span><span class="si">{</span><span class="n">f0</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="n">pitch_stats</span> <span class="o">=</span> <span class="n">pitch_extractor</span><span class="p">.</span><span class="nf">extract_pitch_features</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Pitch statistics: </span><span class="si">{</span><span class="n">pitch_stats</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="production-feature-pipeline">Production Feature Pipeline</h2>

<p>Combine all features into a unified pipeline.</p>

<h3 id="unified-feature-extractor">Unified Feature Extractor</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FeatureConfig</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Configuration for feature extraction</span><span class="sh">"""</span>
    <span class="n">sr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16000</span>
    <span class="n">feature_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># ['mfcc', 'mel', 'pitch']
</span>    
    <span class="c1"># MFCC config
</span>    <span class="n">n_mfcc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>
    
    <span class="c1"># Mel-spectrogram config
</span>    <span class="n">n_mels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span>
    
    <span class="c1"># Common config
</span>    <span class="n">n_fft</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span>
    <span class="n">hop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">160</span>  <span class="c1"># 10ms
</span>    
    <span class="c1"># Normalization
</span>    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">feature_types</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">feature_types</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">AudioFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Production-grade audio feature extractor
    
    Supports multiple feature types, caching, and batch processing
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FeatureConfig</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        
        <span class="c1"># Initialize extractors
</span>        <span class="n">self</span><span class="p">.</span><span class="n">mfcc_extractor</span> <span class="o">=</span> <span class="nc">MFCCExtractor</span><span class="p">(</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_mfcc</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">n_mfcc</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">mel_extractor</span> <span class="o">=</span> <span class="nc">MelSpectrogramExtractor</span><span class="p">(</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_mels</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">n_mels</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">pitch_extractor</span> <span class="o">=</span> <span class="nc">PitchExtractor</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">time_extractor</span> <span class="o">=</span> <span class="nc">TimeDomainExtractor</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features based on config
        
        Args:
            audio: Audio waveform
        
        Returns:
            Dictionary of features
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">feature_types</span><span class="p">:</span>
            <span class="n">mfccs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">mfcc_extractor</span><span class="p">.</span><span class="nf">extract_with_deltas</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">normalize</span><span class="p">:</span>
                <span class="n">mfccs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize</span><span class="p">(</span><span class="n">mfccs</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfccs</span>
        
        <span class="k">if</span> <span class="sh">'</span><span class="s">mel</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">feature_types</span><span class="p">:</span>
            <span class="n">mel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">mel_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">normalize</span><span class="p">:</span>
                <span class="n">mel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize</span><span class="p">(</span><span class="n">mel</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mel</span>
        
        <span class="k">if</span> <span class="sh">'</span><span class="s">pitch</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">feature_types</span><span class="p">:</span>
            <span class="n">f0</span><span class="p">,</span> <span class="n">voiced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">pitch_extractor</span><span class="p">.</span><span class="nf">extract_f0</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">hop_length</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">pitch</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f0</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">voiced</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">voiced</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">feature_types</span><span class="p">:</span>
            <span class="n">time_feats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">time_extractor</span><span class="p">.</span><span class="nf">extract_all</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">normalize</span><span class="p">:</span>
                <span class="n">time_feats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize</span><span class="p">(</span><span class="n">time_feats</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_feats</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Normalize features (mean=0, std=1) per coefficient
        </span><span class="sh">"""</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-8</span>
        
        <span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">features</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
        
        <span class="k">return</span> <span class="n">normalized</span>
    
    <span class="k">def</span> <span class="nf">extract_from_file</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features from audio file
        </span><span class="sh">"""</span>
        <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">extract_batch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features from batch of audio
        </span><span class="sh">"""</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="k">for</span> <span class="n">audio</span> <span class="ow">in</span> <span class="n">audio_list</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">save_config</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Save feature extraction config</span><span class="sh">"""</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureConfig</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Load feature extraction config</span><span class="sh">"""</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="nc">FeatureConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>

<span class="c1"># Usage
</span><span class="n">config</span> <span class="o">=</span> <span class="nc">FeatureConfig</span><span class="p">(</span>
    <span class="n">feature_types</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pitch</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">n_mfcc</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">n_mels</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
    <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="nc">AudioFeatureExtractor</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Extract features
</span><span class="n">features</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Extracted features:</span><span class="sh">"</span><span class="p">,</span> <span class="n">features</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">feat</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Save config for reproducibility
</span><span class="n">extractor</span><span class="p">.</span><span class="nf">save_config</span><span class="p">(</span><span class="sh">'</span><span class="s">feature_config.json</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="handling-variable-length-audio">Handling Variable-Length Audio</h2>

<p>Different audio clips have different durations. Need to handle this for ML.</p>

<h3 id="strategy-1-paddingtruncation">Strategy 1: Padding/Truncation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">VariableLengthHandler</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Handle variable-length audio
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">pad_or_truncate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Pad or truncate features to fixed length
        
        Args:
            features: (n_features, time)
            target_length: Target time dimension
        
        Returns:
            Fixed-length features: (n_features, target_length)
        </span><span class="sh">"""</span>
        <span class="n">current_length</span> <span class="o">=</span> <span class="n">features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">current_length</span> <span class="o">&lt;</span> <span class="n">target_length</span><span class="p">:</span>
            <span class="c1"># Pad with zeros
</span>            <span class="n">pad_width</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">target_length</span> <span class="o">-</span> <span class="n">current_length</span><span class="p">))</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">pad</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pad_width</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">constant</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">current_length</span> <span class="o">&gt;</span> <span class="n">target_length</span><span class="p">:</span>
            <span class="c1"># Truncate (take first target_length frames)
</span>            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="p">:</span><span class="n">target_length</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">create_mask</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Create attention mask for padded features
        
        Returns:
            Mask: (target_length,) - 1 for real frames, 0 for padding
        </span><span class="sh">"""</span>
        <span class="n">current_length</span> <span class="o">=</span> <span class="n">features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">target_length</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[:</span><span class="nf">min</span><span class="p">(</span><span class="n">current_length</span><span class="p">,</span> <span class="n">target_length</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">mask</span>
</code></pre></div></div>

<h3 id="strategy-2-temporal-pooling">Strategy 2: Temporal Pooling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TemporalPooler</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Pool variable-length features to fixed size
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">mean_pool</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Average pool over time
        
        Args:
            features: (n_features, time)
        
        Returns:
            Pooled: (n_features,)
        </span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">max_pool</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Max pool over time</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">stats_pool</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Statistical pooling: mean + std
        
        Returns:
            Pooled: (n_features * 2,)
        </span><span class="sh">"""</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">])</span>
</code></pre></div></div>

<hr />

<h2 id="real-time-feature-extraction">Real-Time Feature Extraction</h2>

<p>For streaming applications, need incremental feature extraction.</p>

<h3 id="streaming-feature-extractor">Streaming Feature Extractor</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span> <span class="nc">StreamingFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract features from streaming audio
    
    Use case: Real-time ASR, voice assistants
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
        <span class="n">frame_length_ms</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">hop_length_ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">buffer_duration_ms</span><span class="o">=</span><span class="mi">500</span>
    <span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">frame_length</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">frame_length_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">hop_length_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">buffer_length</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">buffer_duration_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
        
        <span class="c1"># Circular buffer for audio
</span>        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">buffer_length</span><span class="p">)</span>
        
        <span class="c1"># Feature extractor
</span>        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="nc">MFCCExtractor</span><span class="p">(</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_audio_chunk</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_chunk</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Add new audio chunk to buffer
        
        Args:
            audio_chunk: New audio samples
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">extract_latest</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features from current buffer
        
        Returns:
            Features or None if buffer too small
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">frame_length</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="c1"># Convert buffer to array
</span>        <span class="n">audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">)</span>
        
        <span class="c1"># Extract features
</span>        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Clear buffer</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

<span class="c1"># Usage
</span><span class="n">streaming_extractor</span> <span class="o">=</span> <span class="nc">StreamingFeatureExtractor</span><span class="p">()</span>

<span class="c1"># Simulate streaming (100ms chunks)
</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1600</span>  <span class="c1"># 100ms at 16kHz
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">):</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">audio</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk_size</span><span class="p">]</span>
    
    <span class="c1"># Add to buffer
</span>    <span class="n">streaming_extractor</span><span class="p">.</span><span class="nf">add_audio_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    
    <span class="c1"># Extract features
</span>    <span class="n">features</span> <span class="o">=</span> <span class="n">streaming_extractor</span><span class="p">.</span><span class="nf">extract_latest</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Chunk </span><span class="si">{</span><span class="n">i</span><span class="o">//</span><span class="n">chunk_size</span><span class="si">}</span><span class="s">: features shape = </span><span class="si">{</span><span class="n">features</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># Process features (send to model, etc.)
</span></code></pre></div></div>

<hr />

<h2 id="performance-optimization">Performance Optimization</h2>

<h3 id="1-caching-features">1. Caching Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pickle</span>
<span class="kn">import</span> <span class="n">hashlib</span>

<span class="k">class</span> <span class="nc">CachedFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Cache extracted features to disk
    
    Avoid re-extracting for same audio
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">extractor</span><span class="p">:</span> <span class="n">AudioFeatureExtractor</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="sh">'</span><span class="s">./feature_cache</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">extractor</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">cache_dir</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_cache_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Generate cache file path based on audio path hash</span><span class="sh">"""</span>
        <span class="n">path_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">md5</span><span class="p">(</span><span class="n">audio_path</span><span class="p">.</span><span class="nf">encode</span><span class="p">()).</span><span class="nf">hexdigest</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cache_dir</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">path_hash</span><span class="si">}</span><span class="s">.pkl</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">extract_from_file</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features with caching
        </span><span class="sh">"""</span>
        <span class="n">cache_path</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_cache_path</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
        
        <span class="c1"># Check cache
</span>        <span class="k">if</span> <span class="n">use_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">features</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">features</span>
        
        <span class="c1"># Extract features
</span>        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="nf">extract_from_file</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
        
        <span class="c1"># Save to cache
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></div>

<h3 id="2-parallel-processing">2. Parallel Processing</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">class</span> <span class="nc">ParallelFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract features from multiple files in parallel
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">extractor</span><span class="p">:</span> <span class="n">AudioFeatureExtractor</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">extractor</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_workers</span> <span class="o">=</span> <span class="n">n_workers</span>
    
    <span class="k">def</span> <span class="nf">extract_from_files</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features from multiple files in parallel
        </span><span class="sh">"""</span>
        <span class="k">with</span> <span class="nc">Pool</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="n">features_list</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span>
                <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="n">extract_from_file</span><span class="p">,</span>
                <span class="n">audio_paths</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features_list</span>

<span class="c1"># Usage
</span><span class="n">parallel_extractor</span> <span class="o">=</span> <span class="nc">ParallelFeatureExtractor</span><span class="p">(</span><span class="n">extractor</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">audio_files</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">file1.wav</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">file2.wav</span><span class="sh">'</span><span class="p">,</span> <span class="p">...]</span>  <span class="c1"># 1000s of files
</span><span class="n">features</span> <span class="o">=</span> <span class="n">parallel_extractor</span><span class="p">.</span><span class="nf">extract_from_files</span><span class="p">(</span><span class="n">audio_files</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="advanced-feature-types">Advanced Feature Types</h2>

<h3 id="1-learned-features-embeddings">1. Learned Features (Embeddings)</h3>

<p>Instead of hand-crafted features, learn representations from data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">AudioEmbeddingExtractor</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Extract learned audio embeddings
    
    Use pre-trained models (wav2vec, HuBERT) as feature extractors
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="sh">'</span><span class="s">facebook/wav2vec2-base</span><span class="sh">'</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="kn">from</span> <span class="n">transformers</span> <span class="kn">import</span> <span class="n">Wav2Vec2Model</span>
        
        <span class="c1"># Load pre-trained model
</span>        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Wav2Vec2Model</span><span class="p">.</span><span class="nf">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>  <span class="c1"># Freeze for feature extraction
</span>    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract contextualized embeddings
        
        Returns:
            Embeddings: (time_steps, hidden_dim)
                typically (time, 768) for base model
        </span><span class="sh">"""</span>
        <span class="c1"># Convert to tensor
</span>        <span class="n">audio_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">tensor</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="n">float32</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Extract features
</span>        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="n">audio_tensor</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">.</span><span class="n">last_hidden_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># (time, 768)
</span>        
        <span class="k">return</span> <span class="n">embeddings</span><span class="p">.</span><span class="nf">numpy</span><span class="p">()</span>

<span class="c1"># Usage - MUCH more powerful than MFCCs for transfer learning
</span><span class="n">embedding_extractor</span> <span class="o">=</span> <span class="nc">AudioEmbeddingExtractor</span><span class="p">()</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">embedding_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Embeddings shape: </span><span class="si">{</span><span class="n">embeddings</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (time, 768)
</span></code></pre></div></div>

<p><strong>Comparison:</strong></p>

<table>
  <thead>
    <tr>
      <th>Feature Type</th>
      <th>Dimension</th>
      <th>Training Required</th>
      <th>Transfer Learning</th>
      <th>Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MFCCs</td>
      <td>40-120</td>
      <td>No</td>
      <td>Poor</td>
      <td>Baseline</td>
    </tr>
    <tr>
      <td>Mel-spectrogram</td>
      <td>80-128</td>
      <td>No</td>
      <td>Good</td>
      <td>+5-10%</td>
    </tr>
    <tr>
      <td>Wav2Vec embeddings</td>
      <td>768</td>
      <td>Yes (pre-trained)</td>
      <td>Excellent</td>
      <td>+15-25%</td>
    </tr>
  </tbody>
</table>

<h3 id="2-filter-bank-features-fbank">2. Filter Bank Features (FBank)</h3>

<p>Alternative to MFCCs - skip the DCT step.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FilterbankExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract log mel-filterbank features
    
    Similar to mel-spectrograms, popular in modern ASR
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">n_mels</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mels</span> <span class="o">=</span> <span class="n">n_mels</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Extract log filter bank energies
        
        Returns:
            FBank: (n_mels, time_steps)
        </span><span class="sh">"""</span>
        <span class="c1"># Mel spectrogram
</span>        <span class="n">mel_spec</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">melspectrogram</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">n_mels</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_mels</span>
        <span class="p">)</span>
        
        <span class="c1"># Log
</span>        <span class="n">log_mel</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">power_to_db</span><span class="p">(</span><span class="n">mel_spec</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">log_mel</span>

<span class="c1"># FBank vs MFCC:
# - FBank: Keep all mel bins (80-128)
# - MFCC: Compress to 13-40 via DCT
# 
# FBank often works better with neural networks
</span></code></pre></div></div>

<h3 id="3-prosodic-features">3. Prosodic Features</h3>

<p>Capture rhythm, stress, and intonation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProsodicFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract prosodic features for emotion, speaker ID, etc.
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">extract_intensity_contour</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Intensity (loudness) over time
        </span><span class="sh">"""</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">rms</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Convert to dB
</span>        <span class="n">intensity_db</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">amplitude_to_db</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">intensity_db</span>
    
    <span class="k">def</span> <span class="nf">extract_speaking_rate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Estimate speaking rate (syllables per second)
        
        Approximation: count peaks in energy envelope
        </span><span class="sh">"""</span>
        <span class="c1"># Energy envelope
</span>        <span class="n">energy</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">rms</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Find peaks (local maxima)
</span>        <span class="kn">from</span> <span class="n">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>
        
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">find_peaks</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        
        <span class="c1"># Speaking rate
</span>        <span class="n">duration</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="o">/</span> <span class="n">sr</span>
        <span class="n">syllables_per_sec</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">/</span> <span class="n">duration</span>
        
        <span class="k">return</span> <span class="n">syllables_per_sec</span>
    
    <span class="k">def</span> <span class="nf">extract_all_prosodic</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Extract all prosodic features</span><span class="sh">"""</span>
        
        <span class="c1"># Pitch
</span>        <span class="n">pitch_extractor</span> <span class="o">=</span> <span class="nc">PitchExtractor</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
        <span class="n">pitch_stats</span> <span class="o">=</span> <span class="n">pitch_extractor</span><span class="p">.</span><span class="nf">extract_pitch_features</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Intensity
</span>        <span class="n">intensity</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_intensity_contour</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>
        
        <span class="c1"># Speaking rate
</span>        <span class="n">speaking_rate</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_speaking_rate</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">pitch_stats</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">mean_intensity</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">intensity</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">std_intensity</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">intensity</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">speaking_rate</span><span class="sh">'</span><span class="p">:</span> <span class="n">speaking_rate</span>
        <span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="feature-quality--validation">Feature Quality &amp; Validation</h2>

<p>Ensure extracted features are high quality.</p>

<h3 id="feature-quality-metrics">Feature Quality Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FeatureQualityChecker</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Validate quality of extracted features
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">check_for_nans</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Check for NaN/Inf values</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">feat</span><span class="p">).</span><span class="nf">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="p">.</span><span class="nf">isinf</span><span class="p">(</span><span class="n">feat</span><span class="p">).</span><span class="nf">any</span><span class="p">():</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">⚠️  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> contains NaN/Inf</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">check_dynamic_range</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Check dynamic range of features
        
        Low dynamic range → feature not informative
        </span><span class="sh">"""</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">feat_range</span> <span class="o">=</span> <span class="n">feat</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">feat</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span>
            <span class="n">ranges</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat_range</span>
            
            <span class="k">if</span> <span class="n">feat_range</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">⚠️  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> has very low dynamic range: </span><span class="si">{</span><span class="n">feat_range</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ranges</span>
    
    <span class="k">def</span> <span class="nf">check_feature_statistics</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features_batch</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Check statistics across batch
        
        Ensure features are properly normalized
        </span><span class="sh">"""</span>
        <span class="c1"># Stack all features
</span>        <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">(</span><span class="n">features_batch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (n_features, total_time)
</span>        
        <span class="c1"># Per-feature statistics
</span>        <span class="n">mean_per_feature</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">all_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">std_per_feature</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">all_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Feature Statistics:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Mean range: [</span><span class="si">{</span><span class="n">mean_per_feature</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">mean_per_feature</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Std range: [</span><span class="si">{</span><span class="n">std_per_feature</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">std_per_feature</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Check if normalized
</span>        <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">mean_per_feature</span><span class="p">).</span><span class="nf">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">⚠️  Features not centered (mean far from 0)</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">std_per_feature</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">).</span><span class="nf">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">⚠️  Features not standardized (std far from 1)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="connection-to-data-preprocessing-pipeline">Connection to Data Preprocessing Pipeline</h2>

<p>Feature extraction for speech is analogous to data preprocessing for ML systems (see Day 3 ML).</p>

<h3 id="parallel-concepts">Parallel Concepts</h3>

<table>
  <thead>
    <tr>
      <th>Speech Feature Extraction</th>
      <th>ML Data Preprocessing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Handle missing audio</td>
      <td>Handle missing values</td>
    </tr>
    <tr>
      <td>Normalize features (mean=0, std=1)</td>
      <td>Normalize numerical features</td>
    </tr>
    <tr>
      <td>Pad/truncate variable length</td>
      <td>Handle variable-length sequences</td>
    </tr>
    <tr>
      <td>Validate audio quality</td>
      <td>Schema validation</td>
    </tr>
    <tr>
      <td>Cache extracted features</td>
      <td>Cache preprocessed data</td>
    </tr>
    <tr>
      <td>Batch processing</td>
      <td>Distributed data processing</td>
    </tr>
  </tbody>
</table>

<h3 id="unified-preprocessing-framework">Unified Preprocessing Framework</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UnifiedPreprocessor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Combined preprocessing for multimodal ML
    
    Example: Speech + text + metadata
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Audio features
</span>        <span class="n">self</span><span class="p">.</span><span class="n">audio_extractor</span> <span class="o">=</span> <span class="nc">AudioFeatureExtractor</span><span class="p">(</span>
            <span class="nc">FeatureConfig</span><span class="p">(</span><span class="n">feature_types</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="p">])</span>
        <span class="p">)</span>
        
        <span class="c1"># Text features (from transcripts)
</span>        <span class="kn">from</span> <span class="n">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
        <span class="n">self</span><span class="p">.</span><span class="n">text_vectorizer</span> <span class="o">=</span> <span class="nc">TfidfVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        
        <span class="c1"># Numerical features
</span>        <span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
        <span class="n">self</span><span class="p">.</span><span class="n">numerical_scaler</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">preprocess_sample</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Preprocess multimodal sample
        
        Args:
            audio: Audio waveform
            text: Transcript or description
            metadata: User/item metadata (dict)
        
        Returns:
            Combined feature vector
        </span><span class="sh">"""</span>
        <span class="c1"># Extract audio features
</span>        <span class="n">audio_features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">audio_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        <span class="n">audio_pooled</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">audio_features</span><span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (n_mfcc,)
</span>        
        <span class="c1"># Extract text features
</span>        <span class="n">text_features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">text_vectorizer</span><span class="p">.</span><span class="nf">transform</span><span class="p">([</span><span class="n">text</span><span class="p">]).</span><span class="nf">toarray</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># (1000,)
</span>        
        <span class="c1"># Process metadata
</span>        <span class="n">metadata_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
            <span class="n">metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">user_gender</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">device_type</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">metadata_scaled</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">numerical_scaler</span><span class="p">.</span><span class="nf">transform</span><span class="p">([</span><span class="n">metadata_array</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Concatenate all features
</span>        <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>
            <span class="n">audio_pooled</span><span class="p">,</span>      <span class="c1"># (40,)
</span>            <span class="n">text_features</span><span class="p">,</span>     <span class="c1"># (1000,)
</span>            <span class="n">metadata_scaled</span>    <span class="c1"># (3,)
</span>        <span class="p">])</span>  <span class="c1"># Total: (1043,)
</span>        
        <span class="k">return</span> <span class="n">combined</span>
</code></pre></div></div>

<hr />

<h2 id="production-best-practices">Production Best Practices</h2>

<h3 id="1-feature-versioning">1. Feature Versioning</h3>

<p>Track feature extraction versions for reproducibility.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">VersionedFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Version feature extraction logic
    
    Critical for:
    - A/B testing different features
    - Rollback if new features hurt performance
    - Reproducibility
    </span><span class="sh">"""</span>
    
    <span class="n">VERSION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1.2.0</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FeatureConfig</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="nc">AudioFeatureExtractor</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">extract_with_metadata</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract features with version metadata
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="nf">extract_from_file</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
        
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">VERSION</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">__dict__</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">audio_path</span><span class="sh">'</span><span class="p">:</span> <span class="n">audio_path</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">features</span><span class="sh">'</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">metadata</span><span class="sh">'</span><span class="p">:</span> <span class="n">metadata</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">save_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Save features with version info</span><span class="sh">"""</span>
        <span class="n">np</span><span class="p">.</span><span class="nf">savez_compressed</span><span class="p">(</span>
            <span class="n">output_path</span><span class="p">,</span>
            <span class="o">**</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">features</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">metadata</span><span class="sh">'</span><span class="p">])</span>
        <span class="p">)</span>
</code></pre></div></div>

<h3 id="2-error-handling">2. Error Handling</h3>

<p>Robust feature extraction handles failures gracefully.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobustFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Feature extractor with error handling
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">extractor</span><span class="p">:</span> <span class="n">AudioFeatureExtractor</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">extractor</span>
    
    <span class="k">def</span> <span class="nf">extract_safe</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features with error handling
        </span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load audio
</span>            <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
            
            <span class="c1"># Validate
</span>            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Empty audio: </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># &lt; 100ms
</span>                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Audio too short: </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            
            <span class="c1"># Extract
</span>            <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
            
            <span class="c1"># Quality check
</span>            <span class="n">quality_checker</span> <span class="o">=</span> <span class="nc">FeatureQualityChecker</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quality_checker</span><span class="p">.</span><span class="nf">check_for_nans</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Feature extraction failed (NaN): </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            
            <span class="k">return</span> <span class="n">features</span>
        
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Feature extraction error for </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">extract_batch_robust</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract from batch, skipping failures
        </span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">failures</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">audio_paths</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_safe</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">'</span><span class="s">path</span><span class="sh">'</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">features</span><span class="sh">'</span><span class="p">:</span> <span class="n">features</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">failures</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        
        <span class="n">success_rate</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">audio_paths</span><span class="p">)</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Feature extraction: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">audio_paths</span><span class="p">)</span><span class="si">}</span><span class="s"> succeeded (</span><span class="si">{</span><span class="n">success_rate</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">failures</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed files: </span><span class="si">{</span><span class="n">failures</span><span class="p">[</span><span class="si">:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Log first 10
</span>        
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div>

<h3 id="3-monitoring-feature-quality">3. Monitoring Feature Quality</h3>

<p>Track feature statistics over time to detect issues.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FeatureMonitor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Monitor feature quality in production
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">expected_stats</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            expected_stats: Expected statistics per feature type
                {
                    </span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="s">: {</span><span class="sh">'</span><span class="s">mean_range</span><span class="sh">'</span><span class="s">: [-5, 5], </span><span class="sh">'</span><span class="s">std_range</span><span class="sh">'</span><span class="s">: [0.5, 2.0]},
                    </span><span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="s">: {</span><span class="sh">'</span><span class="s">mean_range</span><span class="sh">'</span><span class="s">: [-80, 0], </span><span class="sh">'</span><span class="s">std_range</span><span class="sh">'</span><span class="s">: [10, 30]}
                }
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">expected_stats</span> <span class="o">=</span> <span class="n">expected_stats</span>
    
    <span class="k">def</span> <span class="nf">validate_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Validate extracted features against expected statistics
        
        Returns:
            List of warnings
        </span><span class="sh">"""</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_values</span> <span class="ow">in</span> <span class="n">features</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">feat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">expected_stats</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">expected</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">expected_stats</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span>
            
            <span class="c1"># Check mean
</span>            <span class="n">actual_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">feat_values</span><span class="p">)</span>
            <span class="n">expected_mean_range</span> <span class="o">=</span> <span class="n">expected</span><span class="p">[</span><span class="sh">'</span><span class="s">mean_range</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">expected_mean_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">actual_mean</span> <span class="o">&lt;=</span> <span class="n">expected_mean_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">warnings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s">: mean </span><span class="si">{</span><span class="n">actual_mean</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> outside expected range </span><span class="si">{</span><span class="n">expected_mean_range</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
            
            <span class="c1"># Check std
</span>            <span class="n">actual_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">feat_values</span><span class="p">)</span>
            <span class="n">expected_std_range</span> <span class="o">=</span> <span class="n">expected</span><span class="p">[</span><span class="sh">'</span><span class="s">std_range</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">expected_std_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">actual_std</span> <span class="o">&lt;=</span> <span class="n">expected_std_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">warnings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s">: std </span><span class="si">{</span><span class="n">actual_std</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> outside expected range </span><span class="si">{</span><span class="n">expected_std_range</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">warnings</span>
    
    <span class="k">def</span> <span class="nf">compute_statistics</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features_batch</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]]):</span>
        <span class="sh">"""</span><span class="s">
        Compute statistics across batch
        
        Use to establish baseline expected_stats
        </span><span class="sh">"""</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Get feature names from first sample
</span>        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">features_batch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">keys</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
            <span class="c1"># Collect all values
</span>            <span class="n">all_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>
                <span class="n">f</span><span class="p">[</span><span class="n">feat_name</span><span class="p">].</span><span class="nf">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features_batch</span>
            <span class="p">])</span>
            
            <span class="n">stats</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">all_values</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">all_values</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">all_values</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">all_values</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">percentiles</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">25</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">all_values</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">50</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">all_values</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">75</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">all_values</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">95</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">all_values</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></div>

<hr />

<h2 id="data-augmentation-in-feature-space">Data Augmentation in Feature Space</h2>

<p>Augment features directly for training robustness.</p>

<h3 id="specaugment">SpecAugment</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SpecAugment</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    SpecAugment: Data augmentation on spectrograms
    
    Proposed in </span><span class="sh">"</span><span class="s">SpecAugment: A Simple Data Augmentation Method for ASR</span><span class="sh">"</span><span class="s"> (Google, 2019)
    
    Improves ASR accuracy by 10-20% on many benchmarks
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">time_mask_param</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span>
        <span class="n">freq_mask_param</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">num_time_masks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">num_freq_masks</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">time_mask_param</span> <span class="o">=</span> <span class="n">time_mask_param</span>
        <span class="n">self</span><span class="p">.</span><span class="n">freq_mask_param</span> <span class="o">=</span> <span class="n">freq_mask_param</span>
        <span class="n">self</span><span class="p">.</span><span class="n">num_time_masks</span> <span class="o">=</span> <span class="n">num_time_masks</span>
        <span class="n">self</span><span class="p">.</span><span class="n">num_freq_masks</span> <span class="o">=</span> <span class="n">num_freq_masks</span>
    
    <span class="k">def</span> <span class="nf">time_mask</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Mask random time region
        
        Sets random time frames to zero
        </span><span class="sh">"""</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">time_length</span> <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">num_time_masks</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">time_mask_param</span><span class="p">,</span> <span class="n">time_length</span><span class="p">))</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_length</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">spec</span><span class="p">[:,</span> <span class="n">t0</span><span class="p">:</span><span class="n">t0</span><span class="o">+</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">spec</span>
    
    <span class="k">def</span> <span class="nf">freq_mask</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Mask random frequency region
        
        Sets random frequency bins to zero
        </span><span class="sh">"""</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">freq_length</span> <span class="o">=</span> <span class="n">spec</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">num_freq_masks</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">freq_mask_param</span><span class="p">,</span> <span class="n">freq_length</span><span class="p">))</span>
            <span class="n">f0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_length</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">spec</span><span class="p">[</span><span class="n">f0</span><span class="p">:</span><span class="n">f0</span><span class="o">+</span><span class="n">f</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">spec</span>
    
    <span class="k">def</span> <span class="nf">augment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Apply both time and freq masking</span><span class="sh">"""</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">time_mask</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">freq_mask</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec</span>

<span class="c1"># Usage during training
</span><span class="n">augmenter</span> <span class="o">=</span> <span class="nc">SpecAugment</span><span class="p">()</span>

<span class="k">for</span> <span class="n">audio</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
    <span class="c1"># Extract features
</span>    <span class="n">mel_spec</span> <span class="o">=</span> <span class="n">mel_extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    
    <span class="c1"># Augment
</span>    <span class="n">mel_spec_aug</span> <span class="o">=</span> <span class="n">augmenter</span><span class="p">.</span><span class="nf">augment</span><span class="p">(</span><span class="n">mel_spec</span><span class="p">)</span>
    
    <span class="c1"># Train model
</span>    <span class="nf">train_model</span><span class="p">(</span><span class="n">mel_spec_aug</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="batch-feature-extraction-for-training">Batch Feature Extraction for Training</h2>

<p>Extract features for entire dataset efficiently.</p>

<h3 id="batch-extraction-pipeline">Batch Extraction Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="n">h5py</span>

<span class="k">class</span> <span class="nc">BatchFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract features for large audio datasets
    
    Use case: Prepare training data
    - Extract once, train many times
    - Save features to disk (HDF5 format)
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">extractor</span><span class="p">:</span> <span class="n">AudioFeatureExtractor</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">extractor</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_workers</span> <span class="o">=</span> <span class="n">n_workers</span>
    
    <span class="k">def</span> <span class="nf">extract_dataset</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">audio_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_length_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract features for all audio files in directory
        
        Args:
            audio_dir: Directory containing .wav files
            output_path: HDF5 file to save features
            max_length_frames: Pad/truncate to this length
        </span><span class="sh">"""</span>
        <span class="c1"># Find all audio files
</span>        <span class="n">audio_files</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nc">Path</span><span class="p">(</span><span class="n">audio_dir</span><span class="p">).</span><span class="nf">rglob</span><span class="p">(</span><span class="sh">'</span><span class="s">*.wav</span><span class="sh">'</span><span class="p">))</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">audio_files</span><span class="p">)</span><span class="si">}</span><span class="s"> audio files</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Create HDF5 file
</span>        <span class="k">with</span> <span class="n">h5py</span><span class="p">.</span><span class="nc">File</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf</span><span class="p">:</span>
            <span class="c1"># Pre-allocate datasets
</span>            <span class="c1"># (We'll store features for each type)
</span>            <span class="n">feature_dim</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">n_mfcc</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># MFCCs + deltas
</span>            
            <span class="n">features_dataset</span> <span class="o">=</span> <span class="n">hf</span><span class="p">.</span><span class="nf">create_dataset</span><span class="p">(</span>
                <span class="sh">'</span><span class="s">features</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">audio_files</span><span class="p">),</span> <span class="n">feature_dim</span><span class="p">,</span> <span class="n">max_length_frames</span><span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">float32</span><span class="sh">'</span>
            <span class="p">)</span>
            
            <span class="n">lengths_dataset</span> <span class="o">=</span> <span class="n">hf</span><span class="p">.</span><span class="nf">create_dataset</span><span class="p">(</span>
                <span class="sh">'</span><span class="s">lengths</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">audio_files</span><span class="p">),),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">int32</span><span class="sh">'</span>
            <span class="p">)</span>
            
            <span class="c1"># Store file paths
</span>            <span class="n">paths_dataset</span> <span class="o">=</span> <span class="n">hf</span><span class="p">.</span><span class="nf">create_dataset</span><span class="p">(</span>
                <span class="sh">'</span><span class="s">paths</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">audio_files</span><span class="p">),),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">h5py</span><span class="p">.</span><span class="nf">string_dtype</span><span class="p">()</span>
            <span class="p">)</span>
            
            <span class="c1"># Extract features
</span>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">audio_path</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">tqdm</span><span class="p">(</span><span class="n">audio_files</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Load audio
</span>                    <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">audio_path</span><span class="p">),</span> <span class="n">sr</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
                    
                    <span class="c1"># Extract features
</span>                    <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
                    
                    <span class="c1"># Get MFCCs with deltas
</span>                    <span class="n">mfcc_deltas</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">]</span>  <span class="c1"># (120, time)
</span>                    
                    <span class="c1"># Pad or truncate
</span>                    <span class="n">handler</span> <span class="o">=</span> <span class="nc">VariableLengthHandler</span><span class="p">()</span>
                    <span class="n">mfcc_fixed</span> <span class="o">=</span> <span class="n">handler</span><span class="p">.</span><span class="nf">pad_or_truncate</span><span class="p">(</span><span class="n">mfcc_deltas</span><span class="p">,</span> <span class="n">max_length_frames</span><span class="p">)</span>
                    
                    <span class="c1"># Store
</span>                    <span class="n">features_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfcc_fixed</span>
                    <span class="n">lengths_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">mfcc_deltas</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_length_frames</span><span class="p">)</span>
                    <span class="n">paths_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
                
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to process </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="c1"># Store zeros for failed files
</span>                    <span class="n">features_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">feature_dim</span><span class="p">,</span> <span class="n">max_length_frames</span><span class="p">))</span>
                    <span class="n">lengths_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">paths_dataset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Features saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Usage
</span><span class="n">batch_extractor</span> <span class="o">=</span> <span class="nc">BatchFeatureExtractor</span><span class="p">(</span><span class="n">extractor</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">batch_extractor</span><span class="p">.</span><span class="nf">extract_dataset</span><span class="p">(</span>
    <span class="n">audio_dir</span><span class="o">=</span><span class="sh">'</span><span class="s">./data/train/</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="sh">'</span><span class="s">./features/train_features.h5</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">max_length_frames</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="c1"># Load for training
</span><span class="k">with</span> <span class="n">h5py</span><span class="p">.</span><span class="nc">File</span><span class="p">(</span><span class="sh">'</span><span class="s">./features/train_features.h5</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf</span><span class="p">:</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">hf</span><span class="p">[</span><span class="sh">'</span><span class="s">features</span><span class="sh">'</span><span class="p">][:]</span>  <span class="c1"># (N, feature_dim, max_length)
</span>    <span class="n">lengths</span> <span class="o">=</span> <span class="n">hf</span><span class="p">[</span><span class="sh">'</span><span class="s">lengths</span><span class="sh">'</span><span class="p">][:]</span>    <span class="c1"># (N,)
</span>    <span class="n">paths</span> <span class="o">=</span> <span class="n">hf</span><span class="p">[</span><span class="sh">'</span><span class="s">paths</span><span class="sh">'</span><span class="p">][:]</span>        <span class="c1"># (N,)
</span></code></pre></div></div>

<hr />

<h2 id="real-world-systems">Real-World Systems</h2>

<h3 id="kaldi-traditional-asr-feature-pipeline">Kaldi: Traditional ASR Feature Pipeline</h3>

<p>Kaldi is the industry standard for traditional ASR.</p>

<p><strong>Feature extraction:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Kaldi feature extraction (MFCC + pitch)</span>
compute-mfcc-feats <span class="nt">--config</span><span class="o">=</span>conf/mfcc.conf scp:wav.scp ark:mfcc.ark
compute-and-process-kaldi-pitch-feats scp:wav.scp ark:pitch.ark

<span class="c"># Combine features</span>
paste-feats ark:mfcc.ark ark:pitch.ark ark:features.ark
</code></pre></div></div>

<p><strong>Configuration (mfcc.conf):</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--use-energy=true
--num-mel-bins=40
--num-ceps=40
--low-freq=20
--high-freq=8000
--sample-frequency=16000
</code></pre></div></div>

<h3 id="pytorch-modern-deep-learning-pipeline">PyTorch: Modern Deep Learning Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torchaudio</span>
<span class="kn">import</span> <span class="n">torch</span>

<span class="k">class</span> <span class="nc">TorchAudioExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Feature extraction using torchaudio
    
    Benefits:
    - GPU acceleration
    - Differentiable (can backprop through features)
    - Integrated with PyTorch training
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">n_mfcc</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">n_mels</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mfcc</span> <span class="o">=</span> <span class="n">n_mfcc</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mels</span> <span class="o">=</span> <span class="n">n_mels</span>
        
        <span class="c1"># Create transforms (can move to GPU)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">mfcc_transform</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">transforms</span><span class="p">.</span><span class="nc">MFCC</span><span class="p">(</span>
            <span class="n">sample_rate</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_mfcc</span><span class="o">=</span><span class="n">n_mfcc</span><span class="p">,</span>
            <span class="n">melkwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">n_mels</span><span class="sh">'</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_fft</span><span class="sh">'</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="sh">'</span><span class="s">hop_length</span><span class="sh">'</span><span class="p">:</span> <span class="mi">160</span><span class="p">}</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">mel_transform</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">transforms</span><span class="p">.</span><span class="nc">MelSpectrogram</span><span class="p">(</span>
            <span class="n">sample_rate</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>
            <span class="n">n_mels</span><span class="o">=</span><span class="n">n_mels</span>
        <span class="p">)</span>
        
        <span class="c1"># Amplitude → dB conversion
</span>        <span class="n">self</span><span class="p">.</span><span class="n">db_transform</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="n">transforms</span><span class="p">.</span><span class="nc">AmplitudeToDB</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Move transforms to a device (CPU/GPU) and return self.
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mfcc_transform</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">mfcc_transform</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mel_transform</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">mel_transform</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">db_transform</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">db_transform</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Extract features (GPU-accelerated if audio on GPU)
        
        Args:
            audio: (batch, time) or (time,)
        
        Returns:
            Dictionary of features
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">audio</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Add batch dimension
</span>        
        <span class="c1"># Extract
</span>        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">mfcc_transform</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>  <span class="c1"># (batch, n_mfcc, time)
</span>        <span class="n">mel</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">mel_transform</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>     <span class="c1"># (batch, n_mels, time)
</span>        <span class="n">mel_db</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">db_transform</span><span class="p">(</span><span class="n">mel</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">mfcc</span><span class="sh">'</span><span class="p">:</span> <span class="n">mfccs</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">mel</span><span class="sh">'</span><span class="p">:</span> <span class="n">mel_db</span>
        <span class="p">}</span>

<span class="c1"># Usage with GPU
</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="sh">'</span><span class="s">cuda</span><span class="sh">'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="sh">'</span><span class="s">cpu</span><span class="sh">'</span><span class="p">)</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="nc">TorchAudioExtractor</span><span class="p">().</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Load audio
</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">speech.wav</span><span class="sh">'</span><span class="p">)</span>
<span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Extract (on GPU)
</span><span class="n">features</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="google-production-asr-feature-extraction">Google: Production ASR Feature Extraction</h3>

<p><strong>Stack:</strong></p>
<ul>
  <li><strong>Input:</strong> 16kHz audio</li>
  <li><strong>Features:</strong> 80-bin log mel-filterbank</li>
  <li><strong>Augmentation:</strong> SpecAugment</li>
  <li><strong>Normalization:</strong> Per-utterance mean/variance normalization</li>
  <li><strong>Model:</strong> Transformer encoder-decoder</li>
</ul>

<p><strong>Key optimizations:</strong></p>
<ul>
  <li>Precompute features for training data</li>
  <li>On-the-fly extraction for inference</li>
  <li>GPU-accelerated extraction for real-time systems</li>
</ul>

<hr />

<h2 id="choosing-the-right-features">Choosing the Right Features</h2>

<p>Different tasks need different features.</p>

<h3 id="feature-selection-guide">Feature Selection Guide</h3>

<table>
  <thead>
    <tr>
      <th>Task</th>
      <th>Best Features</th>
      <th>Why</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ASR (traditional)</strong></td>
      <td>MFCCs + deltas</td>
      <td>Captures phonetic content</td>
    </tr>
    <tr>
      <td><strong>ASR (deep learning)</strong></td>
      <td>Mel-spectrograms</td>
      <td>Works well with CNNs</td>
    </tr>
    <tr>
      <td><strong>Speaker Recognition</strong></td>
      <td>MFCCs + pitch + prosody</td>
      <td>Speaker identity in pitch/prosody</td>
    </tr>
    <tr>
      <td><strong>Emotion Recognition</strong></td>
      <td>Prosodic + spectral</td>
      <td>Emotion in prosody + voice quality</td>
    </tr>
    <tr>
      <td><strong>Keyword Spotting</strong></td>
      <td>Mel-spectrograms</td>
      <td>Simple, fast with CNNs</td>
    </tr>
    <tr>
      <td><strong>Speech Enhancement</strong></td>
      <td>STFT magnitude + phase</td>
      <td>Need phase for reconstruction</td>
    </tr>
    <tr>
      <td><strong>Voice Activity Detection</strong></td>
      <td>Energy + ZCR</td>
      <td>Simple features sufficient</td>
    </tr>
  </tbody>
</table>

<h3 id="combining-features">Combining Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MultiFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Combine multiple feature types
    
    Different features capture different aspects
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mfcc_ext</span> <span class="o">=</span> <span class="nc">MFCCExtractor</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pitch_ext</span> <span class="o">=</span> <span class="nc">PitchExtractor</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">prosody_ext</span> <span class="o">=</span> <span class="nc">ProsodicFeatureExtractor</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">extract_combined</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract and combine multiple feature types
        </span><span class="sh">"""</span>
        <span class="c1"># MFCCs (40, time)
</span>        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">mfcc_ext</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Pitch (time,)
</span>        <span class="n">pitch</span><span class="p">,</span> <span class="n">voiced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">pitch_ext</span><span class="p">.</span><span class="nf">extract_f0</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (1, time)
</span>        
        <span class="c1"># Energy (1, time)
</span>        <span class="n">energy</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">rms</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
        
        <span class="c1"># Align all features to same time dimension
</span>        <span class="n">min_time</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">mfccs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pitch</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">energy</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">mfccs</span><span class="p">[:,</span> <span class="p">:</span><span class="n">min_time</span><span class="p">]</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[:,</span> <span class="p">:</span><span class="n">min_time</span><span class="p">]</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span><span class="p">[:,</span> <span class="p">:</span><span class="n">min_time</span><span class="p">]</span>
        
        <span class="c1"># Stack
</span>        <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">([</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">energy</span><span class="p">])</span>  <span class="c1"># (42, time)
</span>        
        <span class="k">return</span> <span class="n">combined</span>
</code></pre></div></div>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>

<p>✅ <strong>MFCCs</strong> are standard for speech recognition - compact and robust<br />
✅ <strong>Mel-spectrograms</strong> work better with deep learning (CNNs, Transformers)<br />
✅ <strong>Delta features</strong> capture temporal dynamics - critical for accuracy<br />
✅ <strong>Normalize features</strong> for stable training (mean=0, std=1)<br />
✅ <strong>Handle variable length</strong> with padding, pooling, or attention masks<br />
✅ <strong>Cache features</strong> for repeated use - major speedup in training<br />
✅ <strong>Streaming extraction</strong> possible with circular buffers<br />
✅ <strong>Parallel processing</strong> speeds up batch feature extraction<br />
✅ <strong>SpecAugment</strong> improves robustness through feature-space augmentation<br />
✅ <strong>Monitor feature quality</strong> to detect pipeline issues early<br />
✅ <strong>Version features</strong> for reproducibility and A/B testing<br />
✅ <strong>Choose features based on task</strong> - no one-size-fits-all</p>

<hr />

<p><strong>Originally published at:</strong> <a href="https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/">arunbaby.com/speech-tech/0003-audio-feature-extraction</a></p>

<p><em>If you found this helpful, consider sharing it with others who might benefit.</em></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#audio-processing" class="page__taxonomy-item p-category" rel="tag">audio-processing</a><span class="sep">, </span>
    
      <a href="/tags/#feature-extraction" class="page__taxonomy-item p-category" rel="tag">feature-extraction</a><span class="sep">, </span>
    
      <a href="/tags/#mfcc" class="page__taxonomy-item p-category" rel="tag">mfcc</a><span class="sep">, </span>
    
      <a href="/tags/#spectrograms" class="page__taxonomy-item p-category" rel="tag">spectrograms</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#speech-tech" class="page__taxonomy-item p-category" rel="tag">speech-tech</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-10-13T23:03:17+05:30">October 13, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=arunbaby0&text=Audio+Feature+Extraction+for+Speech+ML%20https%3A%2F%2Fwww.arunbaby.com%2Fspeech-tech%2F0003-audio-feature-extraction%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.arunbaby.com%2Fspeech-tech%2F0003-audio-feature-extraction%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.arunbaby.com/speech-tech/0003-audio-feature-extraction/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/speech-tech/0002-speech-classification/" class="pagination--pager" title="Speech Command Classification">Previous</a>
    
    
      <a href="/speech-tech/0004-voice-activity-detection/" class="pagination--pager" title="Voice Activity Detection (VAD)">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 1990 - 2143 <a href="https://www.arunbaby.com">Arun Baby</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0JRJPEC9SS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0JRJPEC9SS', { 'anonymize_ip': false});
</script>








  </body>
</html>
