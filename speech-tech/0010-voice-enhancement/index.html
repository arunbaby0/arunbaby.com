<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Voice Enhancement &amp; Noise Reduction - Arun Baby</title>
<meta name="description" content="Build systems that enhance voice quality by removing noise, improving intelligibility, and optimizing audio for speech applications.">


  <meta name="author" content="Arun Baby">
  
  <meta property="article:author" content="Arun Baby">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Arun Baby">
<meta property="og:title" content="Voice Enhancement &amp; Noise Reduction">
<meta property="og:url" content="https://www.arunbaby.com/speech-tech/0010-voice-enhancement/">


  <meta property="og:description" content="Build systems that enhance voice quality by removing noise, improving intelligibility, and optimizing audio for speech applications.">



  <meta property="og:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">



  <meta name="twitter:site" content="@arunbaby0">
  <meta name="twitter:title" content="Voice Enhancement &amp; Noise Reduction">
  <meta name="twitter:description" content="Build systems that enhance voice quality by removing noise, improving intelligibility, and optimizing audio for speech applications.">
  <meta name="twitter:url" content="https://www.arunbaby.com/speech-tech/0010-voice-enhancement/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">
    
  

  



  <meta property="article:published_time" content="2025-11-26T15:14:27+05:30">





  

  


<link rel="canonical" href="https://www.arunbaby.com/speech-tech/0010-voice-enhancement/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Arun Baby Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
           
          <span class="site-subtitle">Arun Baby</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/dsa/"
                
                
              >DSA</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ml-system-design/"
                
                
              >ML Systems</a>
            </li><li class="masthead__menu-item">
              <a
                href="/speech-tech/"
                
                
              >Speech Tech</a>
            </li><li class="masthead__menu-item">
              <a
                href="/publications/"
                
                
              >Publications</a>
            </li><li class="masthead__menu-item">
              <a
                href="/statuses/"
                
                
              >Statuses</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact/"
                
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main" class="no-author-sidebar">
  
  <div class="sidebar sticky">
  
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Voice Enhancement &amp; Noise Reduction">
    <meta itemprop="description" content="Build systems that enhance voice quality by removing noise, improving intelligibility, and optimizing audio for speech applications.">
    <meta itemprop="datePublished" content="2025-11-26T15:14:27+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.arunbaby.com/speech-tech/0010-voice-enhancement/" itemprop="url">Voice Enhancement &amp; Noise Reduction
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          27 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#problem-formulation">Problem Formulation</a><ul><li><a href="#inputoutput">Input/Output</a></li><li><a href="#quality-metrics">Quality Metrics</a></li></ul></li><li><a href="#classical-methods">Classical Methods</a><ul><li><a href="#1-spectral-subtraction">1. Spectral Subtraction</a></li><li><a href="#2-wiener-filtering">2. Wiener Filtering</a></li></ul></li><li><a href="#deep-learning-approaches">Deep Learning Approaches</a><ul><li><a href="#1-mask-based-enhancement">1. Mask-Based Enhancement</a></li><li><a href="#2-end-to-end-waveform-enhancement">2. End-to-End Waveform Enhancement</a></li></ul></li><li><a href="#real-time-enhancement">Real-Time Enhancement</a><ul><li><a href="#streaming-enhancement-system">Streaming Enhancement System</a></li></ul></li><li><a href="#multi-channel-enhancement">Multi-Channel Enhancement</a><ul><li><a href="#beamforming">Beamforming</a></li></ul></li><li><a href="#connection-to-caching-day-10-ml">Connection to Caching (Day 10 ML)</a></li><li><a href="#understanding-audio-enhancement-fundamentals">Understanding Audio Enhancement Fundamentals</a><ul><li><a href="#why-enhancement-is-critical">Why Enhancement is Critical</a></li><li><a href="#frequency-domain-analysis">Frequency Domain Analysis</a></li></ul></li><li><a href="#advanced-deep-learning-enhancement">Advanced Deep Learning Enhancement</a><ul><li><a href="#state-of-the-art-architectures">State-of-the-Art Architectures</a></li><li><a href="#real-time-enhancement-with-onnx">Real-Time Enhancement with ONNX</a></li></ul></li><li><a href="#production-quality-assurance">Production Quality Assurance</a><ul><li><a href="#automated-quality-metrics">Automated Quality Metrics</a></li></ul></li><li><a href="#key-takeaways">Key Takeaways</a></li></ul>
            </nav>
          </aside>
        
        <p><strong>Build systems that enhance voice quality by removing noise, improving intelligibility, and optimizing audio for speech applications.</strong></p>

<h2 id="introduction">Introduction</h2>

<p><strong>Voice enhancement</strong> improves speech quality by:</p>
<ul>
  <li>Removing background noise (traffic, wind, keyboard)</li>
  <li>Suppressing reverberation</li>
  <li>Normalizing volume levels</li>
  <li>Enhancing speech intelligibility</li>
  <li>Removing artifacts and distortion</li>
</ul>

<p><strong>Critical for:</strong></p>
<ul>
  <li>Video conferencing (Zoom, Teams, Meet)</li>
  <li>Voice assistants (Alexa, Siri, Google Assistant)</li>
  <li>Podcast/content creation</li>
  <li>Hearing aids</li>
  <li>Telecommunication</li>
  <li>Speech recognition systems</li>
</ul>

<p><strong>Key challenges:</strong></p>
<ul>
  <li>Real-time processing (&lt; 50ms latency)</li>
  <li>Preserving speech quality</li>
  <li>Handling diverse noise types</li>
  <li>Low computational cost</li>
  <li>Avoiding artifacts</li>
</ul>

<hr />

<h2 id="problem-formulation">Problem Formulation</h2>

<h3 id="inputoutput">Input/Output</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: Noisy speech signal
  y(t) = s(t) + n(t)
  where:
    s(t) = clean speech
    n(t) = noise

Output: Enhanced speech signal
  ŝ(t) ≈ s(t)
  
Goal: Minimize ‖ŝ(t) - s(t)‖ while maintaining naturalness
</code></pre></div></div>

<h3 id="quality-metrics">Quality Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">signal</span>

<span class="k">def</span> <span class="nf">calculate_snr</span><span class="p">(</span><span class="n">clean_speech</span><span class="p">,</span> <span class="n">noisy_speech</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Calculate Signal-to-Noise Ratio
    
    SNR = 10 * log10(P_signal / P_noise)
    
    Higher is better (typically 10-30 dB)
    </span><span class="sh">"""</span>
    <span class="n">signal_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">clean_speech</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">noisy_speech</span> <span class="o">-</span> <span class="n">clean_speech</span>
    <span class="n">noise_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">noise</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">noise_power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">snr</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">signal_power</span> <span class="o">/</span> <span class="n">noise_power</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">snr</span>

<span class="k">def</span> <span class="nf">calculate_pesq</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">degraded</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Calculate PESQ (Perceptual Evaluation of Speech Quality)
    
    Range: -0.5 to 4.5 (higher is better)
    Industry standard for speech quality
    </span><span class="sh">"""</span>
    <span class="kn">from</span> <span class="n">pesq</span> <span class="kn">import</span> <span class="n">pesq</span>
    
    <span class="c1"># PESQ requires 8kHz or 16kHz
</span>    <span class="k">if</span> <span class="n">sr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8000</span><span class="p">,</span> <span class="mi">16000</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">PESQ requires sr=8000 or sr=16000</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">mode</span> <span class="o">=</span> <span class="sh">'</span><span class="s">nb</span><span class="sh">'</span> <span class="k">if</span> <span class="n">sr</span> <span class="o">==</span> <span class="mi">8000</span> <span class="k">else</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span>
    <span class="n">score</span> <span class="o">=</span> <span class="nf">pesq</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">degraded</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">score</span>

<span class="k">def</span> <span class="nf">calculate_stoi</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Calculate STOI (Short-Time Objective Intelligibility)
    
    Range: 0 to 1 (higher is better)
    Correlates well with speech intelligibility
    </span><span class="sh">"""</span>
    <span class="kn">from</span> <span class="n">pystoi</span> <span class="kn">import</span> <span class="n">stoi</span>
    
    <span class="n">score</span> <span class="o">=</span> <span class="nf">stoi</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">extended</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>

<span class="c1"># Usage
</span><span class="n">clean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">16000</span><span class="p">)</span>  <span class="c1"># 1 second at 16kHz
</span><span class="n">noisy</span> <span class="o">=</span> <span class="n">clean</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">16000</span><span class="p">)</span>

<span class="n">snr</span> <span class="o">=</span> <span class="nf">calculate_snr</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">noisy</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">SNR: </span><span class="si">{</span><span class="n">snr</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> dB</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># pesq_score = calculate_pesq(clean, noisy, sr=16000)
# print(f"PESQ: {pesq_score:.2f}")
</span></code></pre></div></div>

<hr />

<h2 id="classical-methods">Classical Methods</h2>

<h3 id="1-spectral-subtraction">1. Spectral Subtraction</h3>

<p><strong>Subtract noise spectrum from noisy spectrum</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">librosa</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">SpectralSubtraction</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Classic spectral subtraction for noise reduction
    
    Steps:
    1. Estimate noise spectrum (from silence periods)
    2. Subtract from noisy spectrum
    3. Half-wave rectification
    4. Reconstruct signal
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">noise_profile</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">estimate_noise</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noise_audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Estimate noise spectrum from noise-only segment
        
        Args:
            noise_audio: Audio containing only noise
        </span><span class="sh">"""</span>
        <span class="c1"># STFT of noise
</span>        <span class="n">noise_stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">noise_audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Average magnitude spectrum
</span>        <span class="n">self</span><span class="p">.</span><span class="n">noise_profile</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">noise_stft</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">enhance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.002</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Apply spectral subtraction
        
        Args:
            noisy_audio: Noisy speech signal
            alpha: Over-subtraction factor (higher = more aggressive)
            beta: Spectral floor (prevents negative values)
        
        Returns:
            Enhanced audio
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">noise_profile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Must estimate noise first</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># STFT of noisy signal
</span>        <span class="n">noisy_stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">noisy_audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Magnitude and phase
</span>        <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">noisy_stft</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">angle</span><span class="p">(</span><span class="n">noisy_stft</span><span class="p">)</span>
        
        <span class="c1"># Spectral subtraction
</span>        <span class="n">enhanced_mag</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">noise_profile</span>
        
        <span class="c1"># Half-wave rectification with spectral floor
</span>        <span class="n">enhanced_mag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">enhanced_mag</span><span class="p">,</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span>
        
        <span class="c1"># Reconstruct with original phase
</span>        <span class="n">enhanced_stft</span> <span class="o">=</span> <span class="n">enhanced_mag</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
        
        <span class="c1"># Inverse STFT
</span>        <span class="n">enhanced_audio</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">istft</span><span class="p">(</span>
            <span class="n">enhanced_stft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">enhanced_audio</span>

<span class="c1"># Usage
</span><span class="n">sr</span> <span class="o">=</span> <span class="mi">16000</span>

<span class="c1"># Load noisy speech
</span><span class="n">noisy_speech</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">noisy_speech.wav</span><span class="sh">'</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="c1"># Estimate noise from first 0.5 seconds (assumed to be silence)
</span><span class="n">noise_segment</span> <span class="o">=</span> <span class="n">noisy_speech</span><span class="p">[:</span><span class="nf">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">sr</span><span class="p">)]</span>

<span class="n">enhancer</span> <span class="o">=</span> <span class="nc">SpectralSubtraction</span><span class="p">()</span>
<span class="n">enhancer</span><span class="p">.</span><span class="nf">estimate_noise</span><span class="p">(</span><span class="n">noise_segment</span><span class="p">)</span>

<span class="c1"># Enhance full audio
</span><span class="n">enhanced</span> <span class="o">=</span> <span class="n">enhancer</span><span class="p">.</span><span class="nf">enhance</span><span class="p">(</span><span class="n">noisy_speech</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="c1"># Save result
</span><span class="kn">import</span> <span class="n">soundfile</span> <span class="k">as</span> <span class="n">sf</span>
<span class="n">sf</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="s">enhanced_speech.wav</span><span class="sh">'</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-wiener-filtering">2. Wiener Filtering</h3>

<p><strong>Optimal filter in MMSE sense</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">WienerFilter</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Wiener filtering for speech enhancement
    
    Minimizes mean squared error between clean and enhanced speech
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">noise_psd</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">estimate_noise_psd</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noise_audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Estimate noise power spectral density</span><span class="sh">"""</span>
        <span class="n">noise_stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">noise_audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Power spectral density
</span>        <span class="n">self</span><span class="p">.</span><span class="n">noise_psd</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">noise_stft</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">enhance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">,</span> <span class="n">a_priori_snr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Apply Wiener filtering
        
        Wiener gain: H = S / (S + N)
        where S = signal PSD, N = noise PSD
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">noise_psd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Must estimate noise PSD first</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># STFT
</span>        <span class="n">noisy_stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">noisy_audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Noisy PSD
</span>        <span class="n">noisy_psd</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">noisy_stft</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        
        <span class="c1"># Estimate clean speech PSD
</span>        <span class="n">speech_psd</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">noisy_psd</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">noise_psd</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Wiener gain
</span>        <span class="n">wiener_gain</span> <span class="o">=</span> <span class="n">speech_psd</span> <span class="o">/</span> <span class="p">(</span><span class="n">speech_psd</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">noise_psd</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># Apply gain
</span>        <span class="n">enhanced_stft</span> <span class="o">=</span> <span class="n">wiener_gain</span> <span class="o">*</span> <span class="n">noisy_stft</span>
        
        <span class="c1"># Inverse STFT
</span>        <span class="n">enhanced_audio</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">istft</span><span class="p">(</span>
            <span class="n">enhanced_stft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">enhanced_audio</span>

<span class="c1"># Usage
</span><span class="n">wiener</span> <span class="o">=</span> <span class="nc">WienerFilter</span><span class="p">()</span>
<span class="n">wiener</span><span class="p">.</span><span class="nf">estimate_noise_psd</span><span class="p">(</span><span class="n">noise_segment</span><span class="p">)</span>
<span class="n">enhanced</span> <span class="o">=</span> <span class="n">wiener</span><span class="p">.</span><span class="nf">enhance</span><span class="p">(</span><span class="n">noisy_speech</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="deep-learning-approaches">Deep Learning Approaches</h2>

<h3 id="1-mask-based-enhancement">1. Mask-Based Enhancement</h3>

<p><strong>Learn ideal ratio mask (IRM) or ideal binary mask (IBM)</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">MaskEstimationNet</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Neural network for mask estimation
    
    Predicts time-frequency mask to apply to noisy spectrogram
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">n_freq</span> <span class="o">=</span> <span class="n">n_fft</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="c1"># Bidirectional LSTM
</span>        <span class="n">self</span><span class="p">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">LSTM</span><span class="p">(</span>
            <span class="n">input_size</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_freq</span><span class="p">,</span>
            <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_dim</span><span class="p">,</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">batch_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">bidirectional</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Mask prediction
</span>        <span class="n">self</span><span class="p">.</span><span class="n">mask_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_freq</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Sigmoid</span><span class="p">()</span>  <span class="c1"># Mask values in [0, 1]
</span>        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noisy_mag</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            noisy_mag: Noisy magnitude spectrogram [batch, time, freq]
        
        Returns:
            mask: Predicted mask [batch, time, freq]
        </span><span class="sh">"""</span>
        <span class="c1"># LSTM
</span>        <span class="n">lstm_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">lstm</span><span class="p">(</span><span class="n">noisy_mag</span><span class="p">)</span>
        
        <span class="c1"># Predict mask
</span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">mask_fc</span><span class="p">(</span><span class="n">lstm_out</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">mask</span>

<span class="k">class</span> <span class="nc">MaskBasedEnhancer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Speech enhancement using learned mask
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">n_fft</span> <span class="o">=</span> <span class="n">n_fft</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hop_length</span> <span class="o">=</span> <span class="n">hop_length</span>
    
    <span class="k">def</span> <span class="nf">enhance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Enhance audio using learned mask
        
        Steps:
        1. Compute noisy spectrogram
        2. Predict mask with neural network
        3. Apply mask
        4. Reconstruct audio
        </span><span class="sh">"""</span>
        <span class="c1"># STFT
</span>        <span class="n">noisy_stft</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span>
            <span class="n">noisy_audio</span><span class="p">,</span>
            <span class="n">n_fft</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">n_fft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="c1"># Magnitude and phase
</span>        <span class="n">noisy_mag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">noisy_stft</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">angle</span><span class="p">(</span><span class="n">noisy_stft</span><span class="p">)</span>
        
        <span class="c1"># Normalize magnitude
</span>        <span class="n">mag_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">noisy_mag</span><span class="p">)</span>
        <span class="n">mag_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">noisy_mag</span><span class="p">)</span>
        <span class="n">noisy_mag_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">noisy_mag</span> <span class="o">-</span> <span class="n">mag_mean</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mag_std</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="c1"># Predict mask
</span>        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
            <span class="c1"># Transpose to [1, time, freq]
</span>            <span class="n">mag_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">noisy_mag_norm</span><span class="p">.</span><span class="n">T</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="n">mask</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="n">mag_tensor</span><span class="p">)</span>
            
            <span class="c1"># Back to numpy
</span>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">numpy</span><span class="p">().</span><span class="n">T</span>
        
        <span class="c1"># Apply mask
</span>        <span class="n">enhanced_mag</span> <span class="o">=</span> <span class="n">noisy_mag</span> <span class="o">*</span> <span class="n">mask</span>
        
        <span class="c1"># Reconstruct
</span>        <span class="n">enhanced_stft</span> <span class="o">=</span> <span class="n">enhanced_mag</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">enhanced_audio</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">istft</span><span class="p">(</span>
            <span class="n">enhanced_stft</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">hop_length</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">enhanced_audio</span>

<span class="c1"># Usage
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">MaskEstimationNet</span><span class="p">(</span><span class="n">n_fft</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span class="n">enhancer</span> <span class="o">=</span> <span class="nc">MaskBasedEnhancer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Enhance
</span><span class="n">enhanced</span> <span class="o">=</span> <span class="n">enhancer</span><span class="p">.</span><span class="nf">enhance</span><span class="p">(</span><span class="n">noisy_speech</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-end-to-end-waveform-enhancement">2. End-to-End Waveform Enhancement</h3>

<p><strong>Direct waveform→waveform mapping</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ConvTasNet</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Conv-TasNet for speech enhancement
    
    End-to-end time-domain speech separation
    Based on: </span><span class="sh">"</span><span class="s">Conv-TasNet: Surpassing Ideal Time-Frequency Masking</span><span class="sh">"</span><span class="s">
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            N: Number of filters in autoencoder
            L: Length of filters (ms)
            B: Number of channels in bottleneck
            H: Number of channels in conv blocks
            P: Kernel size in conv blocks
            X: Number of conv blocks in each repeat
            R: Number of repeats
        </span><span class="sh">"""</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="c1"># Encoder (waveform → features)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Separator (TCN blocks)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_build_separator</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        
        <span class="c1"># Decoder (features → waveform)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ConvTranspose1d</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_build_separator</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Build temporal convolutional network</span><span class="sh">"""</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Layer normalization
</span>        <span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">LayerNorm</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        
        <span class="c1"># Bottleneck
</span>        <span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># TCN blocks
</span>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
                <span class="n">dilation</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">x</span>
                <span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                    <span class="nc">TemporalConvBlock</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dilation</span><span class="p">)</span>
                <span class="p">)</span>
        
        <span class="c1"># Output projection
</span>        <span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">())</span>
        <span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mixture</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            mixture: Noisy waveform [batch, 1, samples]
        
        Returns:
            estimated_clean: Enhanced waveform [batch, 1, samples]
        </span><span class="sh">"""</span>
        <span class="c1"># Encode
</span>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">encoder</span><span class="p">(</span><span class="n">mixture</span><span class="p">)</span>  <span class="c1"># [batch, N, T]
</span>        
        <span class="c1"># Separate
</span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">separator</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>  <span class="c1"># [batch, N, T]
</span>        
        <span class="c1"># Apply mask
</span>        <span class="n">separated</span> <span class="o">=</span> <span class="n">encoded</span> <span class="o">*</span> <span class="n">mask</span>
        
        <span class="c1"># Decode
</span>        <span class="n">estimated</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">decoder</span><span class="p">(</span><span class="n">separated</span><span class="p">)</span>  <span class="c1"># [batch, 1, samples]
</span>        
        <span class="k">return</span> <span class="n">estimated</span>

<span class="k">class</span> <span class="nc">TemporalConvBlock</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Temporal convolutional block with dilated convolutions
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">hidden_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">dilation</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span>
            <span class="n">in_channels</span><span class="p">,</span> <span class="n">hidden_channels</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="n">dilation</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">dilation</span> <span class="o">*</span> <span class="p">(</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">prelu1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">GroupNorm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_channels</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span>
            <span class="n">hidden_channels</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span>
            <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">prelu2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">GroupNorm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            x: [batch, channels, time]
        </span><span class="sh">"""</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">x</span>
        
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prelu1</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm1</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">conv2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prelu2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="n">residual</span>

<span class="c1"># Usage
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">ConvTasNet</span><span class="p">()</span>
<span class="n">noisy_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>  <span class="c1"># 1 second
</span><span class="n">enhanced_tensor</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">noisy_tensor</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="real-time-enhancement">Real-Time Enhancement</h2>

<h3 id="streaming-enhancement-system">Streaming Enhancement System</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span> <span class="nc">StreamingEnhancer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Real-time streaming speech enhancement
    
    Requirements:
    - Low latency (&lt; 50ms)
    - Causal processing
    - Minimal buffering
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            chunk_size: Samples per chunk
            overlap: Overlap between chunks (for smooth transitions)
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
        <span class="n">self</span><span class="p">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        
        <span class="c1"># Circular buffer for overlap-add
</span>        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">overlap</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">overlap</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">processed_chunks</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">process_chunk</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_chunk</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Process single audio chunk
        
        Args:
            audio_chunk: Audio samples [chunk_size]
        
        Returns:
            Enhanced audio chunk
        </span><span class="sh">"""</span>
        <span class="c1"># Add previous overlap
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">input_chunk</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span>
                <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">),</span>
                <span class="n">audio_chunk</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_chunk</span> <span class="o">=</span> <span class="n">audio_chunk</span>
        
        <span class="c1"># Enhance
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_enhance_chunk</span><span class="p">(</span><span class="n">input_chunk</span><span class="p">)</span>
        
        <span class="c1"># Overlap-add with linear cross-fade
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Smooth transition
</span>            <span class="n">overlap_region</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">overlap</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">overlap_region</span><span class="p">):</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">overlap_region</span>
                <span class="n">enhanced</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">enhanced</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="c1"># Save overlap for next chunk
</span>        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">[</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">overlap</span><span class="p">:])</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">output_buffer</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">enhanced</span><span class="p">[</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">overlap</span><span class="p">:])</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">processed_chunks</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Return non-overlap part
</span>        <span class="k">return</span> <span class="n">enhanced</span><span class="p">[:</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">overlap</span><span class="p">]</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">enhanced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">overlap</span> <span class="k">else</span> <span class="n">enhanced</span>
    
    <span class="k">def</span> <span class="nf">_enhance_chunk</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_chunk</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Enhance using model</span><span class="sh">"""</span>
        <span class="c1"># Convert to tensor
</span>        <span class="n">audio_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Enhance
</span>        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
            <span class="n">enhanced_tensor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="n">audio_tensor</span><span class="p">)</span>
        
        <span class="c1"># Back to numpy
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">enhanced_tensor</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">().</span><span class="nf">numpy</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">enhanced</span>
    
    <span class="k">def</span> <span class="nf">get_latency_ms</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate processing latency</span><span class="sh">"""</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chunk_size</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>

<span class="c1"># Usage for real-time processing
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">ConvTasNet</span><span class="p">()</span>
<span class="n">enhancer</span> <span class="o">=</span> <span class="nc">StreamingEnhancer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Latency: </span><span class="si">{</span><span class="n">enhancer</span><span class="p">.</span><span class="nf">get_latency_ms</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> ms</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Process audio stream
</span><span class="kn">import</span> <span class="n">sounddevice</span> <span class="k">as</span> <span class="n">sd</span>

<span class="k">def</span> <span class="nf">audio_callback</span><span class="p">(</span><span class="n">indata</span><span class="p">,</span> <span class="n">outdata</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Real-time audio callback</span><span class="sh">"""</span>
    <span class="c1"># Get input chunk
</span>    <span class="n">input_chunk</span> <span class="o">=</span> <span class="n">indata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Enhance
</span>    <span class="n">enhanced_chunk</span> <span class="o">=</span> <span class="n">enhancer</span><span class="p">.</span><span class="nf">process_chunk</span><span class="p">(</span><span class="n">input_chunk</span><span class="p">)</span>
    
    <span class="c1"># Output
</span>    <span class="n">outdata</span><span class="p">[:</span><span class="nf">len</span><span class="p">(</span><span class="n">enhanced_chunk</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">enhanced_chunk</span>
    
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Start real-time processing
</span><span class="k">with</span> <span class="n">sd</span><span class="p">.</span><span class="nc">Stream</span><span class="p">(</span>
    <span class="n">samplerate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
    <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">audio_callback</span><span class="p">,</span>
    <span class="n">blocksize</span><span class="o">=</span><span class="mi">512</span>
<span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Processing audio in real-time... Press Ctrl+C to stop</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">sd</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="multi-channel-enhancement">Multi-Channel Enhancement</h2>

<h3 id="beamforming">Beamforming</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BeamformerEnhancer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Beamforming for multi-microphone enhancement
    
    Uses spatial information to enhance target speech
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_mics</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_mics</span> <span class="o">=</span> <span class="n">n_mics</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
    
    <span class="k">def</span> <span class="nf">delay_and_sum</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">multi_channel_audio</span><span class="p">,</span> <span class="n">target_direction</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Delay-and-sum beamforming
        
        Args:
            multi_channel_audio: [n_mics, n_samples]
            target_direction: Target angle in degrees (0 = front)
        
        Returns:
            Enhanced single-channel audio
        </span><span class="sh">"""</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="n">multi_channel_audio</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Calculate delays for each microphone
</span>        <span class="c1"># (Simplified: assumes linear array)
</span>        <span class="n">mic_spacing</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># 5cm between mics
</span>        <span class="n">speed_of_sound</span> <span class="o">=</span> <span class="mi">343</span>  <span class="c1"># m/s
</span>        
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_mics</span><span class="p">):</span>
            <span class="n">distance_diff</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">mic_spacing</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">deg2rad</span><span class="p">(</span><span class="n">target_direction</span><span class="p">))</span>
            <span class="n">delay_samples</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">distance_diff</span> <span class="o">/</span> <span class="n">speed_of_sound</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
            <span class="n">delays</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">delay_samples</span><span class="p">)</span>
        
        <span class="c1"># Align and sum
</span>        <span class="n">aligned_signals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">delay</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">delays</span><span class="p">):</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">multi_channel_audio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Delay by pre-pending zeros
</span>                <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sig</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">sig</span><span class="p">])</span>
                <span class="n">aligned</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[:</span><span class="n">n_samples</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Advance by removing first samples
</span>                <span class="n">aligned</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="o">-</span><span class="n">delay</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">aligned</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">n_samples</span><span class="p">:</span>
                    <span class="n">aligned</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">pad</span><span class="p">(</span><span class="n">aligned</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">-</span> <span class="n">aligned</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">constant</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aligned</span> <span class="o">=</span> <span class="n">sig</span>
            <span class="n">aligned_signals</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">aligned</span><span class="p">)</span>
        
        <span class="c1"># Sum aligned signals
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">aligned_signals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">enhanced</span>
    
    <span class="k">def</span> <span class="nf">mvdr_beamformer</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">multi_channel_audio</span><span class="p">,</span> <span class="n">noise_segment</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        MVDR (Minimum Variance Distortionless Response) beamformer
        
        Optimal beamformer for known noise covariance
        </span><span class="sh">"""</span>
        <span class="c1"># Compute noise covariance matrix
</span>        <span class="n">noise_cov</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_covariance</span><span class="p">(</span><span class="n">noise_segment</span><span class="p">)</span>
        
        <span class="c1"># Compute signal+noise covariance
</span>        <span class="n">signal_noise_cov</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_covariance</span><span class="p">(</span><span class="n">multi_channel_audio</span><span class="p">)</span>
        
        <span class="c1"># MVDR weights
</span>        <span class="c1"># w = R_n^{-1} * a / (a^H * R_n^{-1} * a)
</span>        <span class="c1"># where a is steering vector
</span>        
        <span class="c1"># Simplified: assume steering vector points to channel 0
</span>        <span class="n">steering_vector</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">n_mics</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">steering_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1"># Compute weights
</span>        <span class="n">inv_noise_cov</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">pinv</span><span class="p">(</span><span class="n">noise_cov</span><span class="p">)</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">inv_noise_cov</span> <span class="o">@</span> <span class="n">steering_vector</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">steering_vector</span><span class="p">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">inv_noise_cov</span> <span class="o">@</span> <span class="n">steering_vector</span>
        
        <span class="n">weights</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># Apply weights
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">weights</span><span class="p">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">multi_channel_audio</span>
        
        <span class="k">return</span> <span class="n">enhanced</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_compute_covariance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute covariance matrix</span><span class="sh">"""</span>
        <span class="c1"># [n_mics, n_samples] → [n_mics, n_mics]
</span>        <span class="n">cov</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">@</span> <span class="n">signal</span><span class="p">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">signal</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cov</span>

<span class="c1"># Usage
</span><span class="n">beamformer</span> <span class="o">=</span> <span class="nc">BeamformerEnhancer</span><span class="p">(</span><span class="n">n_mics</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

<span class="c1"># Multi-channel recording
</span><span class="n">multi_ch_audio</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>  <span class="c1"># 4 mics, 1 second
</span>
<span class="c1"># Enhance using delay-and-sum
</span><span class="n">enhanced_ds</span> <span class="o">=</span> <span class="n">beamformer</span><span class="p">.</span><span class="nf">delay_and_sum</span><span class="p">(</span><span class="n">multi_ch_audio</span><span class="p">,</span> <span class="n">target_direction</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Or using MVDR
</span><span class="n">noise_segment</span> <span class="o">=</span> <span class="n">multi_ch_audio</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">8000</span><span class="p">]</span>  <span class="c1"># First 0.5 seconds
</span><span class="n">enhanced_mvdr</span> <span class="o">=</span> <span class="n">beamformer</span><span class="p">.</span><span class="nf">mvdr_beamformer</span><span class="p">(</span><span class="n">multi_ch_audio</span><span class="p">,</span> <span class="n">noise_segment</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="connection-to-caching-day-10-ml">Connection to Caching (Day 10 ML)</h2>

<p>Voice enhancement benefits from caching strategies:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EnhancementCache</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Cache enhanced audio segments
    
    Connection to Day 10 ML:
    - Cache expensive enhancement operations
    - LRU for frequently accessed segments
    - TTL for time-sensitive applications
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache</span> <span class="o">=</span> <span class="nc">OrderedDict</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">misses</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">get_enhanced</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_segment</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Get enhanced audio with caching
        
        Args:
            audio_segment: Raw audio
            model: Enhancement model
        
        Returns:
            Enhanced audio
        </span><span class="sh">"""</span>
        <span class="c1"># Create cache key (hash of audio)
</span>        <span class="n">cache_key</span> <span class="o">=</span> <span class="nf">hash</span><span class="p">(</span><span class="n">audio_segment</span><span class="p">.</span><span class="nf">tobytes</span><span class="p">())</span>
        
        <span class="c1"># Check cache
</span>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">.</span><span class="nf">move_to_end</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>  <span class="c1"># Mark as recently used
</span>            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
        
        <span class="c1"># Compute enhancement
</span>        <span class="n">self</span><span class="p">.</span><span class="n">misses</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">enhance</span><span class="p">(</span><span class="n">audio_segment</span><span class="p">)</span>
        
        <span class="c1"># Cache result
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">enhanced</span>
        
        <span class="c1"># Evict if over capacity
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">capacity</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">.</span><span class="nf">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">enhanced</span>
    
    <span class="k">def</span> <span class="nf">get_hit_rate</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate cache hit rate</span><span class="sh">"""</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">hits</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">misses</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">hits</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Usage
</span><span class="n">cache</span> <span class="o">=</span> <span class="nc">EnhancementCache</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConvTasNet</span><span class="p">()</span>

<span class="c1"># Process with caching
</span><span class="k">for</span> <span class="n">audio_segment</span> <span class="ow">in</span> <span class="n">audio_stream</span><span class="p">:</span>
    <span class="n">enhanced</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="nf">get_enhanced</span><span class="p">(</span><span class="n">audio_segment</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Cache hit rate: </span><span class="si">{</span><span class="n">cache</span><span class="p">.</span><span class="nf">get_hit_rate</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="understanding-audio-enhancement-fundamentals">Understanding Audio Enhancement Fundamentals</h2>

<h3 id="why-enhancement-is-critical">Why Enhancement is Critical</h3>

<p>Voice enhancement is the foundation of any production speech system. Poor audio quality cascades through the entire pipeline:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AudioQualityImpactAnalyzer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Analyze impact of audio quality on downstream tasks
    
    Demonstrates how SNR affects ASR accuracy, speaker recognition, etc.
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">asr_model</span><span class="p">,</span> <span class="n">speaker_model</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">asr_model</span> <span class="o">=</span> <span class="n">asr_model</span>
        <span class="n">self</span><span class="p">.</span><span class="n">speaker_model</span> <span class="o">=</span> <span class="n">speaker_model</span>
    
    <span class="k">def</span> <span class="nf">evaluate_quality_impact</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">clean_audio</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">,</span> <span class="n">transcript</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compare performance on clean vs noisy audio
        
        Returns:
            Dictionary with metrics for both conditions
        </span><span class="sh">"""</span>
        <span class="c1"># ASR on clean audio
</span>        <span class="n">clean_prediction</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">asr_model</span><span class="p">.</span><span class="nf">transcribe</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">)</span>
        <span class="n">clean_wer</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_wer</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">clean_prediction</span><span class="p">)</span>
        
        <span class="c1"># ASR on noisy audio
</span>        <span class="n">noisy_prediction</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">asr_model</span><span class="p">.</span><span class="nf">transcribe</span><span class="p">(</span><span class="n">noisy_audio</span><span class="p">)</span>
        <span class="n">noisy_wer</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_wer</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">noisy_prediction</span><span class="p">)</span>
        
        <span class="c1"># Speaker embedding quality
</span>        <span class="n">clean_embedding</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">speaker_model</span><span class="p">.</span><span class="nf">extract_embedding</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">)</span>
        <span class="n">noisy_embedding</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">speaker_model</span><span class="p">.</span><span class="nf">extract_embedding</span><span class="p">(</span><span class="n">noisy_audio</span><span class="p">)</span>
        
        <span class="c1"># Embedding similarity (should be close for same speaker)
</span>        <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">clean_embedding</span><span class="p">,</span> <span class="n">noisy_embedding</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">clean_embedding</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">noisy_embedding</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Calculate SNR
</span>        <span class="n">snr_db</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_snr</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">snr_db</span><span class="sh">'</span><span class="p">:</span> <span class="n">snr_db</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">clean_wer</span><span class="sh">'</span><span class="p">:</span> <span class="n">clean_wer</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">noisy_wer</span><span class="sh">'</span><span class="p">:</span> <span class="n">noisy_wer</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">wer_degradation</span><span class="sh">'</span><span class="p">:</span> <span class="n">noisy_wer</span> <span class="o">-</span> <span class="n">clean_wer</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">embedding_similarity</span><span class="sh">'</span><span class="p">:</span> <span class="n">similarity</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">relative_performance</span><span class="sh">'</span><span class="p">:</span> <span class="n">clean_wer</span> <span class="o">/</span> <span class="n">noisy_wer</span> <span class="k">if</span> <span class="n">noisy_wer</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_calculate_wer</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate Word Error Rate</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">editdistance</span>
        
        <span class="n">ref_words</span> <span class="o">=</span> <span class="n">reference</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">split</span><span class="p">()</span>
        <span class="n">hyp_words</span> <span class="o">=</span> <span class="n">hypothesis</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">split</span><span class="p">()</span>
        
        <span class="n">distance</span> <span class="o">=</span> <span class="n">editdistance</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">ref_words</span><span class="p">,</span> <span class="n">hyp_words</span><span class="p">)</span>
        <span class="n">wer</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">ref_words</span><span class="p">)</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">ref_words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">wer</span>
    
    <span class="k">def</span> <span class="nf">_calculate_snr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">clean</span><span class="p">,</span> <span class="n">noisy</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate Signal-to-Noise Ratio</span><span class="sh">"""</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">noisy</span> <span class="o">-</span> <span class="n">clean</span>
        
        <span class="n">signal_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">clean</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">noise_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">noise</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">noise_power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">snr</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">signal_power</span> <span class="o">/</span> <span class="n">noise_power</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">snr</span>

<span class="c1"># Demo impact analysis
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">AUDIO QUALITY IMPACT ANALYSIS</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># Simulate different SNR levels
</span><span class="n">snr_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="k">for</span> <span class="n">snr_target</span> <span class="ow">in</span> <span class="n">snr_levels</span><span class="p">:</span>
    <span class="c1"># Add noise at specific SNR
</span>    <span class="n">noisy</span> <span class="o">=</span> <span class="nf">add_noise_at_snr</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">snr_target</span><span class="p">)</span>
    
    <span class="c1"># Evaluate
</span>    <span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">evaluate_quality_impact</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">,</span> <span class="n">noisy</span><span class="p">,</span> <span class="n">transcript</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">SNR: </span><span class="si">{</span><span class="n">snr_target</span><span class="si">}</span><span class="s"> dB</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  WER (clean):  </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">clean_wer</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  WER (noisy):  </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">noisy_wer</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Degradation:  </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">wer_degradation</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Speaker Sim:  </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">embedding_similarity</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="frequency-domain-analysis">Frequency Domain Analysis</h3>

<p>Understanding audio in frequency domain is crucial for enhancement:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FrequencyDomainAnalyzer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Analyze and visualize audio in frequency domain
    
    Essential for understanding what noise reduction does
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
    
    <span class="k">def</span> <span class="nf">analyze_spectrum</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute and visualize spectrum
        
        Returns:
            frequencies, magnitudes, phases
        </span><span class="sh">"""</span>
        <span class="c1"># Compute FFT
</span>        <span class="n">n_fft</span> <span class="o">=</span> <span class="mi">2048</span>
        <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">rfft</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>
        
        <span class="c1"># Magnitude and phase
</span>        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">angle</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>
        
        <span class="c1"># Frequency bins
</span>        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">rfftfreq</span><span class="p">(</span><span class="n">n_fft</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">sr</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">phase</span>
    
    <span class="k">def</span> <span class="nf">compare_spectra</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">clean</span><span class="p">,</span> <span class="n">noisy</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compare spectra before and after enhancement
        </span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
        
        <span class="c1"># Compute spectra
</span>        <span class="n">freq_clean</span><span class="p">,</span> <span class="n">mag_clean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_spectrum</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
        <span class="n">freq_noisy</span><span class="p">,</span> <span class="n">mag_noisy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_spectrum</span><span class="p">(</span><span class="n">noisy</span><span class="p">)</span>
        <span class="n">freq_enhanced</span><span class="p">,</span> <span class="n">mag_enhanced</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_spectrum</span><span class="p">(</span><span class="n">enhanced</span><span class="p">)</span>
        
        <span class="c1"># Plot
</span>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Clean
</span>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">freq_clean</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">mag_clean</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">))</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Clean Audio Spectrum</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Magnitude (dB)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Noisy
</span>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">freq_noisy</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">mag_noisy</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Noisy Audio Spectrum</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Magnitude (dB)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Enhanced
</span>        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">freq_enhanced</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">mag_enhanced</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Enhanced Audio Spectrum</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency (Hz)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Magnitude (dB)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">'</span><span class="s">spectrum_comparison.png</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">compute_spectral_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute spectral features for quality assessment
        </span><span class="sh">"""</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_spectrum</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Spectral centroid
</span>        <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">freq</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
        
        <span class="c1"># Spectral bandwidth
</span>        <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(((</span><span class="n">freq</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">mag</span><span class="p">))</span>
        
        <span class="c1"># Spectral flatness (Wiener entropy)
</span>        <span class="n">geometric_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">mag</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)))</span>
        <span class="n">arithmetic_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
        <span class="n">flatness</span> <span class="o">=</span> <span class="n">geometric_mean</span> <span class="o">/</span> <span class="n">arithmetic_mean</span>
        
        <span class="c1"># Spectral rolloff (95% of energy)
</span>        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
        <span class="n">rolloff_idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">cumsum</span> <span class="o">&gt;=</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">cumsum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rolloff</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">rolloff_idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">centroid_hz</span><span class="sh">'</span><span class="p">:</span> <span class="n">centroid</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">bandwidth_hz</span><span class="sh">'</span><span class="p">:</span> <span class="n">bandwidth</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">flatness</span><span class="sh">'</span><span class="p">:</span> <span class="n">flatness</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">rolloff_hz</span><span class="sh">'</span><span class="p">:</span> <span class="n">rolloff</span>
        <span class="p">}</span>

<span class="c1"># Usage
</span><span class="n">analyzer</span> <span class="o">=</span> <span class="nc">FrequencyDomainAnalyzer</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

<span class="c1"># Analyze audio
</span><span class="n">features</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">compute_spectral_features</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Spectral Features:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Centroid:   </span><span class="si">{</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">centroid_hz</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> Hz</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Bandwidth:  </span><span class="si">{</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">bandwidth_hz</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> Hz</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Flatness:   </span><span class="si">{</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">flatness</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Rolloff:    </span><span class="si">{</span><span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">rolloff_hz</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> Hz</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Compare before/after
</span><span class="n">analyzer</span><span class="p">.</span><span class="nf">compare_spectra</span><span class="p">(</span><span class="n">clean_audio</span><span class="p">,</span> <span class="n">noisy_audio</span><span class="p">,</span> <span class="n">enhanced_audio</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="advanced-deep-learning-enhancement">Advanced Deep Learning Enhancement</h2>

<h3 id="state-of-the-art-architectures">State-of-the-Art Architectures</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ConvTasNetEnhancer</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Conv-TasNet for speech enhancement
    
    Architecture:
    1. Encoder: Waveform → Feature representation
    2. Separator: Mask estimation using temporal convolutions
    3. Decoder: Masked features → Enhanced waveform
    
    Advantages over STFT-based methods:
    - Operates on raw waveform
    - Learnable basis functions
    - Better phase reconstruction
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">n_src</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">n_filters</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">n_blocks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">bn_chan</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">hid_chan</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">skip_chan</span><span class="o">=</span><span class="mi">128</span>
    <span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="c1"># Encoder: 1D conv
</span>        <span class="n">self</span><span class="p">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">n_filters</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">kernel_size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="p">)</span>
        
        <span class="c1"># Separator: TCN blocks
</span>        <span class="n">self</span><span class="p">.</span><span class="n">separator</span> <span class="o">=</span> <span class="nc">TemporalConvNet</span><span class="p">(</span>
            <span class="n">n_filters</span><span class="p">,</span>
            <span class="n">n_src</span><span class="p">,</span>
            <span class="n">n_blocks</span><span class="o">=</span><span class="n">n_blocks</span><span class="p">,</span>
            <span class="n">n_repeats</span><span class="o">=</span><span class="n">n_repeats</span><span class="p">,</span>
            <span class="n">bn_chan</span><span class="o">=</span><span class="n">bn_chan</span><span class="p">,</span>
            <span class="n">hid_chan</span><span class="o">=</span><span class="n">hid_chan</span><span class="p">,</span>
            <span class="n">skip_chan</span><span class="o">=</span><span class="n">skip_chan</span>
        <span class="p">)</span>
        
        <span class="c1"># Decoder: 1D transposed conv
</span>        <span class="n">self</span><span class="p">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ConvTranspose1d</span><span class="p">(</span>
            <span class="n">n_filters</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">kernel_size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">waveform</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Enhance waveform
        
        Args:
            waveform: [batch, time]
        
        Returns:
            enhanced: [batch, time]
        </span><span class="sh">"""</span>
        <span class="c1"># Add channel dimension
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [batch, 1, time]
</span>        
        <span class="c1"># Encode
</span>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># [batch, n_filters, time']
</span>        
        <span class="c1"># Separate (estimate mask)
</span>        <span class="n">masks</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">separator</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>  <span class="c1"># [batch, n_src, n_filters, time']
</span>        
        <span class="c1"># Apply mask
</span>        <span class="n">masked</span> <span class="o">=</span> <span class="n">encoded</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">masks</span>  <span class="c1"># [batch, n_src, n_filters, time']
</span>        
        <span class="c1"># Decode
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">decoder</span><span class="p">(</span><span class="n">masked</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># [batch, 1, time]
</span>        
        <span class="c1"># Remove channel dimension
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">enhanced</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [batch, time]
</span>        
        <span class="c1"># Trim to original length
</span>        <span class="k">if</span> <span class="n">enhanced</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">waveform</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">enhanced</span> <span class="o">=</span> <span class="n">enhanced</span><span class="p">[...,</span> <span class="p">:</span><span class="n">waveform</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="n">enhanced</span>

<span class="k">class</span> <span class="nc">TemporalConvNet</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Temporal Convolutional Network for Conv-TasNet
    
    Stack of dilated conv blocks with skip connections
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">n_filters</span><span class="p">,</span>
        <span class="n">n_src</span><span class="p">,</span>
        <span class="n">n_blocks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">bn_chan</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">hid_chan</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
        <span class="n">skip_chan</span><span class="o">=</span><span class="mi">128</span>
    <span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="c1"># Layer norm
</span>        <span class="n">self</span><span class="p">.</span><span class="n">layer_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">GroupNorm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_filters</span><span class="p">)</span>
        
        <span class="c1"># Bottleneck
</span>        <span class="n">self</span><span class="p">.</span><span class="n">bottleneck</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">n_filters</span><span class="p">,</span> <span class="n">bn_chan</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># TCN blocks
</span>        <span class="n">self</span><span class="p">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ModuleList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_repeats</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">):</span>
                <span class="n">dilation</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">b</span>
                <span class="n">self</span><span class="p">.</span><span class="n">blocks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                    <span class="nc">TCNBlock</span><span class="p">(</span>
                        <span class="n">bn_chan</span><span class="p">,</span>
                        <span class="n">hid_chan</span><span class="p">,</span>
                        <span class="n">skip_chan</span><span class="p">,</span>
                        <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">dilation</span><span class="o">=</span><span class="n">dilation</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        
        <span class="c1"># Output
</span>        <span class="n">self</span><span class="p">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">skip_chan</span><span class="p">,</span> <span class="n">n_filters</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Sigmoid</span><span class="p">()</span>  <span class="c1"># Mask should be [0, 1]
</span>        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            x: [batch, n_filters, time]
        
        Returns:
            masks: [batch, n_src, n_filters, time]
        </span><span class="sh">"""</span>
        <span class="c1"># Normalize
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">layer_norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Bottleneck
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">bottleneck</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># [batch, bn_chan, time]
</span>        
        <span class="c1"># Accumulate skip connections
</span>        <span class="n">skip_sum</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">blocks</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">skip</span> <span class="o">=</span> <span class="nf">block</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">skip_sum</span> <span class="o">=</span> <span class="n">skip_sum</span> <span class="o">+</span> <span class="n">skip</span>
        
        <span class="c1"># Output mask
</span>        <span class="n">masks</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">output</span><span class="p">(</span><span class="n">skip_sum</span><span class="p">)</span>
        
        <span class="c1"># Unsqueeze for n_src dimension
</span>        <span class="n">masks</span> <span class="o">=</span> <span class="n">masks</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [batch, 1, n_filters, time]
</span>        
        <span class="k">return</span> <span class="n">masks</span>

<span class="k">class</span> <span class="nc">TCNBlock</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Single TCN block with dilated convolution</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">in_chan</span><span class="p">,</span> <span class="n">hid_chan</span><span class="p">,</span> <span class="n">skip_chan</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span>
            <span class="n">in_chan</span><span class="p">,</span>
            <span class="n">hid_chan</span><span class="p">,</span>
            <span class="mi">1</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">prelu1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">GroupNorm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hid_chan</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">depthwise_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span>
            <span class="n">hid_chan</span><span class="p">,</span>
            <span class="n">hid_chan</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dilation</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">dilation</span><span class="o">=</span><span class="n">dilation</span><span class="p">,</span>
            <span class="n">groups</span><span class="o">=</span><span class="n">hid_chan</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">prelu2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">PReLU</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">GroupNorm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hid_chan</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">hid_chan</span><span class="p">,</span> <span class="n">in_chan</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">skip_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">hid_chan</span><span class="p">,</span> <span class="n">skip_chan</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            x: [batch, in_chan, time]
        
        Returns:
            output: [batch, in_chan, time]
            skip: [batch, skip_chan, time]
        </span><span class="sh">"""</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">x</span>
        
        <span class="c1"># 1x1 conv
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prelu1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Depthwise conv
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">depthwise_conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prelu2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">norm2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Skip connection
</span>        <span class="n">skip</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">skip_conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Output
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Residual
</span>        <span class="n">output</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">residual</span>
        
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">skip</span>

<span class="c1"># Training Conv-TasNet
</span><span class="k">class</span> <span class="nc">ConvTasNetTrainer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Train Conv-TasNet for speech enhancement
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="sh">'</span><span class="s">cuda</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        
        <span class="c1"># Optimizer
</span>        <span class="n">self</span><span class="p">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span>
            <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span>
        <span class="p">)</span>
        
        <span class="c1"># Learning rate scheduler
</span>        <span class="n">self</span><span class="p">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="nc">ReduceLROnPlateau</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">patience</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Train one epoch</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">train</span><span class="p">()</span>
        
        <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">noisy</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
            <span class="n">noisy</span> <span class="o">=</span> <span class="n">noisy</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">clean</span> <span class="o">=</span> <span class="n">clean</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
            
            <span class="c1"># Forward
</span>            <span class="n">enhanced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="n">noisy</span><span class="p">)</span>
            
            <span class="c1"># Loss: SI-SNR (Scale-Invariant SNR)
</span>            <span class="n">loss</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_si_snr_loss</span><span class="p">(</span><span class="n">enhanced</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span>
            
            <span class="c1"># Backward
</span>            <span class="n">self</span><span class="p">.</span><span class="n">optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>
            <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>
            
            <span class="c1"># Gradient clipping
</span>            <span class="n">torch</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="nf">clip_grad_norm_</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">max_norm</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
            
            <span class="n">self</span><span class="p">.</span><span class="n">optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
            
            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Batch </span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_si_snr_loss</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">estimate</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Scale-Invariant Signal-to-Noise Ratio loss
        
        Better than MSE for speech enhancement
        </span><span class="sh">"""</span>
        <span class="c1"># Zero-mean
</span>        <span class="n">estimate_zm</span> <span class="o">=</span> <span class="n">estimate</span> <span class="o">-</span> <span class="n">estimate</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">target_zm</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">target</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># &lt;s', s&gt;s / ||s||^2
</span>        <span class="n">dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">estimate_zm</span> <span class="o">*</span> <span class="n">target_zm</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">target_energy</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_zm</span> <span class="o">**</span> <span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">dot</span> <span class="o">*</span> <span class="n">target_zm</span> <span class="o">/</span> <span class="p">(</span><span class="n">target_energy</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="c1"># Noise
</span>        <span class="n">noise</span> <span class="o">=</span> <span class="n">estimate_zm</span> <span class="o">-</span> <span class="n">projection</span>
        
        <span class="c1"># SI-SNR
</span>        <span class="n">si_snr</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">torch</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span>
            <span class="p">(</span><span class="n">projection</span> <span class="o">**</span> <span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">noise</span> <span class="o">**</span> <span class="mi">2</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-8</span>
        <span class="p">)</span>
        
        <span class="c1"># Negative for loss (we want to maximize SI-SNR)
</span>        <span class="k">return</span> <span class="o">-</span><span class="n">si_snr</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>

<span class="c1"># Usage
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">ConvTasNetEnhancer</span><span class="p">()</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="nc">ConvTasNetTrainer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="sh">'</span><span class="s">cuda</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Train
</span><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="n">trainer</span><span class="p">.</span><span class="nf">train_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="n">trainer</span><span class="p">.</span><span class="nf">validate</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s">: Train Loss: </span><span class="si">{</span><span class="n">train_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">, Val Loss: </span><span class="si">{</span><span class="n">val_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">trainer</span><span class="p">.</span><span class="n">scheduler</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="real-time-enhancement-with-onnx">Real-Time Enhancement with ONNX</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeONNXEnhancer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Real-time enhancement using ONNX Runtime
    
    Optimized for production deployment
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">onnx_model_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">4800</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Args:
            onnx_model_path: Path to exported ONNX model
            chunk_size: Audio chunk size (samples)
        </span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">onnxruntime</span> <span class="k">as</span> <span class="n">ort</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
        
        <span class="c1"># Load ONNX model
</span>        <span class="n">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">ort</span><span class="p">.</span><span class="nc">InferenceSession</span><span class="p">(</span>
            <span class="n">onnx_model_path</span><span class="p">,</span>
            <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">CUDAExecutionProvider</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CPUExecutionProvider</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Get input/output names
</span>        <span class="n">self</span><span class="p">.</span><span class="n">input_name</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get_inputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">output_name</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get_outputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="n">name</span>
        
        <span class="c1"># State for streaming
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">reset_state</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Reset streaming state</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">overlap_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chunk_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">enhance_chunk</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_chunk</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Enhance single audio chunk with overlap-add
        
        Args:
            audio_chunk: [chunk_size] numpy array
        
        Returns:
            enhanced_chunk: [chunk_size] numpy array
        </span><span class="sh">"""</span>
        <span class="c1"># Prepare input (batch dimension)
</span>        <span class="n">input_data</span> <span class="o">=</span> <span class="n">audio_chunk</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="c1"># Run inference
</span>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">output_name</span><span class="p">],</span>
            <span class="p">{</span><span class="n">self</span><span class="p">.</span><span class="n">input_name</span><span class="p">:</span> <span class="n">input_data</span><span class="p">}</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Overlap-add
</span>        <span class="n">overlap_size</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">overlap_buffer</span><span class="p">)</span>
        <span class="n">enhanced</span><span class="p">[:</span><span class="n">overlap_size</span><span class="p">]</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">overlap_buffer</span>
        
        <span class="c1"># Save overlap for next chunk
</span>        <span class="n">self</span><span class="p">.</span><span class="n">overlap_buffer</span> <span class="o">=</span> <span class="n">enhanced</span><span class="p">[</span><span class="o">-</span><span class="n">overlap_size</span><span class="p">:].</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="c1"># Return without overlap region
</span>        <span class="k">return</span> <span class="n">enhanced</span><span class="p">[:</span><span class="o">-</span><span class="n">overlap_size</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">enhance_stream</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Enhance audio stream in real-time
        
        Generator that yields enhanced chunks
        </span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">audio_stream</span><span class="p">:</span>
            <span class="c1"># Ensure correct size
</span>            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">!=</span> <span class="n">self</span><span class="p">.</span><span class="n">chunk_size</span><span class="p">:</span>
                <span class="c1"># Pad or skip
</span>                <span class="k">continue</span>
            
            <span class="c1"># Enhance
</span>            <span class="n">enhanced</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">enhance_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            
            <span class="k">yield</span> <span class="n">enhanced</span>

<span class="c1"># Export PyTorch model to ONNX
</span><span class="k">def</span> <span class="nf">export_to_onnx</span><span class="p">(</span><span class="n">pytorch_model</span><span class="p">,</span> <span class="n">onnx_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">4800</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Export trained PyTorch model to ONNX
    </span><span class="sh">"""</span>
    <span class="n">pytorch_model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    
    <span class="c1"># Dummy input
</span>    <span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    
    <span class="c1"># Export
</span>    <span class="n">torch</span><span class="p">.</span><span class="n">onnx</span><span class="p">.</span><span class="nf">export</span><span class="p">(</span>
        <span class="n">pytorch_model</span><span class="p">,</span>
        <span class="n">dummy_input</span><span class="p">,</span>
        <span class="n">onnx_path</span><span class="p">,</span>
        <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">audio_input</span><span class="sh">'</span><span class="p">],</span>
        <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">audio_output</span><span class="sh">'</span><span class="p">],</span>
        <span class="n">dynamic_axes</span><span class="o">=</span><span class="p">{</span>
            <span class="sh">'</span><span class="s">audio_input</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">},</span>
            <span class="sh">'</span><span class="s">audio_output</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="n">opset_version</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Model exported to </span><span class="si">{</span><span class="n">onnx_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Usage
# Export model
</span><span class="nf">export_to_onnx</span><span class="p">(</span><span class="n">trained_model</span><span class="p">,</span> <span class="sh">'</span><span class="s">convtasnet_enhancer.onnx</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Create real-time enhancer
</span><span class="n">enhancer</span> <span class="o">=</span> <span class="nc">RealTimeONNXEnhancer</span><span class="p">(</span><span class="sh">'</span><span class="s">convtasnet_enhancer.onnx</span><span class="sh">'</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">4800</span><span class="p">)</span>

<span class="c1"># Stream audio
</span><span class="k">def</span> <span class="nf">audio_stream_generator</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Generate audio chunks from microphone/file</span><span class="sh">"""</span>
    <span class="c1"># Implementation depends on audio source
</span>    <span class="k">pass</span>

<span class="c1"># Enhance stream
</span><span class="k">for</span> <span class="n">enhanced_chunk</span> <span class="ow">in</span> <span class="n">enhancer</span><span class="p">.</span><span class="nf">enhance_stream</span><span class="p">(</span><span class="nf">audio_stream_generator</span><span class="p">()):</span>
    <span class="c1"># Play or save enhanced audio
</span>    <span class="k">pass</span>
</code></pre></div></div>

<hr />

<h2 id="production-quality-assurance">Production Quality Assurance</h2>

<h3 id="automated-quality-metrics">Automated Quality Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EnhancementQualityAssurance</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Automated quality assurance for enhancement pipeline
    
    Monitors:
    - SNR improvement
    - Speech intelligibility
    - Artifacts
    - Latency
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">assess_quality</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Comprehensive quality assessment
        
        Args:
            original: Noisy input
            enhanced: Enhanced output
            reference: Clean reference (if available)
        
        Returns:
            Quality metrics dictionary
        </span><span class="sh">"""</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># SNR improvement (requires reference)
</span>        <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">original_snr</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_snr</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">enhanced_snr</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_snr</span><span class="p">(</span><span class="n">enhanced</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">snr_improvement_db</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">enhanced_snr</span> <span class="o">-</span> <span class="n">original_snr</span>
            
            <span class="c1"># PESQ (Perceptual Evaluation of Speech Quality)
</span>            <span class="kn">from</span> <span class="n">pesq</span> <span class="kn">import</span> <span class="n">pesq</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_original</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">pesq</span><span class="p">(</span><span class="mi">16000</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_enhanced</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">pesq</span><span class="p">(</span><span class="mi">16000</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_improvement</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_enhanced</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_original</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="c1"># STOI (Short-Time Objective Intelligibility)
</span>            <span class="kn">from</span> <span class="n">pystoi</span> <span class="kn">import</span> <span class="n">stoi</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_original</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">stoi</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_enhanced</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">stoi</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_improvement</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_enhanced</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_original</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
        
        <span class="c1"># Artifact detection (no reference needed)
</span>        <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">artifact_score</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_detect_artifacts</span><span class="p">(</span><span class="n">enhanced</span><span class="p">)</span>
        
        <span class="c1"># Spectral distortion
</span>        <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">spectral_distortion</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_spectral_distortion</span><span class="p">(</span>
            <span class="n">original</span><span class="p">,</span> <span class="n">enhanced</span>
        <span class="p">)</span>
        
        <span class="c1"># Dynamic range
</span>        <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">dynamic_range_db</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span>
            <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">enhanced</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">enhanced</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Clipping detection
</span>        <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">clipping_ratio</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">enhanced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.99</span><span class="p">)</span>
        
        <span class="c1"># Overall quality score
</span>        <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">quality_score</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_overall_score</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">metrics</span>
    
    <span class="k">def</span> <span class="nf">_compute_snr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">reference</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute SNR</span><span class="sh">"""</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">-</span> <span class="n">reference</span>
        <span class="n">signal_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">reference</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">noise_power</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">noise</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">noise_power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">snr_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">log10</span><span class="p">(</span><span class="n">signal_power</span> <span class="o">/</span> <span class="n">noise_power</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">snr_db</span>
    
    <span class="k">def</span> <span class="nf">_detect_artifacts</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Detect musical noise and other artifacts
        
        Returns:
            Artifact score (0-1, lower is better)
        </span><span class="sh">"""</span>
        <span class="c1"># Compute spectrogram
</span>        <span class="n">S</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        
        <span class="c1"># Temporal variation
</span>        <span class="n">temporal_diff</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">temporal_variance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">var</span><span class="p">(</span><span class="n">temporal_diff</span><span class="p">)</span>
        
        <span class="c1"># Spectral variation
</span>        <span class="n">spectral_diff</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">spectral_variance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">var</span><span class="p">(</span><span class="n">spectral_diff</span><span class="p">)</span>
        
        <span class="c1"># High variance indicates artifacts
</span>        <span class="n">artifact_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">temporal_variance</span> <span class="o">+</span> <span class="n">spectral_variance</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Normalize to [0, 1]
</span>        <span class="n">artifact_score</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">artifact_score</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">artifact_score</span>
    
    <span class="k">def</span> <span class="nf">_compute_spectral_distortion</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">enhanced</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute spectral distortion
        
        Measures how much the spectrum changed
        </span><span class="sh">"""</span>
        <span class="c1"># Compute spectrograms
</span>        <span class="n">S_orig</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span><span class="n">original</span><span class="p">))</span>
        <span class="n">S_enh</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">librosa</span><span class="p">.</span><span class="nf">stft</span><span class="p">(</span><span class="n">enhanced</span><span class="p">))</span>
        
        <span class="c1"># Log magnitude
</span>        <span class="n">S_orig_db</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">amplitude_to_db</span><span class="p">(</span><span class="n">S_orig</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">S_enh_db</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">amplitude_to_db</span><span class="p">(</span><span class="n">S_enh</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># MSE in log domain
</span>        <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">((</span><span class="n">S_orig_db</span> <span class="o">-</span> <span class="n">S_enh_db</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">distortion</span>
    
    <span class="k">def</span> <span class="nf">_compute_overall_score</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute overall quality score
        
        Weighted combination of metrics
        </span><span class="sh">"""</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="c1"># PESQ improvement (if available)
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">pesq_improvement</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">pesq_improvement</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># STOI improvement (if available)
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">stoi_improvement</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">stoi_improvement</span><span class="sh">'</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Artifact penalty
</span>        <span class="n">score</span> <span class="o">-=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">artifact_score</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># Normalize to [0, 1]
</span>        <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">score</span>
    
    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate quality assurance report</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">No metrics recorded</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Aggregate metrics
</span>        <span class="n">avg_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">keys</span><span class="p">():</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>
            <span class="n">avg_metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ENHANCEMENT QUALITY ASSURANCE REPORT</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Samples Evaluated: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">metrics_history</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Average Metrics:</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="mi">30</span><span class="n">s</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Pass/fail criteria
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="si">{</span><span class="sh">'</span><span class="s">Criterion</span><span class="sh">'</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">30</span><span class="n">s</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="si">:</span><span class="o">&gt;</span><span class="mi">10</span><span class="n">s</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">42</span><span class="p">)</span>
        
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="sh">'</span><span class="s">SNR Improvement</span><span class="sh">'</span><span class="p">,</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">snr_improvement_db</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="sh">'</span><span class="s">&gt;3 dB</span><span class="sh">'</span><span class="p">),</span>
            <span class="p">(</span><span class="sh">'</span><span class="s">PESQ Improvement</span><span class="sh">'</span><span class="p">,</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">pesq_improvement</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sh">'</span><span class="s">&gt;0.5</span><span class="sh">'</span><span class="p">),</span>
            <span class="p">(</span><span class="sh">'</span><span class="s">STOI Improvement</span><span class="sh">'</span><span class="p">,</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">stoi_improvement</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="sh">'</span><span class="s">&gt;0.1</span><span class="sh">'</span><span class="p">),</span>
            <span class="p">(</span><span class="sh">'</span><span class="s">Artifact Score</span><span class="sh">'</span><span class="p">,</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">artifact_score</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">,</span> <span class="sh">'</span><span class="s">&lt;0.3</span><span class="sh">'</span><span class="p">),</span>
            <span class="p">(</span><span class="sh">'</span><span class="s">Clipping Ratio</span><span class="sh">'</span><span class="p">,</span> <span class="n">avg_metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clipping_ratio</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">,</span> <span class="sh">'</span><span class="s">&lt;1%</span><span class="sh">'</span><span class="p">),</span>
        <span class="p">]</span>
        
        <span class="n">all_passed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">passed</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">✓ PASS</span><span class="sh">"</span> <span class="k">if</span> <span class="n">passed</span> <span class="k">else</span> <span class="sh">"</span><span class="s">✗ FAIL</span><span class="sh">"</span>
            <span class="n">all_passed</span> <span class="o">=</span> <span class="n">all_passed</span> <span class="ow">and</span> <span class="n">passed</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">30</span><span class="n">s</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">status</span><span class="si">:</span><span class="o">&gt;</span><span class="mi">10</span><span class="n">s</span><span class="si">}</span><span class="s">  (</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">42</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="sh">'</span><span class="s">Overall Result</span><span class="sh">'</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">30</span><span class="n">s</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="sh">'</span><span class="s">✓ PASS</span><span class="sh">'</span> <span class="k">if</span> <span class="n">all_passed</span> <span class="k">else</span> <span class="sh">'</span><span class="s">✗ FAIL</span><span class="sh">'</span><span class="si">:</span><span class="o">&gt;</span><span class="mi">10</span><span class="n">s</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># Usage
</span><span class="n">qa</span> <span class="o">=</span> <span class="nc">EnhancementQualityAssurance</span><span class="p">()</span>

<span class="c1"># Evaluate multiple files
</span><span class="k">for</span> <span class="n">noisy_file</span><span class="p">,</span> <span class="n">clean_file</span> <span class="ow">in</span> <span class="n">test_pairs</span><span class="p">:</span>
    <span class="n">noisy_audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">noisy_file</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>
    <span class="n">clean_audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">clean_file</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>
    
    <span class="c1"># Enhance
</span>    <span class="n">enhanced_audio</span> <span class="o">=</span> <span class="n">enhancer</span><span class="p">.</span><span class="nf">enhance</span><span class="p">(</span><span class="n">noisy_audio</span><span class="p">)</span>
    
    <span class="c1"># Assess quality
</span>    <span class="n">metrics</span> <span class="o">=</span> <span class="n">qa</span><span class="p">.</span><span class="nf">assess_quality</span><span class="p">(</span><span class="n">noisy_audio</span><span class="p">,</span> <span class="n">enhanced_audio</span><span class="p">,</span> <span class="n">clean_audio</span><span class="p">)</span>

<span class="c1"># Generate report
</span><span class="n">qa</span><span class="p">.</span><span class="nf">generate_report</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>

<p>✅ <strong>Multiple approaches</strong> - Classical (spectral subtraction, Wiener) and deep learning<br />
✅ <strong>Quality metrics</strong> - PESQ, STOI, SNR for evaluation<br />
✅ <strong>Real-time processing</strong> - Streaming with low latency &lt; 50ms<br />
✅ <strong>Multi-channel</strong> - Beamforming for spatial enhancement<br />
✅ <strong>Caching benefits</strong> - Reduce computational cost for repeated segments<br />
✅ <strong>Trade-offs</strong> - Quality vs latency vs computational cost<br />
✅ <strong>Production considerations</strong> - Monitoring, fallback, quality control</p>

<hr />

<p><strong>Originally published at:</strong> <a href="https://www.arunbaby.com/speech-tech/0010-voice-enhancement/">arunbaby.com/speech-tech/0010-voice-enhancement</a></p>

<p><em>If you found this helpful, consider sharing it with others who might benefit.</em></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#audio-quality" class="page__taxonomy-item p-category" rel="tag">audio-quality</a><span class="sep">, </span>
    
      <a href="/tags/#deep-learning" class="page__taxonomy-item p-category" rel="tag">deep-learning</a><span class="sep">, </span>
    
      <a href="/tags/#noise-reduction" class="page__taxonomy-item p-category" rel="tag">noise-reduction</a><span class="sep">, </span>
    
      <a href="/tags/#signal-processing" class="page__taxonomy-item p-category" rel="tag">signal-processing</a><span class="sep">, </span>
    
      <a href="/tags/#speech-enhancement" class="page__taxonomy-item p-category" rel="tag">speech-enhancement</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#speech-tech" class="page__taxonomy-item p-category" rel="tag">speech-tech</a>
    
    </span>
  </p>


        
      </footer>

      <div class="page__related page__related--full">
  <h2 class="page__related-title">Related across topics</h2>
  <style>
    /* Make section span full content width and use 2 equal columns */
    .page__related--full { float: inline-start; width: 100%; padding: 0; }
    .cross-related-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 2rem; }
    @media (max-width: 768px) { .cross-related-grid { grid-template-columns: 1fr; } }
    /* Ensure archive cards stretch nicely in the grid */
    .cross-related-grid .list__item, .cross-related-grid .grid__item { width: auto; float: none; margin: 0; }
  </style>
  <div class="cross-related-grid">
    



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/dsa/0010-reverse-linked-list/" rel="permalink">Reverse Linked List
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          27 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Master linked list manipulation through reversal - a fundamental pattern for understanding pointer logic and in-place algorithms.
</p>
  </article>
</div>




<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ml-system-design/0010-caching-strategies/" rel="permalink">Caching Strategies for ML Systems
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          27 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Design efficient caching layers for ML systems to reduce latency, save compute costs, and improve user experience at scale.
</p>
  </article>
</div>

  </div>
</div>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=arunbaby0&text=Voice+Enhancement+%26+Noise+Reduction%20https%3A%2F%2Fwww.arunbaby.com%2Fspeech-tech%2F0010-voice-enhancement%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.arunbaby.com%2Fspeech-tech%2F0010-voice-enhancement%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.arunbaby.com/speech-tech/0010-voice-enhancement/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/speech-tech/0009-keyword-spotting/" class="pagination--pager" title="Real-time Keyword Spotting">Previous</a>
    
    
      <a href="/speech-tech/0011-speech-separation/" class="pagination--pager" title="Speech Separation">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 1990 - 2143 <a href="https://www.arunbaby.com">Arun Baby</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0JRJPEC9SS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0JRJPEC9SS', { 'anonymize_ip': false});
</script>








  </body>
</html>
