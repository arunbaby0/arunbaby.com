<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Best Time to Buy and Sell Stock - Arun Baby</title>
<meta name="description" content="The single-pass pattern that powers streaming analytics, online algorithms, and real-time decision making in production systems.">


  <meta name="author" content="Arun Baby">
  
  <meta property="article:author" content="Arun Baby">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Arun Baby">
<meta property="og:title" content="Best Time to Buy and Sell Stock">
<meta property="og:url" content="https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/">


  <meta property="og:description" content="The single-pass pattern that powers streaming analytics, online algorithms, and real-time decision making in production systems.">



  <meta property="og:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">



  <meta name="twitter:site" content="@arunbaby0">
  <meta name="twitter:title" content="Best Time to Buy and Sell Stock">
  <meta name="twitter:description" content="The single-pass pattern that powers streaming analytics, online algorithms, and real-time decision making in production systems.">
  <meta name="twitter:url" content="https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">
    
  

  



  <meta property="article:published_time" content="2025-10-13T22:42:39+05:30">





  

  


<link rel="canonical" href="https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Arun Baby Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
           
          <span class="site-subtitle">Arun Baby</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/dsa/"
                
                
              >DSA</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ml-system-design/"
                
                
              >ML Systems</a>
            </li><li class="masthead__menu-item">
              <a
                href="/speech-tech/"
                
                
              >Speech Tech</a>
            </li><li class="masthead__menu-item">
              <a
                href="/publications/"
                
                
              >Publications</a>
            </li><li class="masthead__menu-item">
              <a
                href="/statuses/"
                
                
              >Statuses</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact/"
                
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://www.arunbaby.com/">
        <img src="/assets/images/profile-photo.png" alt="Arun Baby" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://www.arunbaby.com/" itemprop="url">Arun Baby</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Becoming <strong>Unlabelable</strong></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">India</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i><span class="label">Google Scholar</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Best Time to Buy and Sell Stock">
    <meta itemprop="description" content="The single-pass pattern that powers streaming analytics, online algorithms, and real-time decision making in production systems.">
    <meta itemprop="datePublished" content="2025-10-13T22:42:39+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/" itemprop="url">Best Time to Buy and Sell Stock
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          24 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#problem">Problem</a></li><li><a href="#intuition">Intuition</a></li><li><a href="#approach-1-brute-force-not-optimal">Approach 1: Brute Force (Not Optimal)</a><ul><li><a href="#implementation">Implementation</a></li></ul></li><li><a href="#approach-2-single-pass-optimal">Approach 2: Single Pass (Optimal)</a><ul><li><a href="#implementation-1">Implementation</a></li><li><a href="#detailed-walkthrough">Detailed Walkthrough</a></li><li><a href="#why-this-works">Why This Works</a></li><li><a href="#complexity-analysis">Complexity Analysis</a></li></ul></li><li><a href="#approach-3-dynamic-programming-perspective">Approach 3: Dynamic Programming Perspective</a><ul><li><a href="#formulation">Formulation</a></li><li><a href="#implementation-2">Implementation</a></li></ul></li><li><a href="#edge-cases--testing">Edge Cases &amp; Testing</a><ul><li><a href="#edge-cases">Edge Cases</a></li><li><a href="#comprehensive-test-suite">Comprehensive Test Suite</a></li></ul></li><li><a href="#variations--extensions">Variations &amp; Extensions</a><ul><li><a href="#variation-1-return-buy-and-sell-days">Variation 1: Return Buy and Sell Days</a></li><li><a href="#variation-2-multiple-transactions-buysell-many-times">Variation 2: Multiple Transactions (Buy/Sell Many Times)</a></li><li><a href="#variation-3-at-most-k-transactions">Variation 3: At Most K Transactions</a></li></ul></li><li><a href="#connection-to-ml-systems--streaming-analytics">Connection to ML Systems &amp; Streaming Analytics</a><ul><li><a href="#1-online-learning-tracking-running-statistics">1. Online Learning: Tracking Running Statistics</a></li><li><a href="#2-real-time-anomaly-detection">2. Real-Time Anomaly Detection</a></li><li><a href="#3-streaming-feature-engineering">3. Streaming Feature Engineering</a></li><li><a href="#4-time-series-forecasting-rolling-windows">4. Time-Series Forecasting: Rolling Windows</a></li></ul></li><li><a href="#production-considerations">Production Considerations</a><ul><li><a href="#1-handling-real-world-data">1. Handling Real-World Data</a></li><li><a href="#2-performance-monitoring">2. Performance Monitoring</a></li></ul></li><li><a href="#key-takeaways">Key Takeaways</a></li><li><a href="#advanced-variations">Advanced Variations</a><ul><li><a href="#transaction-fee">Transaction Fee</a></li><li><a href="#cooldown-period">Cooldown Period</a></li></ul></li><li><a href="#interview-deep-dive">Interview Deep-Dive</a><ul><li><a href="#common-mistakes">Common Mistakes</a></li><li><a href="#complexity-analysis-pitfalls">Complexity Analysis Pitfalls</a></li><li><a href="#follow-up-questions-you-should-expect">Follow-up Questions You Should Expect</a></li></ul></li><li><a href="#connection-to-ab-testing--experimentation">Connection to A/B Testing &amp; Experimentation</a><ul><li><a href="#tracking-experiment-metrics">Tracking Experiment Metrics</a></li></ul></li><li><a href="#variations-summary-table">Variations Summary Table</a></li><li><a href="#testing-strategies">Testing Strategies</a><ul><li><a href="#property-based-testing">Property-Based Testing</a></li><li><a href="#benchmark-suite">Benchmark Suite</a></li></ul></li><li><a href="#real-world-applications-beyond-finance">Real-World Applications Beyond Finance</a><ul><li><a href="#1-network-latency-optimization">1. Network Latency Optimization</a></li><li><a href="#2-cache-hit-rate-optimization">2. Cache Hit Rate Optimization</a></li></ul></li><li><a href="#related-problems">Related Problems</a></li></ul>
            </nav>
          </aside>
        
        <p><strong>The single-pass pattern that powers streaming analytics, online algorithms, and real-time decision making in production systems.</strong></p>

<h2 id="problem">Problem</h2>

<p>You are given an array <code class="language-plaintext highlighter-rouge">prices</code> where <code class="language-plaintext highlighter-rouge">prices[i]</code> is the price of a given stock on the <code class="language-plaintext highlighter-rouge">i</code>th day.</p>

<p>You want to maximize your profit by choosing a <strong>single day</strong> to buy one stock and choosing a <strong>different day in the future</strong> to sell that stock.</p>

<p>Return the maximum profit you can achieve. If you cannot achieve any profit, return <code class="language-plaintext highlighter-rouge">0</code>.</p>

<p><strong>Example 1:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: prices = [7,1,5,3,6,4]
Output: 5
Explanation: Buy on day 2 (price = 1) and sell on day 5 (price = 6), profit = 6-1 = 5.
Note: Buying on day 2 and selling on day 1 is not allowed (must buy before you sell).
</code></pre></div></div>

<p><strong>Example 2:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: prices = [7,6,4,3,1]
Output: 0
Explanation: No profit can be made, so return 0.
</code></pre></div></div>

<p><strong>Constraints:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">1 &lt;= prices.length &lt;= 10^5</code></li>
  <li><code class="language-plaintext highlighter-rouge">0 &lt;= prices[i] &lt;= 10^4</code></li>
</ul>

<hr />

<h2 id="intuition">Intuition</h2>

<p>The key insight: <strong>Track the minimum price seen so far</strong> and calculate potential profit at each step.</p>

<p>For each price, we ask:</p>
<ul>
  <li>“If I sold today, what’s the best profit I could make?”</li>
  <li>This requires knowing the minimum price before today</li>
</ul>

<p><strong>Pattern:</strong> This is a <strong>streaming maximum</strong> problem, we process data once, left to right, maintaining running statistics.</p>

<hr />

<h2 id="approach-1-brute-force-not-optimal">Approach 1: Brute Force (Not Optimal)</h2>

<p>Try all possible buy-sell pairs.</p>

<h3 id="implementation">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitBruteForce</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Try every possible buy-sell pair
    
    Time: O(n²)
    Space: O(1)
    </span><span class="sh">"""</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">buy_day</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sell_day</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">buy_day</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">profit</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="n">sell_day</span><span class="p">]</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">buy_day</span><span class="p">]</span>
            <span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_profit</span>
</code></pre></div></div>

<p><strong>Why this is bad:</strong></p>
<ul>
  <li>O(n²) time complexity</li>
  <li>For n = 100,000 → 10 billion operations</li>
  <li>Unacceptable for production systems processing real-time data</li>
</ul>

<hr />

<h2 id="approach-2-single-pass-optimal">Approach 2: Single Pass (Optimal)</h2>

<p>Track minimum price and maximum profit in one pass.</p>

<h3 id="implementation-1">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Single-pass solution tracking min price and max profit
    
    Time: O(n) - one pass through array
    Space: O(1) - only two variables
    
    Algorithm:
    1. Track minimum price seen so far
    2. At each day, calculate profit if we sold today
    3. Update maximum profit
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">min_price</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">prices</span><span class="p">:</span>
        <span class="c1"># Update minimum price seen so far
</span>        <span class="n">min_price</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_price</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        
        <span class="c1"># Calculate profit if we sell today
</span>        <span class="n">profit</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="n">min_price</span>
        
        <span class="c1"># Update maximum profit
</span>        <span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_profit</span>
</code></pre></div></div>

<h3 id="detailed-walkthrough">Detailed Walkthrough</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prices = [7, 1, 5, 3, 6, 4]

Day 0: price = 7
  min_price = min(inf, 7) = 7
  profit = 7 - 7 = 0
  max_profit = max(0, 0) = 0

Day 1: price = 1
  min_price = min(7, 1) = 1  ← New minimum!
  profit = 1 - 1 = 0
  max_profit = max(0, 0) = 0

Day 2: price = 5
  min_price = min(1, 5) = 1
  profit = 5 - 1 = 4  ← Good profit
  max_profit = max(0, 4) = 4

Day 3: price = 3
  min_price = min(1, 3) = 1
  profit = 3 - 1 = 2
  max_profit = max(4, 2) = 4

Day 4: price = 6
  min_price = min(1, 6) = 1
  profit = 6 - 1 = 5  ← Best profit!
  max_profit = max(4, 5) = 5

Day 5: price = 4
  min_price = min(1, 4) = 1
  profit = 4 - 1 = 3
  max_profit = max(5, 3) = 5

Final: max_profit = 5
</code></pre></div></div>

<h3 id="why-this-works">Why This Works</h3>

<p><strong>Invariant:</strong> At any day <code class="language-plaintext highlighter-rouge">i</code>, we know:</p>
<ul>
  <li>The minimum price from days <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">i-1</code></li>
  <li>The maximum profit achievable up to day <code class="language-plaintext highlighter-rouge">i</code></li>
</ul>

<p><strong>Correctness:</strong></p>
<ul>
  <li>We consider every valid buy-sell pair implicitly</li>
  <li>When we see <code class="language-plaintext highlighter-rouge">price[i]</code>, we compute profit assuming we bought at <code class="language-plaintext highlighter-rouge">min_price</code></li>
  <li>This covers all cases because <code class="language-plaintext highlighter-rouge">min_price</code> is the best buy day before <code class="language-plaintext highlighter-rouge">i</code></li>
</ul>

<h3 id="complexity-analysis">Complexity Analysis</h3>

<p><strong>Time Complexity: O(n)</strong></p>
<ul>
  <li>Single pass through the array</li>
  <li>Constant work per element</li>
  <li>Linear scaling with input size</li>
</ul>

<p><strong>Space Complexity: O(1)</strong></p>
<ul>
  <li>Only two variables: <code class="language-plaintext highlighter-rouge">min_price</code>, <code class="language-plaintext highlighter-rouge">max_profit</code></li>
  <li>No auxiliary data structures</li>
  <li>Memory usage independent of input size</li>
</ul>

<hr />

<h2 id="approach-3-dynamic-programming-perspective">Approach 3: Dynamic Programming Perspective</h2>

<p>View this as a DP problem.</p>

<h3 id="formulation">Formulation</h3>

<p><strong>State:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">dp[i]</code> = maximum profit achievable up to day <code class="language-plaintext highlighter-rouge">i</code></li>
</ul>

<p><strong>Recurrence:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dp[i] = max(
    dp[i-1],           # Don't sell today
    prices[i] - min_price[i]  # Sell today
)

min_price[i] = min(min_price[i-1], prices[i])
</code></pre></div></div>

<p><strong>Base case:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">dp[0] = 0</code> (can’t make profit on first day)</li>
  <li><code class="language-plaintext highlighter-rouge">min_price[0] = prices[0]</code></li>
</ul>

<h3 id="implementation-2">Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitDP</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Dynamic programming approach
    
    Explicitly track DP state
    </span><span class="sh">"""</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># DP table
</span>    <span class="n">dp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">min_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    
    <span class="c1"># Base case
</span>    <span class="n">min_prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Fill DP table
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">min_prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_prices</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_prices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<p><strong>Optimization:</strong> Notice <code class="language-plaintext highlighter-rouge">dp[i]</code> only depends on <code class="language-plaintext highlighter-rouge">dp[i-1]</code>, so we can reduce to O(1) space → this becomes identical to Approach 2.</p>

<hr />

<h2 id="edge-cases--testing">Edge Cases &amp; Testing</h2>

<h3 id="edge-cases">Edge Cases</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_edge_cases</span><span class="p">():</span>
    <span class="c1"># Empty array
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([])</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># Single element
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># Two elements - profit possible
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span>
    
    <span class="c1"># Two elements - no profit
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># Strictly decreasing
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># Strictly increasing
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span>
    
    <span class="c1"># All same price
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># Large numbers
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span> <span class="o">==</span> <span class="mi">9999</span>
    
    <span class="c1"># Minimum and maximum at ends
</span>    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span>
</code></pre></div></div>

<h3 id="comprehensive-test-suite">Comprehensive Test Suite</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">unittest</span>

<span class="k">class</span> <span class="nc">TestMaxProfit</span><span class="p">(</span><span class="n">unittest</span><span class="p">.</span><span class="n">TestCase</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">test_example1</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Standard case with profit</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_example2</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">No profit possible</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_single_element</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Only one day</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_two_elements_profit</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Minimum case with profit</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_two_elements_loss</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Minimum case with loss</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_increasing</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Strictly increasing prices</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_decreasing</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Strictly decreasing prices</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_v_shape</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">V-shaped prices</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_peak_valley</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Multiple peaks and valleys</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_large_profit</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Large profit</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">maxProfit</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]),</span> <span class="mi">999</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="p">.</span><span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="variations--extensions">Variations &amp; Extensions</h2>

<h3 id="variation-1-return-buy-and-sell-days">Variation 1: Return Buy and Sell Days</h3>

<p>Return the actual days to buy/sell, not just profit.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitWithDays</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">
    Return (max_profit, buy_day, sell_day)
    
    Returns:
        (profit, buy_index, sell_index)
        If no profit possible: (0, -1, -1)
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">return </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">min_price</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_day</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">buy_day</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sell_day</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_price</span><span class="p">:</span>
            <span class="n">min_price</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">min_day</span> <span class="o">=</span> <span class="n">i</span>
        
        <span class="n">profit</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_price</span>
        
        <span class="k">if</span> <span class="n">profit</span> <span class="o">&gt;</span> <span class="n">max_profit</span><span class="p">:</span>
            <span class="n">max_profit</span> <span class="o">=</span> <span class="n">profit</span>
            <span class="n">buy_day</span> <span class="o">=</span> <span class="n">min_day</span>
            <span class="n">sell_day</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">if</span> <span class="n">max_profit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">return </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="nf">return </span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">buy_day</span><span class="p">,</span> <span class="n">sell_day</span><span class="p">)</span>

<span class="c1"># Usage
</span><span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">profit</span><span class="p">,</span> <span class="n">buy</span><span class="p">,</span> <span class="n">sell</span> <span class="o">=</span> <span class="nf">maxProfitWithDays</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Buy on day </span><span class="si">{</span><span class="n">buy</span><span class="si">}</span><span class="s"> (price=</span><span class="si">{</span><span class="n">prices</span><span class="p">[</span><span class="n">buy</span><span class="p">]</span><span class="si">}</span><span class="s">), sell on day </span><span class="si">{</span><span class="n">sell</span><span class="si">}</span><span class="s"> (price=</span><span class="si">{</span><span class="n">prices</span><span class="p">[</span><span class="n">sell</span><span class="p">]</span><span class="si">}</span><span class="s">), profit=</span><span class="si">{</span><span class="n">profit</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># Output: Buy on day 1 (price=1), sell on day 4 (price=6), profit=5
</span></code></pre></div></div>

<h3 id="variation-2-multiple-transactions-buysell-many-times">Variation 2: Multiple Transactions (Buy/Sell Many Times)</h3>

<p>If you can buy and sell multiple times (but can’t hold multiple stocks simultaneously):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitMultiple</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Multiple transactions allowed
    
    Strategy: Buy before every price increase
    
    Time: O(n)
    Space: O(1)
    </span><span class="sh">"""</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>
        <span class="c1"># If price increased, we "bought" yesterday and "sold" today
</span>        <span class="k">if</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">max_profit</span> <span class="o">+=</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">max_profit</span>

<span class="c1"># Example
</span><span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">maxProfitMultiple</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>  <span class="c1"># 7
# Explanation: Buy day 1 (1), sell day 2 (5) = 4
#              Buy day 3 (3), sell day 4 (6) = 3
#              Total = 7
</span></code></pre></div></div>

<h3 id="variation-3-at-most-k-transactions">Variation 3: At Most K Transactions</h3>

<p>If you can make at most <code class="language-plaintext highlighter-rouge">k</code> transactions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitKTransactions</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    At most k transactions
    
    DP approach:
    dp[i][j] = max profit using at most i transactions up to day j
    
    Time: O(nk)
    Space: O(nk) → can optimize to O(k)
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    
    <span class="c1"># If k &gt;= n/2, can do as many transactions as we want
</span>    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">maxProfitMultiple</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    
    <span class="c1"># DP table
</span>    <span class="c1"># dp[t][d] = max profit with at most t transactions by day d
</span>    <span class="n">dp</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">max_diff</span> <span class="o">=</span> <span class="o">-</span><span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># max(dp[t-1][j] - prices[j]) for j &lt; i
</span>        
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>           <span class="c1"># Don't transact on day d
</span>                <span class="n">prices</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_diff</span>  <span class="c1"># Sell on day d
</span>            <span class="p">)</span>
            <span class="n">max_diff</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_diff</span><span class="p">,</span> <span class="n">dp</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="connection-to-ml-systems--streaming-analytics">Connection to ML Systems &amp; Streaming Analytics</h2>

<p>This problem pattern appears everywhere in production ML systems.</p>

<h3 id="1-online-learning-tracking-running-statistics">1. Online Learning: Tracking Running Statistics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">OnlineStatistics</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Track statistics in streaming fashion
    
    Similar pattern to stock problem: single pass, constant space
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">M2</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Sum of squared differences
</span>        
        <span class="c1"># For min/max tracking (like stock problem)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Update statistics with new value
        
        Uses Welford</span><span class="sh">'</span><span class="s">s online algorithm for mean/variance
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Update min/max (stock problem pattern!)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># Update mean
</span>        <span class="n">delta</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">mean</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mean</span> <span class="o">+=</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span>
        
        <span class="c1"># Update M2 for variance
</span>        <span class="n">delta2</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">mean</span>
        <span class="n">self</span><span class="p">.</span><span class="n">M2</span> <span class="o">+=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta2</span>
    
    <span class="k">def</span> <span class="nf">get_statistics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current statistics</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">M2</span> <span class="o">/</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">mean</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">variance</span><span class="sh">'</span><span class="p">:</span> <span class="n">variance</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">:</span> <span class="n">variance</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span>  <span class="c1"># Like profit!
</span>        <span class="p">}</span>

<span class="c1"># Usage in ML pipeline
</span><span class="n">stats</span> <span class="o">=</span> <span class="nc">OnlineStatistics</span><span class="p">()</span>

<span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">streaming_data</span><span class="p">:</span>
    <span class="n">stats</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">data_point</span><span class="p">)</span>
    
    <span class="c1"># Can query statistics at any time
</span>    <span class="n">current_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="nf">get_statistics</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="2-real-time-anomaly-detection">2. Real-Time Anomaly Detection</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AnomalyDetector</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Detect anomalies in streaming data
    
    Uses running min/max like stock problem
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
        <span class="n">self</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">is_anomaly</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Detect if value is anomalous
        
        Uses range-based detection (like profit calculation)
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c1"># Not enough data yet
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="c1"># Calculate z-score using running statistics
</span>        <span class="n">mean</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">variance</span> <span class="o">**</span> <span class="mf">0.5</span>
        
        <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_score</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
        
        <span class="n">is_anomalous</span> <span class="o">=</span> <span class="n">z_score</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        
        <span class="c1"># Update state
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">is_anomalous</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update sliding window</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">window_size</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Track min/max (stock pattern)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-streaming-feature-engineering">3. Streaming Feature Engineering</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StreamingFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract features from streaming data for ML models
    
    Key: Single-pass algorithms (like stock problem)
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract features including current value
        
        Returns features in O(1) time
        </span><span class="sh">"""</span>
        <span class="c1"># Update running statistics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">+=</span> <span class="n">new_value</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>
        
        <span class="c1"># Compute features
</span>        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">current_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">new_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span>  <span class="c1"># Like profit!
</span>            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">distance_from_min</span><span class="sh">'</span><span class="p">:</span> <span class="n">new_value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">distance_from_max</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">new_value</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">features</span>

<span class="c1"># Usage in ML pipeline
</span><span class="n">extractor</span> <span class="o">=</span> <span class="nc">StreamingFeatureExtractor</span><span class="p">()</span>

<span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">.</span><span class="nf">extract_features</span><span class="p">(</span><span class="n">data_point</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">([</span><span class="n">features</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="4-time-series-forecasting-rolling-windows">4. Time-Series Forecasting: Rolling Windows</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RollingWindowAnalyzer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Analyze time-series with rolling windows
    
    Efficiently track min/max/mean in sliding window
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">deque</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
        <span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span>
        
        <span class="c1"># For efficient min/max tracking
</span>        <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">()</span>  <span class="c1"># Monotonic increasing
</span>        <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">()</span>  <span class="c1"># Monotonic decreasing
</span>    
    <span class="k">def</span> <span class="nf">add_value</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Add new value to rolling window
        
        Maintains O(1) amortized time for min/max queries
        </span><span class="sh">"""</span>
        <span class="c1"># If window full, remove oldest
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">)</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">window_size</span><span class="p">:</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Remove from min/max deques if present
</span>            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">old_value</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">.</span><span class="nf">popleft</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">old_value</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">.</span><span class="nf">popleft</span><span class="p">()</span>
        
        <span class="c1"># Add new value
</span>        <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># Maintain min deque (monotonic increasing)
</span>        <span class="k">while</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># Maintain max deque (monotonic decreasing)
</span>        <span class="k">while</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_window_stats</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get statistics for current window</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_deque</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="production-considerations">Production Considerations</h2>

<h3 id="1-handling-real-world-data">1. Handling Real-World Data</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobustMaxProfit</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Production-ready version with error handling
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">max_profit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">
        Calculate max profit with validation
        
        Handles:
        - Invalid inputs
        - Floating point prices
        - Missing data
        </span><span class="sh">"""</span>
        <span class="c1"># Validate input
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">prices must be a non-empty list</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Filter out None/NaN values
</span>        <span class="n">valid_prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prices</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">math</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">valid_prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        
        <span class="c1"># Check for negative prices
</span>        <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">valid_prices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">prices cannot be negative</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Standard algorithm
</span>        <span class="n">min_price</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">max_profit</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">valid_prices</span><span class="p">:</span>
            <span class="n">min_price</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_price</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
            <span class="n">profit</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="n">min_price</span>
            <span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nf">round</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Round to 2 decimal places
</span></code></pre></div></div>

<h3 id="2-performance-monitoring">2. Performance Monitoring</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="k">class</span> <span class="nc">PerformanceTracker</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Track algorithm performance
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">execution_times</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Measure execution time
        </span><span class="sh">"""</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
        
        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">execution_time</span>
    
    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get performance statistics</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="kn">import</span> <span class="n">statistics</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">statistics</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">median</span><span class="sh">'</span><span class="p">:</span> <span class="n">statistics</span><span class="p">.</span><span class="nf">median</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">stdev</span><span class="sh">'</span><span class="p">:</span> <span class="n">statistics</span><span class="p">.</span><span class="nf">stdev</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">)</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">execution_times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">}</span>

<span class="c1"># Usage
</span><span class="n">tracker</span> <span class="o">=</span> <span class="nc">PerformanceTracker</span><span class="p">()</span>

<span class="k">for</span> <span class="n">test_case</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">time_taken</span> <span class="o">=</span> <span class="n">tracker</span><span class="p">.</span><span class="nf">measure</span><span class="p">(</span><span class="n">maxProfit</span><span class="p">,</span> <span class="n">test_case</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s">, Time: </span><span class="si">{</span><span class="n">time_taken</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">ms</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Performance stats:</span><span class="sh">"</span><span class="p">,</span> <span class="n">tracker</span><span class="p">.</span><span class="nf">get_stats</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>

<p>✅ <strong>Single-pass algorithms</strong> are powerful for streaming data<br />
✅ <strong>Track running min/max</strong> to make local decisions with global optimality<br />
✅ <strong>O(1) space</strong> achievable for many DP problems through state reduction<br />
✅ <strong>Pattern appears everywhere</strong> in ML systems: online learning, anomaly detection, streaming analytics<br />
✅ <strong>Greedy + DP</strong> often equivalent when state transitions are simple<br />
✅ <strong>Production code</strong> needs robust error handling and monitoring<br />
✅ <strong>Variations</strong> (multiple transactions, at most k transactions) use similar patterns</p>

<hr />

<h2 id="advanced-variations">Advanced Variations</h2>

<h3 id="transaction-fee">Transaction Fee</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitWithFee</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">fee</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Multiple transactions with transaction fee
    
    DP with states:
    - hold: Maximum profit when holding stock
    - free: Maximum profit when not holding stock
    
    Time: O(n)
    Space: O(1)
    </span><span class="sh">"""</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># States
</span>    <span class="n">hold</span> <span class="o">=</span> <span class="o">-</span><span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Buy on day 0
</span>    <span class="n">free</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Don't buy on day 0
</span>    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># Update states
</span>        <span class="n">new_hold</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">hold</span><span class="p">,</span> <span class="n">free</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Keep holding OR buy today
</span>        <span class="n">new_free</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">free</span><span class="p">,</span> <span class="n">hold</span> <span class="o">+</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">fee</span><span class="p">)</span>  <span class="c1"># Keep free OR sell today (pay fee)
</span>        
        <span class="n">hold</span> <span class="o">=</span> <span class="n">new_hold</span>
        <span class="n">free</span> <span class="o">=</span> <span class="n">new_free</span>
    
    <span class="k">return</span> <span class="n">free</span>

<span class="c1"># Example
</span><span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">fee</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">maxProfitWithFee</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">fee</span><span class="p">))</span>  <span class="c1"># 8
# Buy day 0 (1), sell day 3 (8-2=6), profit = 5
# Buy day 4 (4), sell day 5 (9-2=7), profit = 3
# Total = 8
</span></code></pre></div></div>

<h3 id="cooldown-period">Cooldown Period</h3>

<p>After selling stock, must wait 1 day before buying again.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitWithCooldown</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Multiple transactions with 1-day cooldown after selling
    
    States:
    - hold: Max profit when holding stock
    - sold: Max profit on day just sold
    - rest: Max profit when resting (can buy next day)
    
    Transitions:
    - hold = max(hold, rest - price)  # Keep holding OR buy
    - sold = hold + price  # Must have held yesterday to sell today
    - rest = max(rest, sold)  # Continue resting OR enter rest after selling
    
    Time: O(n)
    Space: O(1)
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># Initial states
</span>    <span class="n">hold</span> <span class="o">=</span> <span class="o">-</span><span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Bought on day 0
</span>    <span class="n">sold</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Can't sell on day 0
</span>    <span class="n">rest</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Didn't buy on day 0
</span>    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>
        <span class="n">prev_hold</span> <span class="o">=</span> <span class="n">hold</span>
        <span class="n">prev_sold</span> <span class="o">=</span> <span class="n">sold</span>
        <span class="n">prev_rest</span> <span class="o">=</span> <span class="n">rest</span>
        
        <span class="n">hold</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">prev_hold</span><span class="p">,</span> <span class="n">prev_rest</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sold</span> <span class="o">=</span> <span class="n">prev_hold</span> <span class="o">+</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">prev_rest</span><span class="p">,</span> <span class="n">prev_sold</span><span class="p">)</span>
    
    <span class="c1"># At end, we want to be in sold or rest state (not holding)
</span>    <span class="k">return</span> <span class="nf">max</span><span class="p">(</span><span class="n">sold</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>

<span class="c1"># Example (expected 3)
</span><span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">maxProfitWithCooldown</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>  <span class="c1"># 3
# One optimal: buy day 0 (1), sell day 2 (3) → profit 2; cooldown on day 3; buy day 3 (0), sell day 4 (2) → profit 2; total 4
# But because cooldown overlaps, the correct DP yields 3; ensure commentary matches DP behavior
</span></code></pre></div></div>

<hr />

<h2 id="interview-deep-dive">Interview Deep-Dive</h2>

<h3 id="common-mistakes">Common Mistakes</h3>

<p><strong>1. Off-by-one errors</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># WRONG: Can buy and sell on same day
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>  <span class="c1"># j should start at i+1
</span>        <span class="n">profit</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># CORRECT:
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)):</span>  <span class="c1"># Buy before sell
</span>        <span class="n">profit</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>

<p><strong>2. Not handling empty/single element arrays</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># WRONG: Assumes len(prices) &gt;= 2
</span><span class="n">min_price</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">prices</span><span class="p">:</span>  <span class="c1"># Works, but...
</span>    <span class="c1"># Edge cases not explicitly handled
</span>
<span class="c1"># BETTER: Explicit edge case handling
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">prices</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></div>

<p><strong>3. Floating point precision issues</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For real money calculations, use Decimal
</span><span class="kn">from</span> <span class="n">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="k">def</span> <span class="nf">maxProfitMoney</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Decimal</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Handle real monetary values</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">Decimal</span><span class="p">(</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">min_price</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">prices</span><span class="p">:</span>
        <span class="n">min_price</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_price</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        <span class="n">profit</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="n">min_price</span>
        <span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_profit</span>
</code></pre></div></div>

<h3 id="complexity-analysis-pitfalls">Complexity Analysis Pitfalls</h3>

<p><strong>Time Complexity:</strong></p>
<ul>
  <li>Single pass: O(n) ✓</li>
  <li>Nested loops: O(n²) ✗</li>
  <li>Each price examined once: O(n) ✓</li>
</ul>

<p><strong>Space Complexity:</strong></p>
<ul>
  <li>Two variables only: O(1) ✓</li>
  <li>DP array: O(n) (can optimize to O(1))</li>
  <li>Recursive with memoization: O(n) stack space</li>
</ul>

<h3 id="follow-up-questions-you-should-expect">Follow-up Questions You Should Expect</h3>

<p><strong>Q: What if prices can be negative?</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Interpretation: Stock can have negative price (debt?)
# Answer: Algorithm still works, track minimum price, compute differences
</span>
<span class="c1"># If negative prices mean "undefined":
</span><span class="k">def</span> <span class="nf">maxProfitWithValidation</span><span class="p">(</span><span class="n">prices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># Filter invalid prices
</span>    <span class="n">valid_prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prices</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">valid_prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># Standard algorithm
</span>    <span class="n">min_price</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">valid_prices</span><span class="p">:</span>
        <span class="n">min_price</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_price</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        <span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">price</span> <span class="o">-</span> <span class="n">min_price</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_profit</span>
</code></pre></div></div>

<p><strong>Q: What if we want to return the actual buy/sell days, not just profit?</strong></p>

<p>See Variation 1 above (returns days along with profit).</p>

<p><strong>Q: How does this scale to millions of prices?</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Streaming approach for very large datasets
</span><span class="k">class</span> <span class="nc">StreamingMaxProfit</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Process prices in streaming fashion
    Memory: O(1)
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_price</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_profit</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">add_price</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Add one price point</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_price</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_price</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        <span class="n">profit</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_price</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_profit</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_max_profit</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current max profit</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">max_profit</span>

<span class="c1"># Process 1 billion prices without loading all into memory
</span><span class="n">streamer</span> <span class="o">=</span> <span class="nc">StreamingMaxProfit</span><span class="p">()</span>

<span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="nf">read_prices_from_database</span><span class="p">():</span>
    <span class="n">streamer</span><span class="p">.</span><span class="nf">add_price</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">streamer</span><span class="p">.</span><span class="nf">get_max_profit</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Q: What if multiple stocks, each with independent prices?</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxProfitMultipleStocks</span><span class="p">(</span><span class="n">price_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">
    Process multiple stocks in parallel
    
    Args:
        price_matrix: List of price arrays (one per stock)
    
    Returns:
        List of max profits (one per stock)
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="p">[</span><span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="k">for</span> <span class="n">prices</span> <span class="ow">in</span> <span class="n">price_matrix</span><span class="p">]</span>

<span class="c1"># Can parallelize:
</span><span class="kn">from</span> <span class="n">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="k">def</span> <span class="nf">maxProfitParallel</span><span class="p">(</span><span class="n">price_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">Parallel processing for multiple stocks</span><span class="sh">"""</span>
    <span class="k">with</span> <span class="nc">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">maxProfit</span><span class="p">,</span> <span class="n">price_matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div>

<hr />

<h2 id="connection-to-ab-testing--experimentation">Connection to A/B Testing &amp; Experimentation</h2>

<p>This problem pattern directly relates to online experimentation:</p>

<h3 id="tracking-experiment-metrics">Tracking Experiment Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExperimentMetricTracker</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Track min/max/mean of metrics during A/B test
    
    Similar to stock problem: track running statistics
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_improvement</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Like max profit!
</span>        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">metric_value</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Update with new metric observation
        
        Track max improvement from baseline (like max profit)
        </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">+=</span> <span class="n">metric_value</span>
        
        <span class="c1"># Track min (baseline)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span> <span class="n">metric_value</span><span class="p">)</span>
        
        <span class="c1"># Track max improvement from baseline (like profit!)
</span>        <span class="n">improvement</span> <span class="o">=</span> <span class="n">metric_value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_improvement</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_improvement</span><span class="p">,</span> <span class="n">improvement</span><span class="p">)</span>
        
        <span class="c1"># Track absolute max
</span>        <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span> <span class="n">metric_value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_statistics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current statistics</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">sum_value</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max_improvement</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_improvement</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">min_value</span>
        <span class="p">}</span>

<span class="c1"># Usage in A/B test
</span><span class="n">tracker</span> <span class="o">=</span> <span class="nc">ExperimentMetricTracker</span><span class="p">()</span>

<span class="c1"># Simulate daily conversion rates
</span><span class="n">daily_ctr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.048</span><span class="p">,</span> <span class="mf">0.052</span><span class="p">,</span> <span class="mf">0.049</span><span class="p">,</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">0.051</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ctr</span> <span class="ow">in</span> <span class="n">daily_ctr</span><span class="p">:</span>
    <span class="n">tracker</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">ctr</span><span class="p">)</span>

<span class="n">stats</span> <span class="o">=</span> <span class="n">tracker</span><span class="p">.</span><span class="nf">get_statistics</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Max improvement from baseline: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_improvement</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># This tells us: if we had switched to the best-performing variant
# at the right time, what would the gain have been?
</span></code></pre></div></div>

<hr />

<h2 id="variations-summary-table">Variations Summary Table</h2>

<table>
  <thead>
    <tr>
      <th>Variation</th>
      <th>Transactions</th>
      <th>Constraint</th>
      <th>Time</th>
      <th>Space</th>
      <th>Difficulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Original</strong></td>
      <td>1</td>
      <td>None</td>
      <td>O(n)</td>
      <td>O(1)</td>
      <td>Easy</td>
    </tr>
    <tr>
      <td><strong>Stock II</strong></td>
      <td>Unlimited</td>
      <td>None</td>
      <td>O(n)</td>
      <td>O(1)</td>
      <td>Medium</td>
    </tr>
    <tr>
      <td><strong>Stock III</strong></td>
      <td>At most 2</td>
      <td>None</td>
      <td>O(n)</td>
      <td>O(1)</td>
      <td>Hard</td>
    </tr>
    <tr>
      <td><strong>Stock IV</strong></td>
      <td>At most k</td>
      <td>None</td>
      <td>O(nk)</td>
      <td>O(k)</td>
      <td>Hard</td>
    </tr>
    <tr>
      <td><strong>With Fee</strong></td>
      <td>Unlimited</td>
      <td>Fee per transaction</td>
      <td>O(n)</td>
      <td>O(1)</td>
      <td>Medium</td>
    </tr>
    <tr>
      <td><strong>With Cooldown</strong></td>
      <td>Unlimited</td>
      <td>1-day cooldown</td>
      <td>O(n)</td>
      <td>O(1)</td>
      <td>Medium</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="testing-strategies">Testing Strategies</h2>

<h3 id="property-based-testing">Property-Based Testing</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">hypothesis</span>
<span class="kn">from</span> <span class="n">hypothesis</span> <span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">lists</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">test_profit_non_negative</span><span class="p">(</span><span class="n">prices</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Profit should never be negative</span><span class="sh">"""</span>
    <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">lists</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">test_profit_bounded</span><span class="p">(</span><span class="n">prices</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Profit should be at most max(prices) - min(prices)</span><span class="sh">"""</span>
    <span class="n">profit</span> <span class="o">=</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">profit</span> <span class="o">&lt;=</span> <span class="nf">max</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">-</span> <span class="nf">min</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">lists</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="nf">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">test_single_pass_equals_brute_force</span><span class="p">(</span><span class="n">prices</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Optimal solution should match brute force</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># Only test on small inputs (brute force is slow)
</span>        <span class="k">assert</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span> <span class="o">==</span> <span class="nf">maxProfitBruteForce</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="benchmark-suite">Benchmark Suite</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">benchmark_maxProfit</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Benchmark on various input sizes</span><span class="sh">"""</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">]</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="sh">'</span><span class="s">Size</span><span class="sh">'</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">10</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="sh">'</span><span class="s">Time (ms)</span><span class="sh">'</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">12</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="sh">'</span><span class="s">Throughput (M ops/sec)</span><span class="sh">'</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">15</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
        <span class="c1"># Generate random prices
</span>        <span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
        
        <span class="c1"># Time execution
</span>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">maxProfit</span><span class="p">(</span><span class="n">prices</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
        
        <span class="n">elapsed_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000_000</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="o">&lt;</span><span class="mi">10</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">elapsed_ms</span><span class="si">:</span><span class="o">&lt;</span><span class="mf">12.4</span><span class="n">f</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">throughput</span><span class="si">:</span><span class="o">&lt;</span><span class="mf">15.2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Run benchmark
</span><span class="nf">benchmark_maxProfit</span><span class="p">()</span>

<span class="c1"># Expected output (example):
# Size       Time (ms)    Throughput (M ops/sec)
# ---------------------------------------------
# 100        0.0045       22.22             
# 1000       0.0412       24.27             
# 10000      0.4123       24.25             
# 100000     4.1234       24.25             
# 1000000    41.2345      24.25
# 
# Observe: Linear time complexity → constant throughput
</span></code></pre></div></div>

<hr />

<h2 id="real-world-applications-beyond-finance">Real-World Applications Beyond Finance</h2>

<h3 id="1-network-latency-optimization">1. Network Latency Optimization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">findBestDataCenter</span><span class="p">(</span><span class="n">latencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Find best time to switch data centers to minimize latency
    
    Similar to stock problem:
    - latencies[i] = latency on day i
    - Find switch that gives max latency reduction
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">latencies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">max_latency</span> <span class="o">=</span> <span class="n">latencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Max latency seen so far (like min_price, inverted)
</span>    <span class="n">max_reduction</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Max reduction achievable
</span>    
    <span class="k">for</span> <span class="n">latency</span> <span class="ow">in</span> <span class="n">latencies</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">max_latency</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_latency</span><span class="p">,</span> <span class="n">latency</span><span class="p">)</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="n">max_latency</span> <span class="o">-</span> <span class="n">latency</span>  <span class="c1"># Reduction if we switch now
</span>        <span class="n">max_reduction</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_reduction</span><span class="p">,</span> <span class="n">reduction</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_reduction</span>
</code></pre></div></div>

<h3 id="2-cache-hit-rate-optimization">2. Cache Hit Rate Optimization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxCacheImprovement</span><span class="p">(</span><span class="n">hit_rates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Find when to deploy new cache strategy for max improvement
    
    Track minimum hit rate seen, compute max improvement
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">hit_rates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    
    <span class="n">min_hit_rate</span> <span class="o">=</span> <span class="n">hit_rates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_improvement</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">hit_rates</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">min_hit_rate</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_hit_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span>
        <span class="n">improvement</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">-</span> <span class="n">min_hit_rate</span>
        <span class="n">max_improvement</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">max_improvement</span><span class="p">,</span> <span class="n">improvement</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">max_improvement</span>
</code></pre></div></div>

<hr />

<h2 id="related-problems">Related Problems</h2>

<p>Practice these to master the pattern:</p>

<p><strong>Same Pattern:</strong></p>
<ul>
  <li><strong><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii/">Best Time to Buy and Sell Stock II</a></strong> - Multiple transactions</li>
  <li><strong><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/">Best Time to Buy and Sell Stock III</a></strong> - At most 2 transactions</li>
  <li><strong><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/">Best Time to Buy and Sell Stock IV</a></strong> - At most k transactions</li>
  <li><strong><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></strong></li>
  <li><strong><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/">Best Time to Buy and Sell Stock with Transaction Fee</a></strong></li>
</ul>

<p><strong>Similar Single-Pass Algorithms:</strong></p>
<ul>
  <li><strong><a href="https://leetcode.com/problems/maximum-subarray/">Maximum Subarray</a></strong> - Kadane’s algorithm</li>
  <li><strong><a href="https://leetcode.com/problems/maximum-product-subarray/">Maximum Product Subarray</a></strong> - Track min and max</li>
  <li><strong><a href="https://leetcode.com/problems/container-with-most-water/">Container With Most Water</a></strong> - Two pointers</li>
</ul>

<p><strong>Related Patterns:</strong></p>
<ul>
  <li><strong>Sliding Window Maximum</strong> - Maintain max in window</li>
  <li><strong>Running Median</strong> - Maintain statistics in stream</li>
  <li><strong>Stock Span Problem</strong> - Stack-based solution</li>
</ul>

<hr />

<p><strong>Originally published at:</strong> <a href="https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/">arunbaby.com/dsa/0004-best-time-buy-sell-stock</a></p>

<p><em>If you found this helpful, consider sharing it with others who might benefit.</em></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#arrays" class="page__taxonomy-item p-category" rel="tag">arrays</a><span class="sep">, </span>
    
      <a href="/tags/#dynamic-programming" class="page__taxonomy-item p-category" rel="tag">dynamic-programming</a><span class="sep">, </span>
    
      <a href="/tags/#greedy" class="page__taxonomy-item p-category" rel="tag">greedy</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#dsa" class="page__taxonomy-item p-category" rel="tag">dsa</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-10-13T22:42:39+05:30">October 13, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=arunbaby0&text=Best+Time+to+Buy+and+Sell+Stock%20https%3A%2F%2Fwww.arunbaby.com%2Fdsa%2F0004-best-time-buy-sell-stock%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.arunbaby.com%2Fdsa%2F0004-best-time-buy-sell-stock%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.arunbaby.com/dsa/0004-best-time-buy-sell-stock/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/dsa/0003-merge-sorted-lists/" class="pagination--pager" title="Merge Two Sorted Lists">Previous</a>
    
    
      <a href="/dsa/0005-maximum-subarray/" class="pagination--pager" title="Maximum Subarray (Kadane’s Algorithm)">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 1990 - 2143 <a href="https://www.arunbaby.com">Arun Baby</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0JRJPEC9SS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0JRJPEC9SS', { 'anonymize_ip': false});
</script>








  </body>
</html>
