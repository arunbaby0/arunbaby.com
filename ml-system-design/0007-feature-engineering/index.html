<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Feature Engineering at Scale - Arun Baby</title>
<meta name="description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">


  <meta name="author" content="Arun Baby">
  
  <meta property="article:author" content="Arun Baby">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Arun Baby">
<meta property="og:title" content="Feature Engineering at Scale">
<meta property="og:url" content="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">


  <meta property="og:description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">



  <meta property="og:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">



  <meta name="twitter:site" content="@arunbaby0">
  <meta name="twitter:title" content="Feature Engineering at Scale">
  <meta name="twitter:description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">
  <meta name="twitter:url" content="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">
    
  

  



  <meta property="article:published_time" content="2025-12-21T22:46:31+05:30">





  

  


<link rel="canonical" href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Arun Baby Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
           
          <span class="site-subtitle">Arun Baby</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/dsa/"
                
                
              >DSA</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ml-system-design/"
                
                
              >ML Systems</a>
            </li><li class="masthead__menu-item">
              <a
                href="/speech-tech/"
                
                
              >Speech Tech</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ai-agents/"
                
                
              >AI Agents</a>
            </li><li class="masthead__menu-item">
              <a
                href="/publications/"
                
                
              >Publications</a>
            </li><li class="masthead__menu-item">
              <a
                href="/statuses/"
                
                
              >Statuses</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact/"
                
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main" class="no-author-sidebar">
  
  <div class="sidebar sticky">
  
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Feature Engineering at Scale">
    <meta itemprop="description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">
    <meta itemprop="datePublished" content="2025-12-21T22:46:31+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/" itemprop="url">Feature Engineering at Scale
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          22 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#feature-engineering-pipeline-architecture">Feature Engineering Pipeline Architecture</a><ul><li><a href="#high-level-architecture">High-Level Architecture</a></li></ul></li><li><a href="#types-of-features">Types of Features</a><ul><li><a href="#1-numerical-features">1. Numerical Features</a></li><li><a href="#2-categorical-features">2. Categorical Features</a><ul><li><a href="#one-hot-encoding">One-Hot Encoding</a></li><li><a href="#label-encoding-for-ordinal-features">Label Encoding (for ordinal features)</a></li><li><a href="#target-encoding-mean-encoding">Target Encoding (Mean Encoding)</a></li></ul></li><li><a href="#3-text-features">3. Text Features</a><ul><li><a href="#tf-idf">TF-IDF</a></li><li><a href="#word-embeddings">Word Embeddings</a></li></ul></li><li><a href="#4-time-based-features">4. Time-Based Features</a></li><li><a href="#5-aggregation-features">5. Aggregation Features</a></li></ul></li><li><a href="#advanced-feature-engineering-techniques">Advanced Feature Engineering Techniques</a><ul><li><a href="#1-interaction-features">1. Interaction Features</a></li><li><a href="#2-binningdiscretization">2. Binning/Discretization</a></li><li><a href="#3-feature-crosses">3. Feature Crosses</a></li><li><a href="#4-embedding-features">4. Embedding Features</a></li></ul></li><li><a href="#feature-store-architecture">Feature Store Architecture</a><ul><li><a href="#feature-store-components">Feature Store Components</a></li><li><a href="#feature-store-benefits">Feature Store Benefits</a></li></ul></li><li><a href="#feature-engineering-for-tree-traversal">Feature Engineering for Tree Traversal</a><ul><li><a href="#hierarchical-features">Hierarchical Features</a></li></ul></li><li><a href="#connection-to-speech-processing-day-7">Connection to Speech Processing (Day 7)</a><ul><li><a href="#audio-feature-extraction-pipeline">Audio Feature Extraction Pipeline</a></li></ul></li><li><a href="#production-best-practices">Production Best Practices</a><ul><li><a href="#1-feature-versioning">1. Feature Versioning</a></li><li><a href="#2-feature-monitoring">2. Feature Monitoring</a></li><li><a href="#3-feature-documentation">3. Feature Documentation</a></li></ul></li><li><a href="#feature-selection-techniques">Feature Selection Techniques</a><ul><li><a href="#1-filter-methods">1. Filter Methods</a></li><li><a href="#2-wrapper-methods-forwardbackward-selection">2. Wrapper Methods (Forward/Backward Selection)</a></li><li><a href="#3-embedded-methods-l1-regularization">3. Embedded Methods (L1 Regularization)</a></li><li><a href="#4-feature-importance-from-models">4. Feature Importance from Models</a></li></ul></li><li><a href="#automated-feature-engineering">Automated Feature Engineering</a><ul><li><a href="#autofeat-with-featuretools">AutoFeat with Featuretools</a></li><li><a href="#custom-feature-generation">Custom Feature Generation</a></li></ul></li><li><a href="#real-world-case-studies">Real-World Case Studies</a><ul><li><a href="#case-study-1-netflix-recommendation-features">Case Study 1: Netflix Recommendation Features</a></li><li><a href="#case-study-2-uber-demand-prediction-features">Case Study 2: Uber Demand Prediction Features</a></li></ul></li><li><a href="#feature-engineering-at-scale-with-spark">Feature Engineering at Scale with Spark</a></li><li><a href="#cost-analysis--optimization">Cost Analysis &amp; Optimization</a><ul><li><a href="#feature-computation-cost">Feature Computation Cost</a></li></ul></li><li><a href="#key-takeaways">Key Takeaways</a></li></ul>
            </nav>
          </aside>
        
        <p><strong>Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.</strong></p>

<h2 id="introduction">Introduction</h2>

<p><strong>Feature engineering</strong> is the process of transforming raw data into features that better represent the underlying problem to ML models.</p>

<p><strong>Why it matters:</strong></p>
<ul>
  <li><strong>Makes models better:</strong> Good features &gt; complex models with bad features</li>
  <li><strong>Domain knowledge encoding:</strong> Capture expert insights in features</li>
  <li><strong>Data quality:</strong> Garbage in = garbage out</li>
  <li><strong>Production complexity:</strong> 80% of ML engineering time is data/feature work</li>
</ul>

<p><strong>Stat:</strong> Andrew Ng says “Applied ML is basically feature engineering”</p>

<hr />

<h2 id="feature-engineering-pipeline-architecture">Feature Engineering Pipeline Architecture</h2>

<h3 id="high-level-architecture">High-Level Architecture</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──────────────┐
│  Raw Data    │  (Logs, DB, Streams)
└──────┬───────┘
       │
       ▼
┌──────────────────────────────┐
│  Feature Engineering Layer   │
│  ┌─────────┐  ┌─────────┐   │
│  │Transform│  │ Compute │   │
│  │  Logic  │  │ Engines │   │
│  └─────────┘  └─────────┘   │
└──────────┬───────────────────┘
           │
           ▼
┌──────────────────────────────┐
│     Feature Store            │
│  ┌────────┐    ┌──────────┐ │
│  │ Online │    │ Offline  │ │
│  │Features│    │ Features │ │
│  │(low ms)│    │ (batch)  │ │
│  └────────┘    └──────────┘ │
└──────────┬───────────────────┘
           │
           ▼
┌──────────────────────────────┐
│       ML Models              │
│  ┌─────────┐  ┌──────────┐  │
│  │Training │  │ Serving  │  │
│  └─────────┘  └──────────┘  │
└──────────────────────────────┘
</code></pre></div></div>

<hr />

<h2 id="types-of-features">Types of Features</h2>

<h3 id="1-numerical-features">1. Numerical Features</h3>

<p><strong>Raw numerical values</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># Example dataset
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">125000</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">num_purchases</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Common transformations
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">age_squared</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">log_income</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">income_per_purchase</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">num_purchases</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 to avoid division by zero
</span></code></pre></div></div>

<h3 id="2-categorical-features">2. Categorical Features</h3>

<p><strong>Discrete values that represent categories</strong></p>

<h4 id="one-hot-encoding">One-Hot Encoding</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Simple one-hot encoding
</span><span class="n">df_categorical</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">NYC</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SF</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">LA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">NYC</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SF</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">mobile</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">desktop</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mobile</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">tablet</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">desktop</span><span class="sh">'</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># One-hot encode
</span><span class="n">df_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">df_categorical</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df_encoded</span><span class="p">)</span>
<span class="c1">#    city_LA  city_NYC  city_SF  device_desktop  device_mobile  device_tablet
# 0        0         1        0               0              1              0
# 1        0         0        1               1              0              0
# ...
</span></code></pre></div></div>

<h4 id="label-encoding-for-ordinal-features">Label Encoding (for ordinal features)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">small</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">large</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">small</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">large</span><span class="sh">'</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">le</span> <span class="o">=</span> <span class="nc">LabelEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">size_encoded</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">])</span>
<span class="c1"># small→0, medium→1, large→2
</span></code></pre></div></div>

<h4 id="target-encoding-mean-encoding">Target Encoding (Mean Encoding)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">target_encode</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Replace category with mean of target variable
    
    Good for high-cardinality categoricals
    </span><span class="sh">"""</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">column</span><span class="p">)[</span><span class="n">target</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>

<span class="c1"># Example
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">NYC</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SF</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">LA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">NYC</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SF</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">LA</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">conversion</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city_encoded</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">target_encode</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">conversion</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># NYC → 1.0 (2/2), SF → 0.0 (0/2), LA → 0.5 (1/2)
</span></code></pre></div></div>

<h3 id="3-text-features">3. Text Features</h3>

<p><strong>Transform text into numerical representations</strong></p>

<h4 id="tf-idf">TF-IDF</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>

<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">machine learning is awesome</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">deep learning is a subset of machine learning</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">natural language processing is fun</span><span class="sh">"</span>
<span class="p">]</span>

<span class="n">vectorizer</span> <span class="o">=</span> <span class="nc">TfidfVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tfidf_matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Shape: </span><span class="si">{</span><span class="n">tfidf_matrix</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Features: </span><span class="si">{</span><span class="n">vectorizer</span><span class="p">.</span><span class="nf">get_feature_names_out</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="word-embeddings">Word Embeddings</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Using pre-trained embeddings (e.g., Word2Vec, GloVe)
</span><span class="kn">import</span> <span class="n">gensim.downloader</span> <span class="k">as</span> <span class="n">api</span>

<span class="c1"># Load pre-trained model
</span><span class="n">word_vectors</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">glove-wiki-gigaword-100</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">text_to_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">word_vectors</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Average word vectors for text embedding
    </span><span class="sh">"""</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">split</span><span class="p">()</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">word_vectors</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_vectors</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">vectors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Example
</span><span class="n">text</span> <span class="o">=</span> <span class="sh">"</span><span class="s">machine learning</span><span class="sh">"</span>
<span class="n">embedding</span> <span class="o">=</span> <span class="nf">text_to_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">word_vectors</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Embedding shape: </span><span class="si">{</span><span class="n">embedding</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># (100,)
</span></code></pre></div></div>

<h3 id="4-time-based-features">4. Time-Based Features</h3>

<p><strong>Extract temporal patterns</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2024-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">H</span><span class="sh">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># Extract time features
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">hour</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">day_of_week</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">dayofweek</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">day_of_month</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">day</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">month</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">month</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">is_weekend</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">day_of_week</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">is_holiday</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">holiday_dates</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Cyclical encoding (hour wraps around)
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour_sin</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour_cos</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Cyclical encoding visualization:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hour encoding (linear):
0 ─ 6 ─ 12 ─ 18 ─ 24
                   │
                   └─&gt; Problem: 0 and 24 are far apart numerically!

Hour encoding (cyclical):
     0/24
      │
  21──┼──3
 │    │    │
18    │    6
 │    │    │
  15──┼──9
     12

Using sin/cos captures cyclical nature:
hour_sin = sin(2π × hour / 24)
hour_cos = cos(2π × hour / 24)
</code></pre></div></div>

<h3 id="5-aggregation-features">5. Aggregation Features</h3>

<p><strong>Statistics over groups</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example: user behavior features
</span><span class="n">user_sessions</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">session_duration</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">350</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">pages_viewed</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2024-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># Aggregate by user
</span><span class="n">user_features</span> <span class="o">=</span> <span class="n">user_sessions</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">session_duration</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">pages_viewed</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">]</span>  <span class="c1"># First/last session
</span><span class="p">}).</span><span class="nf">reset_index</span><span class="p">()</span>

<span class="c1"># Flatten column names
</span><span class="n">user_features</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">col</span><span class="p">).</span><span class="nf">strip</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">user_features</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">values</span><span class="p">]</span>

<span class="c1"># Time-windowed aggregations
</span><span class="n">user_sessions</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_sessions</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">date</span>

<span class="c1"># Last 7 days features
</span><span class="n">last_7_days</span> <span class="o">=</span> <span class="n">user_sessions</span><span class="p">[</span>
    <span class="n">user_sessions</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">user_sessions</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">user_features_7d</span> <span class="o">=</span> <span class="n">last_7_days</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">session_duration</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">pages_viewed</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span>
<span class="p">}).</span><span class="nf">add_suffix</span><span class="p">(</span><span class="sh">'</span><span class="s">_7d</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="advanced-feature-engineering-techniques">Advanced Feature Engineering Techniques</h2>

<h3 id="1-interaction-features">1. Interaction Features</h3>

<p><strong>Capture relationships between features</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="c1"># Simple example
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">feature_a</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">feature_b</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Polynomial features (includes interactions)
</span><span class="n">poly</span> <span class="o">=</span> <span class="nc">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">poly_features</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="sh">'</span><span class="s">feature_a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">feature_b</span><span class="sh">'</span><span class="p">]])</span>

<span class="c1"># Creates: [a, b, a², ab, b²]
</span><span class="nf">print</span><span class="p">(</span><span class="n">poly</span><span class="p">.</span><span class="nf">get_feature_names_out</span><span class="p">())</span>
<span class="c1"># ['feature_a', 'feature_b', 'feature_a^2', 'feature_a feature_b', 'feature_b^2']
</span>
<span class="c1"># Manual domain-specific interactions
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">price_per_sqft</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">sqft</span><span class="sh">'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bedrooms_bathrooms_ratio</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bedrooms</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bathrooms</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-binningdiscretization">2. Binning/Discretization</h3>

<p><strong>Convert continuous to categorical</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Equal-width binning
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">age_bin</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
                        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">child</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">young_adult</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">adult</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">senior</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># Equal-frequency binning (quantiles)
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">income_quartile</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Q1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q4</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># Custom bins based on domain knowledge
</span><span class="k">def</span> <span class="nf">categorize_temperature</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">'</span><span class="s">freezing</span><span class="sh">'</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">'</span><span class="s">cold</span><span class="sh">'</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">'</span><span class="s">mild</span><span class="sh">'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">'</span><span class="s">hot</span><span class="sh">'</span>

<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">temp_category</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="n">categorize_temperature</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-feature-crosses">3. Feature Crosses</h3>

<p><strong>Combine multiple categorical features</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Simple feature cross
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city_device</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">]</span>
<span class="c1"># Creates: 'NYC_mobile', 'SF_desktop', etc.
</span>
<span class="c1"># Multiple feature crosses
</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city_device_hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hour_bin</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># Then one-hot encode the crosses
</span><span class="n">df_crossed</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">city_device</span><span class="sh">'</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">'</span><span class="s">city_device</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-embedding-features">4. Embedding Features</h3>

<p><strong>Learn dense representations</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>

<span class="k">def</span> <span class="nf">create_embedding_layer</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Create embedding layer for categorical feature
    
    Useful for high-cardinality categoricals (e.g., user_id, item_id)
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nc">Embedding</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span>
        <span class="n">output_dim</span><span class="o">=</span><span class="n">embedding_dim</span><span class="p">,</span>
        <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">regularizers</span><span class="p">.</span><span class="nf">l2</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Example: User embeddings
</span><span class="n">num_users</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">user_embedding_dim</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">user_input</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nc">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">)</span>
<span class="n">user_embedding</span> <span class="o">=</span> <span class="nf">create_embedding_layer</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">user_embedding_dim</span><span class="p">)(</span><span class="n">user_input</span><span class="p">)</span>
<span class="n">user_vec</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nc">Flatten</span><span class="p">()(</span><span class="n">user_embedding</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="feature-store-architecture">Feature Store Architecture</h2>

<p><strong>Problem:</strong> Features computed differently in training vs serving → prediction skew</p>

<p><strong>Solution:</strong> Centralized feature store with unified computation</p>

<h3 id="feature-store-components">Feature Store Components</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Feature</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Feature definition</span><span class="sh">"""</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">transform_fn</span><span class="p">:</span> <span class="n">Callable</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">batch_source</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Where to get data for batch computation
</span>    <span class="n">stream_source</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Where to get data for real-time
</span>
<span class="k">class</span> <span class="nc">FeatureStore</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Simplified feature store
    
    Real systems: Feast, Tecton, AWS SageMaker Feature Store
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">offline_store</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Batch features (historical)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">online_store</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># Real-time features (low latency)
</span>    
    <span class="k">def</span> <span class="nf">register_feature</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="n">Feature</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Register feature definition</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span>
    
    <span class="k">def</span> <span class="nf">compute_batch_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">entity_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Compute features for training (batch)
        
        Returns: DataFrame with features
        </span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">entity_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">entity_ids</span><span class="p">})</span>
        
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
            
            <span class="c1"># Load batch data
</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_batch_data</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">batch_source</span><span class="p">,</span> <span class="n">entity_id</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            
            <span class="c1"># Compute feature
</span>            <span class="n">result</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="p">.</span><span class="nf">transform_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">get_online_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Get features for serving (real-time)
        
        Returns: Dict of feature values
        </span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="c1"># Check online store
</span>            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="sh">"</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">online_store</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">online_store</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Compute on-the-fly (fallback)
</span>                <span class="n">feature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_stream_data</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">stream_source</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="p">.</span><span class="nf">transform_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">materialize_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Pre-compute features and store in online store
        
        Batch job that runs periodically
        </span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
            
            <span class="c1"># Compute for all entities
</span>            <span class="n">all_entities</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_all_entities</span><span class="p">()</span>
            
            <span class="k">for</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">all_entities</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_batch_data</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">batch_source</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">feature</span><span class="p">.</span><span class="nf">transform_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                
                <span class="c1"># Store in online store
</span>                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="sh">"</span>
                <span class="n">self</span><span class="p">.</span><span class="n">online_store</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    
    <span class="k">def</span> <span class="nf">_load_batch_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">entity_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># Load from data warehouse (e.g., BigQuery, Snowflake)
</span>        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">_load_stream_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="c1"># Load from stream (e.g., Kafka, Kinesis)
</span>        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">_get_all_entities</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Get all entity IDs
</span>        <span class="k">pass</span>

<span class="c1"># Example usage
</span><span class="n">feature_store</span> <span class="o">=</span> <span class="nc">FeatureStore</span><span class="p">()</span>

<span class="c1"># Register features
</span><span class="n">feature_store</span><span class="p">.</span><span class="nf">register_feature</span><span class="p">(</span><span class="nc">Feature</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">user_avg_purchase_amount_30d</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">transform_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">purchase_amount</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">(),</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">purchase_amount</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">batch_source</span><span class="o">=</span><span class="sh">'</span><span class="s">dwh.purchases</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">stream_source</span><span class="o">=</span><span class="sh">'</span><span class="s">kafka.purchases</span><span class="sh">'</span>
<span class="p">))</span>

<span class="c1"># Training: Get batch features
</span><span class="n">training_features</span> <span class="o">=</span> <span class="n">feature_store</span><span class="p">.</span><span class="nf">compute_batch_features</span><span class="p">(</span>
    <span class="n">entity_ids</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">user_1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">user_2</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">user_avg_purchase_amount_30d</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Serving: Get online features (&lt; 10ms)
</span><span class="n">serving_features</span> <span class="o">=</span> <span class="n">feature_store</span><span class="p">.</span><span class="nf">get_online_features</span><span class="p">(</span>
    <span class="n">entity_id</span><span class="o">=</span><span class="sh">'</span><span class="s">user_1</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">user_avg_purchase_amount_30d</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="feature-store-benefits">Feature Store Benefits</h3>

<p><strong>Training-Serving Consistency:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Without Feature Store:
  Training:  Compute features in Python/Spark
  Serving:   Reimplement in Java/Go
  Result:    Different implementations → prediction skew!

With Feature Store:
  Training:  feature_store.get_offline_features()
  Serving:   feature_store.get_online_features()
  Result:    Same computation logic → consistent!
</code></pre></div></div>

<hr />

<h2 id="feature-engineering-for-tree-traversal">Feature Engineering for Tree Traversal</h2>

<p>Connecting to DSA Day 7 (tree traversal):</p>

<h3 id="hierarchical-features">Hierarchical Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CategoryTree</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Category hierarchy (like tree traversal)
    
    Example:
                Electronics
               /          </span><span class="se">\
</span><span class="s">         Computers      Phones
        /       \         |
    Laptops  Desktops  Smartphones
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tree</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">Electronics</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">Computers</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">Laptops</span><span class="sh">'</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="sh">'</span><span class="s">Desktops</span><span class="sh">'</span><span class="p">:</span> <span class="p">{}</span>
                <span class="p">},</span>
                <span class="sh">'</span><span class="s">Phones</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">Smartphones</span><span class="sh">'</span><span class="p">:</span> <span class="p">{}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">get_category_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">
        Get path from root to category
        
        Uses DFS (similar to tree traversal)
        </span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">subtree</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">child</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">result</span>
            
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">subtree</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="p">[</span><span class="n">root</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">path</span>
        
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">category_level_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Create features from category hierarchy
        
        level_1: Electronics
        level_2: Computers
        level_3: Laptops
        </span><span class="sh">"""</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_category_path</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
        
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">features</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="s">category_level_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat</span>
        
        <span class="k">return</span> <span class="n">features</span>

<span class="c1"># Example
</span><span class="n">cat_tree</span> <span class="o">=</span> <span class="nc">CategoryTree</span><span class="p">()</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">cat_tree</span><span class="p">.</span><span class="nf">category_level_features</span><span class="p">(</span><span class="sh">'</span><span class="s">Laptops</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="c1"># {'category_level_1': 'Electronics', 
#  'category_level_2': 'Computers', 
#  'category_level_3': 'Laptops'}
</span></code></pre></div></div>

<hr />

<h2 id="connection-to-speech-processing-day-7">Connection to Speech Processing (Day 7)</h2>

<p>Feature engineering is critical in speech ML:</p>

<h3 id="audio-feature-extraction-pipeline">Audio Feature Extraction Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AudioFeatureExtractor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Extract features from audio (similar to general feature engineering)
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">extract_spectral_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract spectral features
        
        Similar to numerical feature engineering
        </span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">librosa</span>
        
        <span class="c1"># Mel-frequency cepstral coefficients
</span>        <span class="n">mfccs</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">mfcc</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">n_mfcc</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        
        <span class="c1"># Spectral features
</span>        <span class="n">spectral_centroid</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">spectral_centroid</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">)</span>
        <span class="n">spectral_rolloff</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">spectral_rolloff</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">)</span>
        
        <span class="c1"># Aggregate over time (similar to aggregation features)
</span>        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">mfcc_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">mfcc_std</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">mfccs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spectral_centroid_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">spectral_centroid</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spectral_rolloff_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">spectral_rolloff</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">extract_prosodic_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Extract prosody features (pitch, energy, duration)
        
        Domain-specific feature engineering
        </span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">librosa</span>
        
        <span class="c1"># Pitch (F0)
</span>        <span class="n">f0</span><span class="p">,</span> <span class="n">voiced_flag</span><span class="p">,</span> <span class="n">voiced_probs</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="nf">pyin</span><span class="p">(</span>
            <span class="n">audio</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">librosa</span><span class="p">.</span><span class="nf">note_to_hz</span><span class="p">(</span><span class="sh">'</span><span class="s">C2</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">fmax</span><span class="o">=</span><span class="n">librosa</span><span class="p">.</span><span class="nf">note_to_hz</span><span class="p">(</span><span class="sh">'</span><span class="s">C7</span><span class="sh">'</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Energy
</span>        <span class="n">energy</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">rms</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="c1"># Duration features
</span>        <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">librosa</span><span class="p">.</span><span class="n">feature</span><span class="p">.</span><span class="nf">zero_crossing_rate</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
        
        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">pitch_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanmean</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">pitch_std</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanstd</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">pitch_range</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanmax</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanmin</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">energy_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">energy_std</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">zcr_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">zero_crossings</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></div>

<hr />

<h2 id="production-best-practices">Production Best Practices</h2>

<h3 id="1-feature-versioning">1. Feature Versioning</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">VersionedFeature</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Track feature versions</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">transform_fn</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="n">self</span><span class="p">.</span><span class="n">transform_fn</span> <span class="o">=</span> <span class="n">transform_fn</span>
        <span class="n">self</span><span class="p">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">_v</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">version</span><span class="si">}</span><span class="sh">"</span>

<span class="c1"># Example
</span><span class="n">user_age_v1</span> <span class="o">=</span> <span class="nc">VersionedFeature</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">transform_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">birth_year</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2024</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">user_age_v2</span> <span class="o">=</span> <span class="nc">VersionedFeature</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">transform_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">year</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">birth_year</span><span class="sh">'</span><span class="p">]).</span><span class="nf">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Models can specify feature version
</span><span class="n">model_features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">user_age_v2</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Use version 2
</span>    <span class="sh">'</span><span class="s">income_v1</span><span class="sh">'</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="2-feature-monitoring">2. Feature Monitoring</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FeatureMonitor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Monitor feature distributions</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">baseline_stats</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">compute_stats</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute feature statistics</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">nulls</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">).</span><span class="nf">sum</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">unique_count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">unique</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">set_baseline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Set baseline statistics</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">baseline_stats</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">compute_stats</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_drift</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Check if feature distribution has drifted
        
        Returns: (has_drifted, drift_metrics)
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">baseline_stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="p">{}</span>
        
        <span class="n">current_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">compute_stats</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">baseline_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">baseline_stats</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
        
        <span class="c1"># Check mean drift
</span>        <span class="n">mean_drift</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">baseline_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">baseline_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="c1"># Check std drift
</span>        <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">baseline_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="n">drift_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">mean_drift</span><span class="sh">'</span><span class="p">:</span> <span class="n">mean_drift</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">std_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">std_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">null_rate_change</span><span class="sh">'</span><span class="p">:</span> <span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">nulls</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="n">baseline_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">nulls</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="n">has_drifted</span> <span class="o">=</span> <span class="n">mean_drift</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">or</span> <span class="n">std_ratio</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="ow">or</span> <span class="n">std_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
        
        <span class="k">return</span> <span class="n">has_drifted</span><span class="p">,</span> <span class="n">drift_metrics</span>

<span class="c1"># Usage
</span><span class="n">monitor</span> <span class="o">=</span> <span class="nc">FeatureMonitor</span><span class="p">()</span>

<span class="c1"># Set baseline during training
</span><span class="n">monitor</span><span class="p">.</span><span class="nf">set_baseline</span><span class="p">(</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">,</span> <span class="n">training_df</span><span class="p">[</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">].</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># Check for drift in production
</span><span class="n">has_drifted</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">monitor</span><span class="p">.</span><span class="nf">check_drift</span><span class="p">(</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">,</span> <span class="n">production_df</span><span class="p">[</span><span class="sh">'</span><span class="s">user_age</span><span class="sh">'</span><span class="p">].</span><span class="n">values</span><span class="p">)</span>
<span class="k">if</span> <span class="n">has_drifted</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">⚠️ Feature drift detected: </span><span class="si">{</span><span class="n">metrics</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-feature-documentation">3. Feature Documentation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FeatureDocumentation</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Document features for team collaboration</span><span class="sh">"""</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">creation_date</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">update_frequency</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># 'realtime', 'hourly', 'daily'
</span>    <span class="n">sla_ms</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># SLA for feature computation
</span>    <span class="n">example_values</span><span class="p">:</span> <span class="n">List</span>
    
    <span class="k">def</span> <span class="nf">to_markdown</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate markdown documentation</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
# Feature: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">

**Description:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">description</span><span class="si">}</span><span class="s">

**Owner:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="si">}</span><span class="s">

**Created:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">creation_date</span><span class="si">}</span><span class="s">

**Update Frequency:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">update_frequency</span><span class="si">}</span><span class="s">

**SLA:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">sla_ms</span><span class="si">}</span><span class="s">ms

**Dependencies:** </span><span class="si">{</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span><span class="si">}</span><span class="s">

**Example Values:** </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">example_values</span><span class="p">[</span><span class="si">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s">
</span><span class="sh">"""</span>

<span class="c1"># Example
</span><span class="n">feature_doc</span> <span class="o">=</span> <span class="nc">FeatureDocumentation</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">user_purchase_frequency_30d</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Number of purchases by user in last 30 days</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">owner</span><span class="o">=</span><span class="sh">'</span><span class="s">ml-team@company.com</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">creation_date</span><span class="o">=</span><span class="sh">'</span><span class="s">2024-01-15</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">purchase_events</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">update_frequency</span><span class="o">=</span><span class="sh">'</span><span class="s">hourly</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">sla_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">example_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">feature_doc</span><span class="p">.</span><span class="nf">to_markdown</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h2 id="feature-selection-techniques">Feature Selection Techniques</h2>

<p><strong>Problem:</strong> Too many features can lead to:</p>
<ul>
  <li>Overfitting</li>
  <li>Increased computation</li>
  <li>Reduced interpretability</li>
</ul>

<h3 id="1-filter-methods">1. Filter Methods</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">f_classif</span><span class="p">,</span> <span class="n">mutual_info_classif</span>
<span class="kn">from</span> <span class="n">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Generate sample data
</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_informative</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ANOVA F-test
</span><span class="n">selector_f</span> <span class="o">=</span> <span class="nc">SelectKBest</span><span class="p">(</span><span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_selected_f</span> <span class="o">=</span> <span class="n">selector_f</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Get selected feature indices
</span><span class="n">selected_features_f</span> <span class="o">=</span> <span class="n">selector_f</span><span class="p">.</span><span class="nf">get_support</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Selected features (F-test): </span><span class="si">{</span><span class="n">selected_features_f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Mutual Information
</span><span class="n">selector_mi</span> <span class="o">=</span> <span class="nc">SelectKBest</span><span class="p">(</span><span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_selected_mi</span> <span class="o">=</span> <span class="n">selector_mi</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Original features: </span><span class="si">{</span><span class="n">X</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Selected features: </span><span class="si">{</span><span class="n">X_selected_f</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-wrapper-methods-forwardbackward-selection">2. Wrapper Methods (Forward/Backward Selection)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="c1"># Forward selection
</span><span class="n">sfs</span> <span class="o">=</span> <span class="nc">SequentialFeatureSelector</span><span class="p">(</span>
    <span class="nc">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="sh">'</span><span class="s">forward</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>

<span class="n">sfs</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">selected_features</span> <span class="o">=</span> <span class="n">sfs</span><span class="p">.</span><span class="nf">get_support</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Forward selection features: </span><span class="si">{</span><span class="n">selected_features</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-embedded-methods-l1-regularization">3. Embedded Methods (L1 Regularization)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># Lasso for feature selection
</span><span class="n">lasso</span> <span class="o">=</span> <span class="nc">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">lasso</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Features with non-zero coefficients
</span><span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">lasso</span><span class="p">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="n">selected_features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">importance</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lasso selected </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">)</span><span class="si">}</span><span class="s"> features</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Feature importance: </span><span class="si">{</span><span class="n">importance</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-feature-importance-from-models">4. Feature Importance from Models</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Train model
</span><span class="n">rf</span> <span class="o">=</span> <span class="nc">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">rf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Get feature importance
</span><span class="n">importance</span> <span class="o">=</span> <span class="n">rf</span><span class="p">.</span><span class="n">feature_importances_</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argsort</span><span class="p">(</span><span class="n">importance</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Plot
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Feature Importance</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">importance</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Feature Index</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Importance</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Select top k features
</span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">top_features</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Top </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s"> features: </span><span class="si">{</span><span class="n">top_features</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="automated-feature-engineering">Automated Feature Engineering</h2>

<h3 id="autofeat-with-featuretools">AutoFeat with Featuretools</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Featuretools for automated feature engineering
</span><span class="kn">import</span> <span class="n">featuretools</span> <span class="k">as</span> <span class="n">ft</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Example: E-commerce transactions
</span><span class="n">customers</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">NYC</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SF</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">LA</span><span class="sh">'</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">transaction_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2024-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># Create entity set
</span><span class="n">es</span> <span class="o">=</span> <span class="n">ft</span><span class="p">.</span><span class="nc">EntitySet</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sh">'</span><span class="s">customer_transactions</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Add entities
</span><span class="n">es</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">add_dataframe</span><span class="p">(</span>
    <span class="n">dataframe_name</span><span class="o">=</span><span class="sh">'</span><span class="s">customers</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">dataframe</span><span class="o">=</span><span class="n">customers</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span>
<span class="p">)</span>

<span class="n">es</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">add_dataframe</span><span class="p">(</span>
    <span class="n">dataframe_name</span><span class="o">=</span><span class="sh">'</span><span class="s">transactions</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">dataframe</span><span class="o">=</span><span class="n">transactions</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">transaction_id</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">time_index</span><span class="o">=</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span>
<span class="p">)</span>

<span class="c1"># Add relationship
</span><span class="n">es</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">add_relationship</span><span class="p">(</span><span class="sh">'</span><span class="s">customers</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">transactions</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Generate features automatically
</span><span class="n">feature_matrix</span><span class="p">,</span> <span class="n">feature_defs</span> <span class="o">=</span> <span class="n">ft</span><span class="p">.</span><span class="nf">dfs</span><span class="p">(</span>
    <span class="n">entityset</span><span class="o">=</span><span class="n">es</span><span class="p">,</span>
    <span class="n">target_dataframe_name</span><span class="o">=</span><span class="sh">'</span><span class="s">customers</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Generated </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">feature_defs</span><span class="p">)</span><span class="si">}</span><span class="s"> features automatically</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">feature_matrix</span><span class="p">.</span><span class="nf">head</span><span class="p">())</span>

<span class="c1"># Features like:
# - SUM(transactions.amount)
# - MEAN(transactions.amount)
# - COUNT(transactions)
# - MAX(transactions.timestamp)
</span></code></pre></div></div>

<h3 id="custom-feature-generation">Custom Feature Generation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AutoFeatureGenerator</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Automatically generate mathematical transformations
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">operations</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">square</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sqrt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">log</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">reciprocal</span><span class="sh">'</span><span class="p">]):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">operations</span> <span class="o">=</span> <span class="n">operations</span>
    
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">numerical_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Generate features by applying operations
        
        Args:
            df: DataFrame
            numerical_columns: Columns to transform
        
        Returns:
            DataFrame with original + generated features
        </span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numerical_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">square</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">operations</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">_squared</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
            
            <span class="k">if</span> <span class="sh">'</span><span class="s">sqrt</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">operations</span><span class="p">:</span>
                <span class="c1"># Only for non-negative
</span>                <span class="nf">if </span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">():</span>
                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">_sqrt</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="sh">'</span><span class="s">log</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">operations</span><span class="p">:</span>
                <span class="c1"># Only for positive
</span>                <span class="nf">if </span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">all</span><span class="p">():</span>
                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">_log</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="sh">'</span><span class="s">reciprocal</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">operations</span><span class="p">:</span>
                <span class="c1"># Avoid division by zero
</span>                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">_reciprocal</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="c1"># Generate interactions
</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col1</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">numerical_columns</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col2</span> <span class="ow">in</span> <span class="n">numerical_columns</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s">_times_</span><span class="si">{</span><span class="n">col2</span><span class="si">}</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span>
                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s">_div_</span><span class="si">{</span><span class="n">col2</span><span class="si">}</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Usage
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">feature_a</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">feature_b</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">generator</span> <span class="o">=</span> <span class="nc">AutoFeatureGenerator</span><span class="p">()</span>
<span class="n">df_with_features</span> <span class="o">=</span> <span class="n">generator</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">feature_a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">feature_b</span><span class="sh">'</span><span class="p">])</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Original features: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">After generation: </span><span class="si">{</span><span class="n">df_with_features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df_with_features</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">tolist</span><span class="p">())</span>
</code></pre></div></div>

<hr />

<h2 id="real-world-case-studies">Real-World Case Studies</h2>

<h3 id="case-study-1-netflix-recommendation-features">Case Study 1: Netflix Recommendation Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NetflixFeatureEngine</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Feature engineering for content recommendation
    
    Based on public Netflix research papers
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">engineer_user_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_history</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        User behavioral features
        
        Args:
            user_history: DataFrame with user viewing history
        
        Returns:
            User features
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Viewing patterns
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">total_watch_time</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">watch_duration</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_watch_time</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">watch_duration</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">num_titles_watched</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">title_id</span><span class="sh">'</span><span class="p">].</span><span class="nf">nunique</span><span class="p">()</span>
        
        <span class="c1"># Time-based patterns
</span>        <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]).</span><span class="n">dt</span><span class="p">.</span><span class="n">hour</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">favorite_hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">).</span><span class="nf">size</span><span class="p">().</span><span class="nf">idxmax</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">weekend_ratio</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">is_weekend</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">user_history</span><span class="p">))</span>
        
        <span class="c1"># Genre preferences
</span>        <span class="n">genre_counts</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">genre</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">favorite_genre</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">genre_counts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">genre_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">genre_diversity</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">genre</span><span class="sh">'</span><span class="p">].</span><span class="nf">nunique</span><span class="p">()</span>
        
        <span class="c1"># Completion rate
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">completion_rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">watch_duration</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">total_duration</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="c1"># Binge-watching behavior
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_sessions_per_day</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span>
            <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">date</span>
        <span class="p">).</span><span class="nf">size</span><span class="p">().</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="c1"># Recency features
</span>        <span class="n">last_watch</span> <span class="o">=</span> <span class="n">user_history</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">days_since_last_watch</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_watch</span><span class="p">).</span><span class="n">days</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">engineer_content_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">content_metadata</span><span class="p">,</span> <span class="n">user_interactions</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Content-based features
        
        Combine metadata + user engagement
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Popularity features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">view_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">user_interactions</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">unique_viewers</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_interactions</span><span class="p">[</span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">].</span><span class="nf">nunique</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_rating</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_interactions</span><span class="p">[</span><span class="sh">'</span><span class="s">rating</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="c1"># Engagement features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_completion_rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">user_interactions</span><span class="p">[</span><span class="sh">'</span><span class="s">watch_duration</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">content_metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="c1"># Temporal features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">days_since_release</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">content_metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">release_date</span><span class="sh">'</span><span class="p">])</span>
        <span class="p">).</span><span class="n">days</span>
        
        <span class="c1"># Freshness score (decaying popularity)
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">freshness_score</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">view_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">days_since_release</span><span class="sh">'</span><span class="p">]))</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></div>

<h3 id="case-study-2-uber-demand-prediction-features">Case Study 2: Uber Demand Prediction Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UberDemandFeatures</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Feature engineering for ride demand prediction
    
    Inspired by Uber</span><span class="sh">'</span><span class="s">s blog posts on ML
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">engineer_spatial_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">location_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Spatial features for demand prediction
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Grid-based features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">grid_id</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">lat_lon_to_grid</span><span class="p">(</span>
            <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Distance to key locations
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">dist_to_airport</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">haversine_distance</span><span class="p">(</span>
            <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span> <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">airport_lat</span><span class="p">,</span> <span class="n">airport_lon</span>
        <span class="p">)</span>
        
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">dist_to_downtown</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">haversine_distance</span><span class="p">(</span>
            <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span> <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">downtown_lat</span><span class="p">,</span> <span class="n">downtown_lon</span>
        <span class="p">)</span>
        
        <span class="c1"># Neighborhood features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_business_district</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_business_district</span><span class="p">(</span>
            <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span> <span class="n">location_data</span><span class="p">[</span><span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">engineer_temporal_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Time-based features for demand
        </span><span class="sh">"""</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Basic time features
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">hour</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">day_of_week</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">dayofweek</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_weekend</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">dayofweek</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        
        <span class="c1"># Peak hours
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_morning_rush</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;=</span> <span class="n">ts</span><span class="p">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_evening_rush</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span> <span class="o">&lt;=</span> <span class="n">ts</span><span class="p">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">19</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_late_night</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">23</span> <span class="o">&lt;=</span> <span class="n">ts</span><span class="p">.</span><span class="n">hour</span> <span class="ow">or</span> <span class="n">ts</span><span class="p">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span>
        
        <span class="c1"># Special events
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_holiday</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_holiday</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_major_event_day</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_events</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        
        <span class="c1"># Weather features (if available)
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">is_raining</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_weather</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="sh">'</span><span class="s">rain</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_weather</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="sh">'</span><span class="s">temp</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">engineer_historical_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">lookback_days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Historical demand features
        </span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># Same hour, previous days
</span>        <span class="k">for</span> <span class="n">days_ago</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">]:</span>
            <span class="n">past_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_ago</span><span class="p">)</span>
            <span class="n">features</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="s">demand_</span><span class="si">{</span><span class="n">days_ago</span><span class="si">}</span><span class="s">d_ago</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_historical_demand</span><span class="p">(</span>
                <span class="n">location</span><span class="p">,</span> <span class="n">past_timestamp</span>
            <span class="p">)</span>
        
        <span class="c1"># Moving averages
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">demand_7d_avg</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_avg_demand</span><span class="p">(</span>
            <span class="n">location</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">lookback_days</span><span class="o">=</span><span class="mi">7</span>
        <span class="p">)</span>
        
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">demand_7d_std</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_std_demand</span><span class="p">(</span>
            <span class="n">location</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">lookback_days</span><span class="o">=</span><span class="mi">7</span>
        <span class="p">)</span>
        
        <span class="c1"># Trend
</span>        <span class="n">recent_demand</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_demand_series</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">demand_trend</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">compute_trend</span><span class="p">(</span><span class="n">recent_demand</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">haversine_distance</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate distance between two points on Earth</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">math</span> <span class="kn">import</span> <span class="n">radians</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">asin</span><span class="p">,</span> <span class="n">sqrt</span>
        
        <span class="c1"># Convert to radians
</span>        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="n">radians</span><span class="p">,</span> <span class="p">[</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">])</span>
        
        <span class="c1"># Haversine formula
</span>        <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="nf">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="nf">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="nf">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nf">asin</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        
        <span class="c1"># Radius of Earth in kilometers
</span>        <span class="n">r</span> <span class="o">=</span> <span class="mi">6371</span>
        
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">r</span>
</code></pre></div></div>

<hr />

<h2 id="feature-engineering-at-scale-with-spark">Feature Engineering at Scale with Spark</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span> <span class="n">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>

<span class="k">class</span> <span class="nc">SparkFeatureEngine</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Scalable feature engineering with Apache Spark
    
    For datasets too large for pandas
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
            <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">FeatureEngineering</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">aggregate_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">group_by_col</span><span class="p">,</span> <span class="n">agg_col</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute aggregations at scale
        
        Args:
            df: Spark DataFrame
            group_by_col: Column to group by (e.g., </span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="s">)
            agg_col: Column to aggregate (e.g., </span><span class="sh">'</span><span class="s">purchase_amount</span><span class="sh">'</span><span class="s">)
        
        Returns:
            DataFrame with aggregated features
        </span><span class="sh">"""</span>
        <span class="n">agg_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="n">group_by_col</span><span class="p">).</span><span class="nf">agg</span><span class="p">(</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_count</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_sum</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_mean</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">stddev</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_std</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_min</span><span class="sh">'</span><span class="p">),</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">agg_col</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">agg_col</span><span class="si">}</span><span class="s">_max</span><span class="sh">'</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">agg_df</span>
    
    <span class="k">def</span> <span class="nf">window_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">partition_col</span><span class="p">,</span> <span class="n">order_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Compute window features (rolling aggregations)
        
        Example: 7-day rolling average
        </span><span class="sh">"""</span>
        <span class="c1"># Define window
</span>        <span class="n">days_7</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">86400</span>  <span class="c1"># 7 days in seconds
</span>        
        <span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span> \
            <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="n">partition_col</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="n">order_col</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">'</span><span class="s">long</span><span class="sh">'</span><span class="p">))</span> \
            <span class="p">.</span><span class="nf">rangeBetween</span><span class="p">(</span><span class="o">-</span><span class="n">days_7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Compute rolling features
</span>        <span class="n">df_with_window</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s">_7d_avg</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">avg</span><span class="p">(</span><span class="n">value_col</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">withColumn</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s">_7d_sum</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">value_col</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">withColumn</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s">_7d_count</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">F</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="n">value_col</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df_with_window</span>
    
    <span class="k">def</span> <span class="nf">lag_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">partition_col</span><span class="p">,</span> <span class="n">order_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">
        Create lag features (previous values)
        </span><span class="sh">"""</span>
        <span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span> \
            <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="n">partition_col</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="n">order_col</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s">_lag_</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">F</span><span class="p">.</span><span class="nf">lag</span><span class="p">(</span><span class="n">value_col</span><span class="p">,</span> <span class="n">lag</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Usage example
# spark_fe = SparkFeatureEngine()
# 
# # Load large dataset
# df = spark_fe.spark.read.parquet('s3://bucket/data/')
# 
# # Compute features at scale
# df_features = spark_fe.aggregate_features(df, 'user_id', 'purchase_amount')
# df_features = spark_fe.window_features(df, 'user_id', 'timestamp', 'purchase_amount')
</span></code></pre></div></div>

<hr />

<h2 id="cost-analysis--optimization">Cost Analysis &amp; Optimization</h2>

<h3 id="feature-computation-cost">Feature Computation Cost</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FeatureCostAnalyzer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Analyze cost of feature computation
    
    Important for production systems
    </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">feature_costs</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">measure_cost</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">compute_fn</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Measure computation cost
        
        Returns: (time_ms, memory_mb)
        </span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">time</span>
        <span class="kn">import</span> <span class="n">tracemalloc</span>
        
        <span class="c1"># Measure time
</span>        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
            <span class="nf">compute_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
            <span class="n">times</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># ms
</span>        
        <span class="n">avg_time</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        
        <span class="c1"># Measure memory
</span>        <span class="n">tracemalloc</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
        <span class="nf">compute_fn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">current</span><span class="p">,</span> <span class="n">peak</span> <span class="o">=</span> <span class="n">tracemalloc</span><span class="p">.</span><span class="nf">get_traced_memory</span><span class="p">()</span>
        <span class="n">tracemalloc</span><span class="p">.</span><span class="nf">stop</span><span class="p">()</span>
        
        <span class="n">memory_mb</span> <span class="o">=</span> <span class="n">peak</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">feature_costs</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">time_ms</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_time</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">memory_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">memory_mb</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">cost_score</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_time</span> <span class="o">*</span> <span class="n">memory_mb</span>  <span class="c1"># Simple cost metric
</span>        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">avg_time</span><span class="p">,</span> <span class="n">memory_mb</span>
    
    <span class="k">def</span> <span class="nf">recommend_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_importance</span><span class="p">,</span> <span class="n">cost_threshold</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Recommend features based on importance vs cost trade-off
        
        Args:
            feature_importance: Dict {feature_name: importance_score}
            cost_threshold: Maximum acceptable cost
        
        Returns:
            List of recommended features
        </span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">importance</span> <span class="ow">in</span> <span class="n">feature_importance</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">feature_costs</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">cost</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">feature_costs</span><span class="p">[</span><span class="n">feature_name</span><span class="p">][</span><span class="sh">'</span><span class="s">cost_score</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="c1"># Value/cost ratio
</span>            <span class="n">value_ratio</span> <span class="o">=</span> <span class="n">importance</span> <span class="o">/</span> <span class="p">(</span><span class="n">cost</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">cost</span> <span class="o">&lt;=</span> <span class="n">cost_threshold</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">feature</span><span class="sh">'</span><span class="p">:</span> <span class="n">feature_name</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">importance</span><span class="sh">'</span><span class="p">:</span> <span class="n">importance</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">cost</span><span class="sh">'</span><span class="p">:</span> <span class="n">cost</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">value_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">value_ratio</span>
                <span class="p">})</span>
        
        <span class="c1"># Sort by value ratio
</span>        <span class="n">recommendations</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">value_ratio</span><span class="sh">'</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># Example usage
</span><span class="n">analyzer</span> <span class="o">=</span> <span class="nc">FeatureCostAnalyzer</span><span class="p">()</span>

<span class="c1"># Measure costs
</span><span class="n">analyzer</span><span class="p">.</span><span class="nf">measure_cost</span><span class="p">(</span><span class="sh">'</span><span class="s">simple_sum</span><span class="sh">'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">col1</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">col2</span><span class="sh">'</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
<span class="n">analyzer</span><span class="p">.</span><span class="nf">measure_cost</span><span class="p">(</span><span class="sh">'</span><span class="s">complex_agg</span><span class="sh">'</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">'</span><span class="s">col</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">]}),</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Get recommendations
</span><span class="n">feature_importance</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">simple_sum</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="sh">'</span><span class="s">complex_agg</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>
<span class="n">recommended</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">recommend_features</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>

<p>✅ <strong>Feature engineering is critical</strong> - Often more impactful than model choice<br />
✅ <strong>Feature stores solve consistency</strong> - Same code for training and serving<br />
✅ <strong>Domain knowledge matters</strong> - Best features come from understanding the problem<br />
✅ <strong>Monitor features in production</strong> - Detect drift and data quality issues<br />
✅ <strong>Version features</strong> - Track changes, enable rollback<br />
✅ <strong>Document everything</strong> - Features are long-lived assets<br />
✅ <strong>Like tree traversal</strong> - Hierarchical features need DFS/BFS logic</p>

<hr />

<p><strong>Originally published at:</strong> <a href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">arunbaby.com/ml-system-design/0007-feature-engineering</a></p>

<p><em>If you found this helpful, consider sharing it with others who might benefit.</em></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#data-processing" class="page__taxonomy-item p-category" rel="tag">data-processing</a><span class="sep">, </span>
    
      <a href="/tags/#feature-engineering" class="page__taxonomy-item p-category" rel="tag">feature-engineering</a><span class="sep">, </span>
    
      <a href="/tags/#feature-store" class="page__taxonomy-item p-category" rel="tag">feature-store</a><span class="sep">, </span>
    
      <a href="/tags/#ml-pipeline" class="page__taxonomy-item p-category" rel="tag">ml-pipeline</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#ml-system-design" class="page__taxonomy-item p-category" rel="tag">ml-system-design</a>
    
    </span>
  </p>


        
      </footer>

      <div class="page__related page__related--full">
  <h2 class="page__related-title">Related across topics</h2>
  <style>
    /* Make section span full content width and use 2 equal columns */
    .page__related--full { float: inline-start; width: 100%; padding: 0; }
    .cross-related-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 2rem; }
    @media (max-width: 768px) { .cross-related-grid { grid-template-columns: 1fr; } }
    /* Ensure archive cards stretch nicely in the grid */
    .cross-related-grid .list__item, .cross-related-grid .grid__item { width: auto; float: none; margin: 0; }
  </style>
  <div class="cross-related-grid">
    



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/dsa/0007-binary-tree-traversal/" rel="permalink">Binary Tree Traversal
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          26 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Master the fundamental patterns of tree traversal: the gateway to solving hundreds of tree problems in interviews.
</p>
  </article>
</div>




<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/speech-tech/0007-audio-preprocessing/" rel="permalink">Audio Preprocessing &amp; Signal Processing
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          15 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Clean audio is the foundation of robust speech systems, master preprocessing pipelines that handle real-world noise and variability.
</p>
  </article>
</div>




<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ai-agents/0007-building-your-first-agent/" rel="permalink">Building Your First Agent
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">“Hello World? No, Hello Agent.”
</p>
  </article>
</div>

  </div>
</div>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=arunbaby0&text=Feature+Engineering+at+Scale%20https%3A%2F%2Fwww.arunbaby.com%2Fml-system-design%2F0007-feature-engineering%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.arunbaby.com%2Fml-system-design%2F0007-feature-engineering%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.arunbaby.com/ml-system-design/0007-feature-engineering/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ml-system-design/0006-model-evaluation-metrics/" class="pagination--pager" title="Model Evaluation Metrics">Previous</a>
    
    
      <a href="/ml-system-design/0008-model-serving-architecture/" class="pagination--pager" title="Model Serving Architecture">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 1990 - 2143 <a href="https://www.arunbaby.com">Arun Baby</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0JRJPEC9SS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0JRJPEC9SS', { 'anonymize_ip': false});
</script>








  </body>
</html>
