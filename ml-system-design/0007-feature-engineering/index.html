<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Feature Engineering at Scale - Arun Baby</title>
<meta name="description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">


  <meta name="author" content="Arun Baby">
  
  <meta property="article:author" content="Arun Baby">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Arun Baby">
<meta property="og:title" content="Feature Engineering at Scale">
<meta property="og:url" content="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">


  <meta property="og:description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">



  <meta property="og:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">



  <meta name="twitter:site" content="@arunbaby0">
  <meta name="twitter:title" content="Feature Engineering at Scale">
  <meta name="twitter:description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">
  <meta name="twitter:url" content="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.arunbaby.com/assets/images/profile-photo.png">
    
  

  



  <meta property="article:published_time" content="2025-12-31T10:07:50+05:30">





  

  


<link rel="canonical" href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Arun Baby Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
           
          <span class="site-subtitle">Arun Baby</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/dsa/"
                
                
              >DSA</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ml-system-design/"
                
                
              >ML Systems</a>
            </li><li class="masthead__menu-item">
              <a
                href="/speech-tech/"
                
                
              >Speech Tech</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ai-agents/"
                
                
              >AI Agents</a>
            </li><li class="masthead__menu-item">
              <a
                href="/publications/"
                
                
              >Publications</a>
            </li><li class="masthead__menu-item">
              <a
                href="/statuses/"
                
                
              >Statuses</a>
            </li><li class="masthead__menu-item">
              <a
                href="/contact/"
                
                
              >Contact</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main" class="no-author-sidebar">
  
  <div class="sidebar sticky">
  
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Feature Engineering at Scale">
    <meta itemprop="description" content="Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.">
    <meta itemprop="datePublished" content="2025-12-31T10:07:50+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/" itemprop="url">Feature Engineering at Scale
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          22 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#feature-engineering-pipeline-architecture">Feature Engineering Pipeline Architecture</a><ul><li><a href="#high-level-architecture">High-Level Architecture</a></li></ul></li><li><a href="#types-of-features">Types of Features</a><ul><li><a href="#1-numerical-features">1. Numerical Features</a></li><li><a href="#2-categorical-features">2. Categorical Features</a><ul><li><a href="#one-hot-encoding">One-Hot Encoding</a></li><li><a href="#label-encoding-for-ordinal-features">Label Encoding (for ordinal features)</a></li><li><a href="#target-encoding-mean-encoding">Target Encoding (Mean Encoding)</a></li></ul></li><li><a href="#3-text-features">3. Text Features</a><ul><li><a href="#tf-idf">TF-IDF</a></li><li><a href="#word-embeddings">Word Embeddings</a></li></ul></li><li><a href="#4-time-based-features">4. Time-Based Features</a></li><li><a href="#5-aggregation-features">5. Aggregation Features</a></li></ul></li><li><a href="#advanced-feature-engineering-techniques">Advanced Feature Engineering Techniques</a><ul><li><a href="#1-interaction-features">1. Interaction Features</a></li><li><a href="#2-binningdiscretization">2. Binning/Discretization</a></li><li><a href="#3-feature-crosses">3. Feature Crosses</a></li><li><a href="#4-embedding-features">4. Embedding Features</a></li></ul></li><li><a href="#feature-store-architecture">Feature Store Architecture</a><ul><li><a href="#feature-store-components">Feature Store Components</a></li><li><a href="#feature-store-benefits">Feature Store Benefits</a></li></ul></li><li><a href="#feature-engineering-for-tree-traversal">Feature Engineering for Tree Traversal</a><ul><li><a href="#hierarchical-features">Hierarchical Features</a></li></ul></li><li><a href="#connection-to-speech-processing">Connection to Speech Processing</a><ul><li><a href="#audio-feature-extraction-pipeline">Audio Feature Extraction Pipeline</a></li></ul></li><li><a href="#production-best-practices">Production Best Practices</a><ul><li><a href="#1-feature-versioning">1. Feature Versioning</a></li><li><a href="#2-feature-monitoring">2. Feature Monitoring</a></li><li><a href="#3-feature-documentation">3. Feature Documentation</a></li></ul></li><li><a href="#feature-selection-techniques">Feature Selection Techniques</a><ul><li><a href="#1-filter-methods">1. Filter Methods</a></li><li><a href="#2-wrapper-methods-forwardbackward-selection">2. Wrapper Methods (Forward/Backward Selection)</a></li><li><a href="#3-embedded-methods-l1-regularization">3. Embedded Methods (L1 Regularization)</a></li><li><a href="#4-feature-importance-from-models">4. Feature Importance from Models</a></li></ul></li><li><a href="#automated-feature-engineering">Automated Feature Engineering</a><ul><li><a href="#autofeat-with-featuretools">AutoFeat with Featuretools</a></li><li><a href="#custom-feature-generation">Custom Feature Generation</a></li></ul></li><li><a href="#real-world-case-studies">Real-World Case Studies</a><ul><li><a href="#case-study-1-netflix-recommendation-features">Case Study 1: Netflix Recommendation Features</a></li><li><a href="#case-study-2-uber-demand-prediction-features">Case Study 2: Uber Demand Prediction Features</a></li></ul></li><li><a href="#feature-engineering-at-scale-with-spark">Feature Engineering at Scale with Spark</a></li><li><a href="#cost-analysis--optimization">Cost Analysis &amp; Optimization</a><ul><li><a href="#feature-computation-cost">Feature Computation Cost</a></li></ul></li><li><a href="#key-takeaways">Key Takeaways</a></li></ul>
            </nav>
          </aside>
        
        <p><strong>Feature engineering makes or breaks ML models, learn how to build scalable, production-ready feature pipelines that power real-world systems.</strong></p>

<h2 id="introduction">Introduction</h2>

<p><strong>Feature engineering</strong> is the process of transforming raw data into features that better represent the underlying problem to ML models.</p>

<p><strong>Why it matters:</strong></p>
<ul>
  <li><strong>Makes models better:</strong> Good features &gt; complex models with bad features</li>
  <li><strong>Domain knowledge encoding:</strong> Capture expert insights in features</li>
  <li><strong>Data quality:</strong> Garbage in = garbage out</li>
  <li><strong>Production complexity:</strong> 80% of ML engineering time is data/feature work</li>
</ul>

<p><strong>Stat:</strong> Andrew Ng says “Applied ML is basically feature engineering”</p>

<hr />

<h2 id="feature-engineering-pipeline-architecture">Feature Engineering Pipeline Architecture</h2>

<h3 id="high-level-architecture">High-Level Architecture</h3>

<p><code class="language-plaintext highlighter-rouge">
┌──────────────┐
│ Raw Data │ (Logs, DB, Streams)
└──────┬───────┘
 │
 ▼
┌──────────────────────────────┐
│ Feature Engineering Layer │
│ ┌─────────┐ ┌─────────┐ │
│ │Transform│ │ Compute │ │
│ │ Logic │ │ Engines │ │
│ └─────────┘ └─────────┘ │
└──────────┬───────────────────┘
 │
 ▼
┌──────────────────────────────┐
│ Feature Store │
│ ┌────────┐ ┌──────────┐ │
│ │ Online │ │ Offline │ │
│ │Features│ │ Features │ │
│ │(low ms)│ │ (batch) │ │
│ └────────┘ └──────────┘ │
└──────────┬───────────────────┘
 │
 ▼
┌──────────────────────────────┐
│ ML Models │
│ ┌─────────┐ ┌──────────┐ │
│ │Training │ │ Serving │ │
│ └─────────┘ └──────────┘ │
└──────────────────────────────┘
</code></p>

<hr />

<h2 id="types-of-features">Types of Features</h2>

<h3 id="1-numerical-features">1. Numerical Features</h3>

<p><strong>Raw numerical values</strong></p>

<p>``python
import pandas as pd
import numpy as np</p>

<h1 id="example-dataset">Example dataset</h1>
<p>df = pd.DataFrame({
 ‘age’: [25, 30, 35, 40],
 ‘income’: [50000, 75000, 100000, 125000],
 ‘num_purchases’: [5, 12, 20, 15]
})</p>

<h1 id="common-transformations">Common transformations</h1>
<p>df[‘age_squared’] = df[‘age’] ** 2
df[‘log_income’] = np.log(df[‘income’])
df[‘income_per_purchase’] = df[‘income’] / (df[‘num_purchases’] + 1) # +1 to avoid division by zero
``</p>

<h3 id="2-categorical-features">2. Categorical Features</h3>

<p><strong>Discrete values that represent categories</strong></p>

<h4 id="one-hot-encoding">One-Hot Encoding</h4>

<p>``python</p>
<h1 id="simple-one-hot-encoding">Simple one-hot encoding</h1>
<p>df_categorical = pd.DataFrame({
 ‘city’: [‘NYC’, ‘SF’, ‘LA’, ‘NYC’, ‘SF’],
 ‘device’: [‘mobile’, ‘desktop’, ‘mobile’, ‘tablet’, ‘desktop’]
})</p>

<h1 id="one-hot-encode">One-hot encode</h1>
<p>df_encoded = pd.get_dummies(df_categorical, columns=[‘city’, ‘device’])
print(df_encoded)</p>
<h1 id="city_la-city_nyc-city_sf-device_desktop-device_mobile-device_tablet">city_LA city_NYC city_SF device_desktop device_mobile device_tablet</h1>
<h1 id="0-0-1-0-0-1-0">0 0 1 0 0 1 0</h1>
<h1 id="1-0-0-1-1-0-0">1 0 0 1 1 0 0</h1>
<h1>…</h1>
<p>``</p>

<h4 id="label-encoding-for-ordinal-features">Label Encoding (for ordinal features)</h4>

<p>``python
from sklearn.preprocessing import LabelEncoder</p>

<p>df = pd.DataFrame({
 ‘size’: [‘small’, ‘medium’, ‘large’, ‘small’, ‘large’]
})</p>

<p>le = LabelEncoder()
df[‘size_encoded’] = le.fit_transform(df[‘size’])</p>
<h1 id="small0-medium1-large2">small→0, medium→1, large→2</h1>
<p>``</p>

<h4 id="target-encoding-mean-encoding">Target Encoding (Mean Encoding)</h4>

<p>``python
def target_encode(df, column, target):
 “””
 Replace category with mean of target variable</p>

<p>Good for high-cardinality categoricals
 “””
 means = df.groupby(column)[target].mean()
 return df[column].map(means)</p>

<h1 id="example">Example</h1>
<p>df = pd.DataFrame({
 ‘city’: [‘NYC’, ‘SF’, ‘LA’, ‘NYC’, ‘SF’, ‘LA’],
 ‘conversion’: [1, 0, 1, 1, 0, 0]
})</p>

<p>df[‘city_encoded’] = target_encode(df, ‘city’, ‘conversion’)</p>
<h1 id="nyc--10-22-sf--00-02-la--05-12">NYC → 1.0 (2/2), SF → 0.0 (0/2), LA → 0.5 (1/2)</h1>
<p>``</p>

<h3 id="3-text-features">3. Text Features</h3>

<p><strong>Transform text into numerical representations</strong></p>

<h4 id="tf-idf">TF-IDF</h4>

<p>``python
from sklearn.feature_extraction.text import TfidfVectorizer</p>

<p>documents = [
 “machine learning is awesome”,
 “deep learning is a subset of machine learning”,
 “natural language processing is fun”
]</p>

<p>vectorizer = TfidfVectorizer(max_features=10)
tfidf_matrix = vectorizer.fit_transform(documents)</p>

<p>print(f”Shape: {tfidf_matrix.shape}”)
print(f”Features: {vectorizer.get_feature_names_out()}”)
``</p>

<h4 id="word-embeddings">Word Embeddings</h4>

<p>``python</p>
<h1 id="using-pre-trained-embeddings-eg-word2vec-glove">Using pre-trained embeddings (e.g., Word2Vec, GloVe)</h1>
<p>import gensim.downloader as api</p>

<h1 id="load-pre-trained-model">Load pre-trained model</h1>
<p>word_vectors = api.load(“glove-wiki-gigaword-100”)</p>

<p>def text_to_embedding(text, word_vectors):
 “””
 Average word vectors for text embedding
 “””
 words = text.lower().split()
 vectors = [word_vectors[word] for word in words if word in word_vectors]</p>

<p>if not vectors:
 return np.zeros(100)</p>

<p>return np.mean(vectors, axis=0)</p>

<h1 id="example-1">Example</h1>
<p>text = “machine learning”
embedding = text_to_embedding(text, word_vectors)
print(f”Embedding shape: {embedding.shape}”) # (100,)
``</p>

<h3 id="4-time-based-features">4. Time-Based Features</h3>

<p><strong>Extract temporal patterns</strong></p>

<p>``python
import pandas as pd</p>

<p>df = pd.DataFrame({
 ‘timestamp’: pd.date_range(‘2024-01-01’, periods=100, freq=’H’)
})</p>

<h1 id="extract-time-features">Extract time features</h1>
<p>df[‘hour’] = df[‘timestamp’].dt.hour
df[‘day_of_week’] = df[‘timestamp’].dt.dayofweek
df[‘day_of_month’] = df[‘timestamp’].dt.day
df[‘month’] = df[‘timestamp’].dt.month
df[‘is_weekend’] = df[‘day_of_week’].isin([5, 6]).astype(int)
df[‘is_holiday’] = df[‘timestamp’].isin(holiday_dates).astype(int)</p>

<h1 id="cyclical-encoding-hour-wraps-around">Cyclical encoding (hour wraps around)</h1>
<p>df[‘hour_sin’] = np.sin(2 * np.pi * df[‘hour’] / 24)
df[‘hour_cos’] = np.cos(2 * np.pi * df[‘hour’] / 24)
``</p>

<p><strong>Cyclical encoding visualization:</strong></p>

<p>``
Hour encoding (linear):
0 ─ 6 ─ 12 ─ 18 ─ 24
 │
 └─&gt; Problem: 0 and 24 are far apart numerically!</p>

<p>Hour encoding (cyclical):
 0/24
 │
 21──┼──3
 │ │ │
18 │ 6
 │ │ │
 15──┼──9
 12</p>

<p>Using sin/cos captures cyclical nature:
hour_sin = sin(2π × hour / 24)
hour_cos = cos(2π × hour / 24)
``</p>

<h3 id="5-aggregation-features">5. Aggregation Features</h3>

<p><strong>Statistics over groups</strong></p>

<p>``python</p>
<h1 id="example-user-behavior-features">Example: user behavior features</h1>
<p>user_sessions = pd.DataFrame({
 ‘user_id’: [1, 1, 1, 2, 2, 3],
 ‘session_duration’: [120, 300, 180, 450, 200, 350],
 ‘pages_viewed’: [5, 12, 8, 20, 10, 15],
 ‘timestamp’: pd.date_range(‘2024-01-01’, periods=6, freq=’D’)
})</p>

<h1 id="aggregate-by-user">Aggregate by user</h1>
<p>user_features = user_sessions.groupby(‘user_id’).agg({
 ‘session_duration’: [‘mean’, ‘std’, ‘min’, ‘max’, ‘sum’],
 ‘pages_viewed’: [‘mean’, ‘sum’, ‘count’],
 ‘timestamp’: [‘min’, ‘max’] # First/last session
}).reset_index()</p>

<h1 id="flatten-column-names">Flatten column names</h1>
<p>user_features.columns = [‘<em>‘.join(col).strip(‘</em>’) for col in user_features.columns.values]</p>

<h1 id="time-windowed-aggregations">Time-windowed aggregations</h1>
<p>user_sessions[‘date’] = user_sessions[‘timestamp’].dt.date</p>

<h1 id="last-7-days-features">Last 7 days features</h1>
<p>last_7_days = user_sessions[
 user_sessions[‘timestamp’] &gt;= (user_sessions[‘timestamp’].max() - pd.Timedelta(days=7))
]</p>

<p>user_features_7d = last_7_days.groupby(‘user_id’).agg({
 ‘session_duration’: ‘mean’,
 ‘pages_viewed’: ‘sum’
}).add_suffix(‘_7d’)
``</p>

<hr />

<h2 id="advanced-feature-engineering-techniques">Advanced Feature Engineering Techniques</h2>

<h3 id="1-interaction-features">1. Interaction Features</h3>

<p><strong>Capture relationships between features</strong></p>

<p>``python
from sklearn.preprocessing import PolynomialFeatures</p>

<h1 id="simple-example">Simple example</h1>
<p>df = pd.DataFrame({
 ‘feature_a’: [1, 2, 3],
 ‘feature_b’: [4, 5, 6]
})</p>

<h1 id="polynomial-features-includes-interactions">Polynomial features (includes interactions)</h1>
<p>poly = PolynomialFeatures(degree=2, include_bias=False)
poly_features = poly.fit_transform(df[[‘feature_a’, ‘feature_b’]])</p>

<h1 id="creates-a-b-a-ab-b">Creates: [a, b, a², ab, b²]</h1>
<p>print(poly.get_feature_names_out())</p>
<h1 id="feature_a-feature_b-feature_a2-feature_a-feature_b-feature_b2">[‘feature_a’, ‘feature_b’, ‘feature_a^2’, ‘feature_a feature_b’, ‘feature_b^2’]</h1>

<h1 id="manual-domain-specific-interactions">Manual domain-specific interactions</h1>
<p>df[‘price_per_sqft’] = df[‘price’] / df[‘sqft’]
df[‘bedrooms_bathrooms_ratio’] = df[‘bedrooms’] / (df[‘bathrooms’] + 1)
``</p>

<h3 id="2-binningdiscretization">2. Binning/Discretization</h3>

<p><strong>Convert continuous to categorical</strong></p>

<p>``python</p>
<h1 id="equal-width-binning">Equal-width binning</h1>
<p>df[‘age_bin’] = pd.cut(df[‘age’], bins=[0, 18, 35, 50, 100], 
 labels=[‘child’, ‘young_adult’, ‘adult’, ‘senior’])</p>

<h1 id="equal-frequency-binning-quantiles">Equal-frequency binning (quantiles)</h1>
<p>df[‘income_quartile’] = pd.qcut(df[‘income’], q=4, labels=[‘Q1’, ‘Q2’, ‘Q3’, ‘Q4’])</p>

<h1 id="custom-bins-based-on-domain-knowledge">Custom bins based on domain knowledge</h1>
<p>def categorize_temperature(temp):
 if temp &lt; 32:
 return ‘freezing’
 elif temp &lt; 60:
 return ‘cold’
 elif temp &lt; 80:
 return ‘mild’
 else:
 return ‘hot’</p>

<p>df[‘temp_category’] = df[‘temperature’].apply(categorize_temperature)
``</p>

<h3 id="3-feature-crosses">3. Feature Crosses</h3>

<p><strong>Combine multiple categorical features</strong></p>

<p>``python</p>
<h1 id="simple-feature-cross">Simple feature cross</h1>
<p>df[‘city_device’] = df[‘city’] + ‘_’ + df[‘device’]</p>
<h1 id="creates-nyc_mobile-sf_desktop-etc">Creates: ‘NYC_mobile’, ‘SF_desktop’, etc.</h1>

<h1 id="multiple-feature-crosses">Multiple feature crosses</h1>
<p>df[‘city_device_hour’] = df[‘city’] + ‘<em>’ + df[‘device’] + ‘</em>’ + df[‘hour_bin’]</p>

<h1 id="then-one-hot-encode-the-crosses">Then one-hot encode the crosses</h1>
<p>df_crossed = pd.get_dummies(df[‘city_device’], prefix=’city_device’)
``</p>

<h3 id="4-embedding-features">4. Embedding Features</h3>

<p><strong>Learn dense representations</strong></p>

<p>``python
import tensorflow as tf</p>

<p>def create_embedding_layer(vocab_size, embedding_dim):
 “””
 Create embedding layer for categorical feature</p>

<p>Useful for high-cardinality categoricals (e.g., user_id, item_id)
 “””
 return tf.keras.layers.Embedding(
 input_dim=vocab_size,
 output_dim=embedding_dim,
 embeddings_regularizer=tf.keras.regularizers.l2(1e-6)
 )</p>

<h1 id="example-user-embeddings">Example: User embeddings</h1>
<p>num_users = 10000
user_embedding_dim = 32</p>

<p>user_input = tf.keras.layers.Input(shape=(1,), name=’user_id’)
user_embedding = create_embedding_layer(num_users, user_embedding_dim)(user_input)
user_vec = tf.keras.layers.Flatten()(user_embedding)
``</p>

<hr />

<h2 id="feature-store-architecture">Feature Store Architecture</h2>

<p><strong>Problem:</strong> Features computed differently in training vs serving → prediction skew</p>

<p><strong>Solution:</strong> Centralized feature store with unified computation</p>

<h3 id="feature-store-components">Feature Store Components</h3>

<p>``python
from dataclasses import dataclass
from typing import Callable, List
import numpy as np
import pandas as pd</p>

<p>@dataclass
class Feature:
 “"”Feature definition”””
 name: str
 transform_fn: Callable
 dependencies: List[str]
 batch_source: str # Where to get data for batch computation
 stream_source: str # Where to get data for real-time</p>

<p>class FeatureStore:
 “””
 Simplified feature store</p>

<p>Real systems: Feast, Tecton, AWS SageMaker Feature Store
 “””</p>

<p>def <strong>init</strong>(self):
 self.features = {}
 self.offline_store = {} # Batch features (historical)
 self.online_store = {} # Real-time features (low latency)</p>

<p>def register_feature(self, feature: Feature):
 “"”Register feature definition”””
 self.features[feature.name] = feature</p>

<p>def compute_batch_features(self, entity_ids: List[str], features: List[str]):
 “””
 Compute features for training (batch)</p>

<p>Returns: DataFrame with features
 “””
 result = pd.DataFrame({‘entity_id’: entity_ids})</p>

<p>for feature_name in features:
 feature = self.features[feature_name]</p>

<p># Load batch data
 data = self._load_batch_data(feature.batch_source, entity_id=None)</p>

<p># Compute feature
 result[feature_name] = feature.transform_fn(data)</p>

<p>return result</p>

<p>def get_online_features(self, entity_id: str, features: List[str]):
 “””
 Get features for serving (real-time)</p>

<p>Returns: Dict of feature values
 “””
 result = {}</p>

<p>for feature_name in features:
 # Check online store
 key = f”{entity_id}:{feature_name}”
 if key in self.online_store:
 result[feature_name] = self.online_store[key]
 else:
 # Compute on-the-fly (fallback)
 feature = self.features[feature_name]
 data = self._load_stream_data(feature.stream_source, entity_id)
 result[feature_name] = feature.transform_fn(data)</p>

<p>return result</p>

<p>def materialize_features(self, features: List[str]):
 “””
 Pre-compute features and store in online store</p>

<p>Batch job that runs periodically
 “””
 for feature_name in features:
 feature = self.features[feature_name]</p>

<p># Compute for all entities
 all_entities = self._get_all_entities()</p>

<p>for entity_id in all_entities:
 data = self._load_batch_data(feature.batch_source, entity_id)
 value = feature.transform_fn(data)</p>

<p># Store in online store
 key = f”{entity_id}:{feature_name}”
 self.online_store[key] = value</p>

<p>def _load_batch_data(self, source, entity_id=None):
 # Load from data warehouse (e.g., BigQuery, Snowflake)
 pass</p>

<p>def _load_stream_data(self, source, entity_id):
 # Load from stream (e.g., Kafka, Kinesis)
 pass</p>

<p>def _get_all_entities(self):
 # Get all entity IDs
 pass</p>

<h1 id="example-usage">Example usage</h1>
<p>feature_store = FeatureStore()</p>

<h1 id="register-features">Register features</h1>
<p>feature_store.register_feature(Feature(
 name=’user_avg_purchase_amount_30d’,
 transform_fn=lambda data: data[‘purchase_amount’].mean(),
 dependencies=[‘purchase_amount’],
 batch_source=’dwh.purchases’,
 stream_source=’kafka.purchases’
))</p>

<h1 id="training-get-batch-features">Training: Get batch features</h1>
<p>training_features = feature_store.compute_batch_features(
 entity_ids=[‘user_1’, ‘user_2’],
 features=[‘user_avg_purchase_amount_30d’]
)</p>

<h1 id="serving-get-online-features--10ms">Serving: Get online features (&lt; 10ms)</h1>
<p>serving_features = feature_store.get_online_features(
 entity_id=’user_1’,
 features=[‘user_avg_purchase_amount_30d’]
)
``</p>

<h3 id="feature-store-benefits">Feature Store Benefits</h3>

<p><strong>Training-Serving Consistency:</strong>
``
Without Feature Store:
 Training: Compute features in Python/Spark
 Serving: Reimplement in Java/Go
 Result: Different implementations → prediction skew!</p>

<p>With Feature Store:
 Training: feature_store.get_offline_features()
 Serving: feature_store.get_online_features()
 Result: Same computation logic → consistent!
``</p>

<hr />

<h2 id="feature-engineering-for-tree-traversal">Feature Engineering for Tree Traversal</h2>

<p>Connecting to DSA(tree traversal):</p>

<h3 id="hierarchical-features">Hierarchical Features</h3>

<p>``python
class CategoryTree:
 “””
 Category hierarchy (like tree traversal)</p>

<p>Example:
 Electronics
 / <br />
 Computers Phones
 / \ |
 Laptops Desktops Smartphones
 “””</p>

<p>def <strong>init</strong>(self):
 self.tree = {
 ‘Electronics’: {
 ‘Computers’: {
 ‘Laptops’: {},
 ‘Desktops’: {}
 },
 ‘Phones’: {
 ‘Smartphones’: {}
 }
 }
 }</p>

<p>def get_category_path(self, category: str) -&gt; List[str]:
 “””
 Get path from root to category</p>

<p>Uses DFS (similar to tree traversal)
 “””
 def dfs(node, target, path):
 if node == target:
 return path + [node]</p>

<p>if isinstance(node, dict):
 for child, subtree in node.items():
 result = dfs(subtree, target, path + [child])
 if result:
 return result</p>

<p>return None</p>

<p>for root, subtree in self.tree.items():
 path = dfs(subtree, category, [root])
 if path:
 return path</p>

<p>return []</p>

<p>def category_level_features(self, category: str):
 “””
 Create features from category hierarchy</p>

<p>level_1: Electronics
 level_2: Computers
 level_3: Laptops
 “””
 path = self.get_category_path(category)</p>

<p>features = {}
 for i, cat in enumerate(path):
 features[f’category_level_{i+1}’] = cat</p>

<p>return features</p>

<h1 id="example-2">Example</h1>
<p>cat_tree = CategoryTree()
features = cat_tree.category_level_features(‘Laptops’)
print(features)</p>
<h1 id="category_level_1-electronics">{‘category_level_1’: ‘Electronics’,</h1>
<h1 id="category_level_2-computers">‘category_level_2’: ‘Computers’,</h1>
<h1 id="category_level_3-laptops">‘category_level_3’: ‘Laptops’}</h1>
<p>``</p>

<hr />

<h2 id="connection-to-speech-processing">Connection to Speech Processing</h2>

<p>Feature engineering is critical in speech ML:</p>

<h3 id="audio-feature-extraction-pipeline">Audio Feature Extraction Pipeline</h3>

<p>``python
class AudioFeatureExtractor:
 “””
 Extract features from audio (similar to general feature engineering)
 “””</p>

<p>def extract_spectral_features(self, audio):
 “””
 Extract spectral features</p>

<p>Similar to numerical feature engineering
 “””
 import librosa</p>

<p># Mel-frequency cepstral coefficients
 mfccs = librosa.feature.mfcc(y=audio, sr=22050, n_mfcc=13)</p>

<p># Spectral features
 spectral_centroid = librosa.feature.spectral_centroid(y=audio, sr=22050)
 spectral_rolloff = librosa.feature.spectral_rolloff(y=audio, sr=22050)</p>

<p># Aggregate over time (similar to aggregation features)
 features = {
 ‘mfcc_mean’: np.mean(mfccs, axis=1),
 ‘mfcc_std’: np.std(mfccs, axis=1),
 ‘spectral_centroid_mean’: np.mean(spectral_centroid),
 ‘spectral_rolloff_mean’: np.mean(spectral_rolloff)
 }</p>

<p>return features</p>

<p>def extract_prosodic_features(self, audio):
 “””
 Extract prosody features (pitch, energy, duration)</p>

<p>Domain-specific feature engineering
 “””
 import librosa</p>

<p># Pitch (F0)
 f0, voiced_flag, voiced_probs = librosa.pyin(
 audio,
 fmin=librosa.note_to_hz(‘C2’),
 fmax=librosa.note_to_hz(‘C7’)
 )</p>

<p># Energy
 energy = librosa.feature.rms(y=audio)</p>

<p># Duration features
 zero_crossings = librosa.feature.zero_crossing_rate(audio)</p>

<p>features = {
 ‘pitch_mean’: np.nanmean(f0),
 ‘pitch_std’: np.nanstd(f0),
 ‘pitch_range’: np.nanmax(f0) - np.nanmin(f0),
 ‘energy_mean’: np.mean(energy),
 ‘energy_std’: np.std(energy),
 ‘zcr_mean’: np.mean(zero_crossings)
 }</p>

<p>return features
``</p>

<hr />

<h2 id="production-best-practices">Production Best Practices</h2>

<h3 id="1-feature-versioning">1. Feature Versioning</h3>

<p>``python
class VersionedFeature:
 “"”Track feature versions”””</p>

<p>def <strong>init</strong>(self, name, version, transform_fn):
 self.name = name
 self.version = version
 self.transform_fn = transform_fn
 self.created_at = datetime.now()</p>

<p>def get_full_name(self):
 return f”{self.name}_v{self.version}”</p>

<h1 id="example-3">Example</h1>
<p>user_age_v1 = VersionedFeature(
 name=’user_age’,
 version=1,
 transform_fn=lambda df: df[‘birth_year’].apply(lambda x: 2024 - x)
)</p>

<p>user_age_v2 = VersionedFeature(
 name=’user_age’,
 version=2,
 transform_fn=lambda df: (datetime.now().year - df[‘birth_year’]).clip(0, 120)
)</p>

<h1 id="models-can-specify-feature-version">Models can specify feature version</h1>
<p>model_features = {
 ‘user_age_v2’, # Use version 2
 ‘income_v1’
}
``</p>

<h3 id="2-feature-monitoring">2. Feature Monitoring</h3>

<p>``python
class FeatureMonitor:
 “"”Monitor feature distributions”””</p>

<p>def <strong>init</strong>(self):
 self.baseline_stats = {}</p>

<p>def compute_stats(self, feature_name, values):
 “"”Compute feature statistics”””
 return {
 ‘mean’: np.mean(values),
 ‘std’: np.std(values),
 ‘min’: np.min(values),
 ‘max’: np.max(values),
 ‘nulls’: np.isnan(values).sum(),
 ‘unique_count’: len(np.unique(values))
 }</p>

<p>def set_baseline(self, feature_name, values):
 “"”Set baseline statistics”””
 self.baseline_stats[feature_name] = self.compute_stats(feature_name, values)</p>

<p>def check_drift(self, feature_name, values, threshold=0.1):
 “””
 Check if feature distribution has drifted</p>

<p>Returns: (has_drifted, drift_metrics)
 “””
 if feature_name not in self.baseline_stats:
 return False, {}</p>

<p>current_stats = self.compute_stats(feature_name, values)
 baseline_stats = self.baseline_stats[feature_name]</p>

<p># Check mean drift
 mean_drift = abs(current_stats[‘mean’] - baseline_stats[‘mean’]) / (baseline_stats[‘std’] + 1e-8)</p>

<p># Check std drift
 std_ratio = current_stats[‘std’] / (baseline_stats[‘std’] + 1e-8)</p>

<p>drift_metrics = {
 ‘mean_drift’: mean_drift,
 ‘std_ratio’: std_ratio,
 ‘null_rate_change’: current_stats[‘nulls’] / len(values) - baseline_stats[‘nulls’] / len(values)
 }</p>

<p>has_drifted = mean_drift &gt; threshold or std_ratio &lt; 0.5 or std_ratio &gt; 2.0</p>

<p>return has_drifted, drift_metrics</p>

<h1 id="usage">Usage</h1>
<p>monitor = FeatureMonitor()</p>

<h1 id="set-baseline-during-training">Set baseline during training</h1>
<p>monitor.set_baseline(‘user_age’, training_df[‘user_age’].values)</p>

<h1 id="check-for-drift-in-production">Check for drift in production</h1>
<p>has_drifted, metrics = monitor.check_drift(‘user_age’, production_df[‘user_age’].values)
if has_drifted:
 print(f”⚠️ Feature drift detected: {metrics}”)
``</p>

<h3 id="3-feature-documentation">3. Feature Documentation</h3>

<p>``python
@dataclass
class FeatureDocumentation:
 “"”Document features for team collaboration”””
 name: str
 description: str
 owner: str
 creation_date: str
 dependencies: List[str]
 update_frequency: str # ‘realtime’, ‘hourly’, ‘daily’
 sla_ms: int # SLA for feature computation
 example_values: List</p>

<p>def to_markdown(self):
 “"”Generate markdown documentation”””
 return f”””</p>
<h1 id="feature-selfname">Feature: {self.name}</h1>

<p><strong>Description:</strong> {self.description}</p>

<p><strong>Owner:</strong> {self.owner}</p>

<p><strong>Created:</strong> {self.creation_date}</p>

<p><strong>Update Frequency:</strong> {self.update_frequency}</p>

<p><strong>SLA:</strong> {self.sla_ms}ms</p>

<p><strong>Dependencies:</strong> {‘, ‘.join(self.dependencies)}</p>

<p><strong>Example Values:</strong> {self.example_values[:5]}
“””</p>

<h1 id="example-4">Example</h1>
<p>feature_doc = FeatureDocumentation(
 name=’user_purchase_frequency_30d’,
 description=’Number of purchases by user in last 30 days’,
 owner=’ml-team@company.com’,
 creation_date=’2024-01-15’,
 dependencies=[‘purchase_events’],
 update_frequency=’hourly’,
 sla_ms=100,
 example_values=[0, 2, 5, 1, 3, 0, 7]
)</p>

<p>print(feature_doc.to_markdown())
``</p>

<hr />

<h2 id="feature-selection-techniques">Feature Selection Techniques</h2>

<p><strong>Problem:</strong> Too many features can lead to:</p>
<ul>
  <li>Overfitting</li>
  <li>Increased computation</li>
  <li>Reduced interpretability</li>
</ul>

<h3 id="1-filter-methods">1. Filter Methods</h3>

<p>``python
from sklearn.feature_selection import SelectKBest, f_classif, mutual_info_classif
from sklearn.datasets import make_classification
import pandas as pd</p>

<h1 id="generate-sample-data">Generate sample data</h1>
<p>X, y = make_classification(n_samples=1000, n_features=20, n_informative=10, random_state=42)</p>

<h1 id="anova-f-test">ANOVA F-test</h1>
<p>selector_f = SelectKBest(f_classif, k=10)
X_selected_f = selector_f.fit_transform(X, y)</p>

<h1 id="get-selected-feature-indices">Get selected feature indices</h1>
<p>selected_features_f = selector_f.get_support(indices=True)
print(f”Selected features (F-test): {selected_features_f}”)</p>

<h1 id="mutual-information">Mutual Information</h1>
<p>selector_mi = SelectKBest(mutual_info_classif, k=10)
X_selected_mi = selector_mi.fit_transform(X, y)</p>

<p>print(f”Original features: {X.shape[1]}”)
print(f”Selected features: {X_selected_f.shape[1]}”)
``</p>

<h3 id="2-wrapper-methods-forwardbackward-selection">2. Wrapper Methods (Forward/Backward Selection)</h3>

<p>``python
from sklearn.feature_selection import SequentialFeatureSelector
from sklearn.ensemble import RandomForestClassifier</p>

<h1 id="forward-selection">Forward selection</h1>
<p>sfs = SequentialFeatureSelector(
 RandomForestClassifier(n_estimators=100),
 n_features_to_select=10,
 direction=’forward’,
 cv=5
)</p>

<p>sfs.fit(X, y)
selected_features = sfs.get_support(indices=True)
print(f”Forward selection features: {selected_features}”)
``</p>

<h3 id="3-embedded-methods-l1-regularization">3. Embedded Methods (L1 Regularization)</h3>

<p>``python
from sklearn.linear_model import LassoCV
import numpy as np</p>

<h1 id="lasso-for-feature-selection">Lasso for feature selection</h1>
<p>lasso = LassoCV(cv=5, random_state=42)
lasso.fit(X, y)</p>

<h1 id="features-with-non-zero-coefficients">Features with non-zero coefficients</h1>
<p>importance = np.abs(lasso.coef_)
selected_features = np.where(importance &gt; 0.01)[0]</p>

<p>print(f”Lasso selected {len(selected_features)} features”)
print(f”Feature importance: {importance}”)
``</p>

<h3 id="4-feature-importance-from-models">4. Feature Importance from Models</h3>

<p>``python
from sklearn.ensemble import RandomForestClassifier
import matplotlib.pyplot as plt</p>

<h1 id="train-model">Train model</h1>
<p>rf = RandomForestClassifier(n_estimators=100, random_state=42)
rf.fit(X, y)</p>

<h1 id="get-feature-importance">Get feature importance</h1>
<p>importance = rf.feature_importances_
indices = np.argsort(importance)[::-1]</p>

<h1 id="plot">Plot</h1>
<p>plt.figure(figsize=(10, 6))
plt.title(‘Feature Importance’)
plt.bar(range(X.shape[1]), importance[indices])
plt.xlabel(‘Feature Index’)
plt.ylabel(‘Importance’)
plt.show()</p>

<h1 id="select-top-k-features">Select top k features</h1>
<p>k = 10
top_features = indices[:k]
print(f”Top {k} features: {top_features}”)
``</p>

<hr />

<h2 id="automated-feature-engineering">Automated Feature Engineering</h2>

<h3 id="autofeat-with-featuretools">AutoFeat with Featuretools</h3>

<p>``python</p>
<h1 id="featuretools-for-automated-feature-engineering">Featuretools for automated feature engineering</h1>
<p>import featuretools as ft
import pandas as pd</p>

<h1 id="example-e-commerce-transactions">Example: E-commerce transactions</h1>
<p>customers = pd.DataFrame({
 ‘customer_id’: [1, 2, 3],
 ‘age’: [25, 35, 45],
 ‘city’: [‘NYC’, ‘SF’, ‘LA’]
})</p>

<p>transactions = pd.DataFrame({
 ‘transaction_id’: [1, 2, 3, 4, 5],
 ‘customer_id’: [1, 1, 2, 2, 3],
 ‘amount’: [100, 150, 200, 50, 300],
 ‘timestamp’: pd.date_range(‘2024-01-01’, periods=5, freq=’D’)
})</p>

<h1 id="create-entity-set">Create entity set</h1>
<p>es = ft.EntitySet(id=’customer_transactions’)</p>

<h1 id="add-entities">Add entities</h1>
<p>es = es.add_dataframe(
 dataframe_name=’customers’,
 dataframe=customers,
 index=’customer_id’
)</p>

<p>es = es.add_dataframe(
 dataframe_name=’transactions’,
 dataframe=transactions,
 index=’transaction_id’,
 time_index=’timestamp’
)</p>

<h1 id="add-relationship">Add relationship</h1>
<p>es = es.add_relationship(‘customers’, ‘customer_id’, ‘transactions’, ‘customer_id’)</p>

<h1 id="generate-features-automatically">Generate features automatically</h1>
<p>feature_matrix, feature_defs = ft.dfs(
 entityset=es,
 target_dataframe_name=’customers’,
 max_depth=2,
 verbose=True
)</p>

<p>print(f”Generated {len(feature_defs)} features automatically”)
print(feature_matrix.head())</p>

<h1 id="features-like">Features like:</h1>
<h1 id="--sumtransactionsamount">- SUM(transactions.amount)</h1>
<h1 id="--meantransactionsamount">- MEAN(transactions.amount)</h1>
<h1 id="--counttransactions">- COUNT(transactions)</h1>
<h1 id="--maxtransactionstimestamp">- MAX(transactions.timestamp)</h1>
<p>``</p>

<h3 id="custom-feature-generation">Custom Feature Generation</h3>

<p>``python
class AutoFeatureGenerator:
 “””
 Automatically generate mathematical transformations
 “””</p>

<p>def <strong>init</strong>(self, operations=[‘square’, ‘sqrt’, ‘log’, ‘reciprocal’]):
 self.operations = operations</p>

<p>def generate(self, df, numerical_columns):
 “””
 Generate features by applying operations</p>

<p>Args:
 df: DataFrame
 numerical_columns: Columns to transform</p>

<p>Returns:
 DataFrame with original + generated features
 “””
 result = df.copy()</p>

<p>for col in numerical_columns:
 if ‘square’ in self.operations:
 result[f’{col}_squared’] = df[col] ** 2</p>

<p>if ‘sqrt’ in self.operations:
 # Only for non-negative
 if (df[col] &gt;= 0).all():
 result[f’{col}_sqrt’] = np.sqrt(df[col])</p>

<p>if ‘log’ in self.operations:
 # Only for positive
 if (df[col] &gt; 0).all():
 result[f’{col}_log’] = np.log(df[col])</p>

<p>if ‘reciprocal’ in self.operations:
 # Avoid division by zero
 result[f’{col}_reciprocal’] = 1 / (df[col] + 1e-8)</p>

<p># Generate interactions
 for i, col1 in enumerate(numerical_columns):
 for col2 in numerical_columns[i+1:]:
 result[f’{col1}<em>times</em>{col2}’] = df[col1] * df[col2]
 result[f’{col1}<em>div</em>{col2}’] = df[col1] / (df[col2] + 1e-8)</p>

<p>return result</p>

<h1 id="usage-1">Usage</h1>
<p>df = pd.DataFrame({
 ‘feature_a’: [1, 2, 3, 4, 5],
 ‘feature_b’: [10, 20, 30, 40, 50]
})</p>

<p>generator = AutoFeatureGenerator()
df_with_features = generator.generate(df, [‘feature_a’, ‘feature_b’])</p>

<p>print(f”Original features: {df.shape[1]}”)
print(f”After generation: {df_with_features.shape[1]}”)
print(df_with_features.columns.tolist())
``</p>

<hr />

<h2 id="real-world-case-studies">Real-World Case Studies</h2>

<h3 id="case-study-1-netflix-recommendation-features">Case Study 1: Netflix Recommendation Features</h3>

<p>``python
class NetflixFeatureEngine:
 “””
 Feature engineering for content recommendation</p>

<p>Based on public Netflix research papers
 “””</p>

<p>def engineer_user_features(self, user_history):
 “””
 User behavioral features</p>

<p>Args:
 user_history: DataFrame with user viewing history</p>

<p>Returns:
 User features
 “””
 features = {}</p>

<p># Viewing patterns
 features[‘total_watch_time’] = user_history[‘watch_duration’].sum()
 features[‘avg_watch_time’] = user_history[‘watch_duration’].mean()
 features[‘num_titles_watched’] = user_history[‘title_id’].nunique()</p>

<p># Time-based patterns
 user_history[‘hour’] = pd.to_datetime(user_history[‘timestamp’]).dt.hour
 features[‘favorite_hour’] = user_history.groupby(‘hour’).size().idxmax()
 features[‘weekend_ratio’] = (user_history[‘is_weekend’].sum() / len(user_history))</p>

<p># Genre preferences
 genre_counts = user_history[‘genre’].value_counts()
 features[‘favorite_genre’] = genre_counts.index[0] if len(genre_counts) &gt; 0 else ‘unknown’
 features[‘genre_diversity’] = user_history[‘genre’].nunique()</p>

<p># Completion rate
 features[‘completion_rate’] = (
 user_history[‘watch_duration’] / user_history[‘total_duration’]
 ).mean()</p>

<p># Binge-watching behavior
 features[‘avg_sessions_per_day’] = user_history.groupby(
 user_history[‘timestamp’].dt.date
 ).size().mean()</p>

<p># Recency features
 last_watch = user_history[‘timestamp’].max()
 features[‘days_since_last_watch’] = (pd.Timestamp.now() - last_watch).days</p>

<p>return features</p>

<p>def engineer_content_features(self, content_metadata, user_interactions):
 “””
 Content-based features</p>

<p>Combine metadata + user engagement
 “””
 features = {}</p>

<p># Popularity features
 features[‘view_count’] = len(user_interactions)
 features[‘unique_viewers’] = user_interactions[‘user_id’].nunique()
 features[‘avg_rating’] = user_interactions[‘rating’].mean()</p>

<p># Engagement features
 features[‘avg_completion_rate’] = (
 user_interactions[‘watch_duration’] / content_metadata[‘duration’]
 ).mean()</p>

<p># Temporal features
 features[‘days_since_release’] = (
 pd.Timestamp.now() - pd.to_datetime(content_metadata[‘release_date’])
 ).days</p>

<p># Freshness score (decaying popularity)
 features[‘freshness_score’] = (
 features[‘view_count’] / (1 + np.log(1 + features[‘days_since_release’]))
 )</p>

<p>return features
``</p>

<h3 id="case-study-2-uber-demand-prediction-features">Case Study 2: Uber Demand Prediction Features</h3>

<p>``python
class UberDemandFeatures:
 “””
 Feature engineering for ride demand prediction</p>

<p>Inspired by Uber’s blog posts on ML
 “””</p>

<p>def engineer_spatial_features(self, location_data):
 “””
 Spatial features for demand prediction
 “””
 features = {}</p>

<p># Grid-based features
 features[‘grid_id’] = self.lat_lon_to_grid(
 location_data[‘lat’],
 location_data[‘lon’]
 )</p>

<p># Distance to key locations
 features[‘dist_to_airport’] = self.haversine_distance(
 location_data[‘lat’], location_data[‘lon’],
 airport_lat, airport_lon
 )</p>

<p>features[‘dist_to_downtown’] = self.haversine_distance(
 location_data[‘lat’], location_data[‘lon’],
 downtown_lat, downtown_lon
 )</p>

<p># Neighborhood features
 features[‘is_business_district’] = self.check_business_district(
 location_data[‘lat’], location_data[‘lon’]
 )</p>

<p>return features</p>

<p>def engineer_temporal_features(self, timestamp):
 “””
 Time-based features for demand
 “””
 ts = pd.to_datetime(timestamp)</p>

<p>features = {}</p>

<p># Basic time features
 features[‘hour’] = ts.hour
 features[‘day_of_week’] = ts.dayofweek
 features[‘is_weekend’] = ts.dayofweek in [5, 6]</p>

<p># Peak hours
 features[‘is_morning_rush’] = (7 &lt;= ts.hour &lt;= 9)
 features[‘is_evening_rush’] = (17 &lt;= ts.hour &lt;= 19)
 features[‘is_late_night’] = (23 &lt;= ts.hour or ts.hour &lt;= 5)</p>

<p># Special events
 features[‘is_holiday’] = self.check_holiday(ts)
 features[‘is_major_event_day’] = self.check_events(ts, location)</p>

<p># Weather features (if available)
 features[‘is_raining’] = self.get_weather(ts, ‘rain’)
 features[‘temperature’] = self.get_weather(ts, ‘temp’)</p>

<p>return features</p>

<p>def engineer_historical_features(self, location, timestamp, lookback_days=7):
 “””
 Historical demand features
 “””
 features = {}</p>

<p># Same hour, previous days
 for days_ago in [1, 7, 14]:
 past_timestamp = timestamp - pd.Timedelta(days=days_ago)
 features[f’demand_{days_ago}d_ago’] = self.get_historical_demand(
 location, past_timestamp
 )</p>

<p># Moving averages
 features[‘demand_7d_avg’] = self.get_avg_demand(
 location, timestamp, lookback_days=7
 )</p>

<p>features[‘demand_7d_std’] = self.get_std_demand(
 location, timestamp, lookback_days=7
 )</p>

<p># Trend
 recent_demand = self.get_demand_series(location, timestamp, days=7)
 features[‘demand_trend’] = self.compute_trend(recent_demand)</p>

<p>return features</p>

<p>@staticmethod
 def haversine_distance(lat1, lon1, lat2, lon2):
 “"”Calculate distance between two points on Earth”””
 from math import radians, cos, sin, asin, sqrt</p>

<p># Convert to radians
 lat1, lon1, lat2, lon2 = map(radians, [lat1, lon1, lat2, lon2])</p>

<p># Haversine formula
 dlat = lat2 - lat1
 dlon = lon2 - lon1
 a = sin(dlat/2)<strong>2 + cos(lat1) * cos(lat2) * sin(dlon/2)</strong>2
 c = 2 * asin(sqrt(a))</p>

<p># Radius of Earth in kilometers
 r = 6371</p>

<p>return c * r
``</p>

<hr />

<h2 id="feature-engineering-at-scale-with-spark">Feature Engineering at Scale with Spark</h2>

<p>``python
from pyspark.sql import SparkSession
from pyspark.sql import functions as F
from pyspark.sql.window import Window</p>

<p>class SparkFeatureEngine:
 “””
 Scalable feature engineering with Apache Spark</p>

<p>For datasets too large for pandas
 “””</p>

<p>def <strong>init</strong>(self):
 self.spark = SparkSession.builder <br />
 .appName(“FeatureEngineering”) <br />
 .getOrCreate()</p>

<p>def aggregate_features(self, df, group_by_col, agg_col):
 “””
 Compute aggregations at scale</p>

<p>Args:
 df: Spark DataFrame
 group_by_col: Column to group by (e.g., ‘user_id’)
 agg_col: Column to aggregate (e.g., ‘purchase_amount’)</p>

<p>Returns:
 DataFrame with aggregated features
 “””
 agg_df = df.groupBy(group_by_col).agg(
 F.count(agg_col).alias(f’{agg_col}_count’),
 F.sum(agg_col).alias(f’{agg_col}_sum’),
 F.mean(agg_col).alias(f’{agg_col}_mean’),
 F.stddev(agg_col).alias(f’{agg_col}_std’),
 F.min(agg_col).alias(f’{agg_col}_min’),
 F.max(agg_col).alias(f’{agg_col}_max’)
 )</p>

<p>return agg_df</p>

<p>def window_features(self, df, partition_col, order_col, value_col):
 “””
 Compute window features (rolling aggregations)</p>

<p>Example: 7-day rolling average
 “””
 # Define window
 days_7 = 7 * 86400 # 7 days in seconds</p>

<p>window_spec = Window <br />
 .partitionBy(partition_col) <br />
 .orderBy(F.col(order_col).cast(‘long’)) <br />
 .rangeBetween(-days_7, 0)</p>

<p># Compute rolling features
 df_with_window = df.withColumn(
 f’{value_col}_7d_avg’,
 F.avg(value_col).over(window_spec)
 ).withColumn(
 f’{value_col}_7d_sum’,
 F.sum(value_col).over(window_spec)
 ).withColumn(
 f’{value_col}_7d_count’,
 F.count(value_col).over(window_spec)
 )</p>

<p>return df_with_window</p>

<p>def lag_features(self, df, partition_col, order_col, value_col, lags=[1, 7, 30]):
 “””
 Create lag features (previous values)
 “””
 window_spec = Window <br />
 .partitionBy(partition_col) <br />
 .orderBy(order_col)</p>

<p>for lag in lags:
 df = df.withColumn(
 f’{value_col}<em>lag</em>{lag}’,
 F.lag(value_col, lag).over(window_spec)
 )</p>

<p>return df</p>

<h1 id="usage-example">Usage example</h1>
<h1 id="spark_fe--sparkfeatureengine">spark_fe = SparkFeatureEngine()</h1>
<p>#</p>
<h1 id="-load-large-dataset"># Load large dataset</h1>
<h1 id="df--spark_fesparkreadparquets3bucketdata">df = spark_fe.spark.read.parquet(‘s3://bucket/data/’)</h1>
<p>#</p>
<h1 id="-compute-features-at-scale"># Compute features at scale</h1>
<h1 id="df_features--spark_feaggregate_featuresdf-user_id-purchase_amount">df_features = spark_fe.aggregate_features(df, ‘user_id’, ‘purchase_amount’)</h1>
<h1 id="df_features--spark_fewindow_featuresdf-user_id-timestamp-purchase_amount">df_features = spark_fe.window_features(df, ‘user_id’, ‘timestamp’, ‘purchase_amount’)</h1>
<p>``</p>

<hr />

<h2 id="cost-analysis--optimization">Cost Analysis &amp; Optimization</h2>

<h3 id="feature-computation-cost">Feature Computation Cost</h3>

<p>``python
class FeatureCostAnalyzer:
 “””
 Analyze cost of feature computation</p>

<p>Important for production systems
 “””</p>

<p>def <strong>init</strong>(self):
 self.feature_costs = {}</p>

<p>def measure_cost(self, feature_name, compute_fn, data, iterations=100):
 “””
 Measure computation cost</p>

<p>Returns: (time_ms, memory_mb)
 “””
 import time
 import tracemalloc</p>

<p># Measure time
 times = []
 for _ in range(iterations):
 start = time.perf_counter()
 compute_fn(data)
 end = time.perf_counter()
 times.append((end - start) * 1000) # ms</p>

<p>avg_time = np.mean(times)</p>

<p># Measure memory
 tracemalloc.start()
 compute_fn(data)
 current, peak = tracemalloc.get_traced_memory()
 tracemalloc.stop()</p>

<p>memory_mb = peak / 1024 / 1024</p>

<p>self.feature_costs[feature_name] = {
 ‘time_ms’: avg_time,
 ‘memory_mb’: memory_mb,
 ‘cost_score’: avg_time * memory_mb # Simple cost metric
 }</p>

<p>return avg_time, memory_mb</p>

<p>def recommend_features(self, feature_importance, cost_threshold=100):
 “””
 Recommend features based on importance vs cost trade-off</p>

<p>Args:
 feature_importance: Dict {feature_name: importance_score}
 cost_threshold: Maximum acceptable cost</p>

<p>Returns:
 List of recommended features
 “””
 recommendations = []</p>

<p>for feature_name, importance in feature_importance.items():
 if feature_name not in self.feature_costs:
 continue</p>

<p>cost = self.feature_costs[feature_name][‘cost_score’]</p>

<p># Value/cost ratio
 value_ratio = importance / (cost + 1e-8)</p>

<p>if cost &lt;= cost_threshold:
 recommendations.append({
 ‘feature’: feature_name,
 ‘importance’: importance,
 ‘cost’: cost,
 ‘value_ratio’: value_ratio
 })</p>

<p># Sort by value ratio
 recommendations.sort(key=lambda x: x[‘value_ratio’], reverse=True)</p>

<p>return recommendations</p>

<h1 id="example-usage-1">Example usage</h1>
<p>analyzer = FeatureCostAnalyzer()</p>

<h1 id="measure-costs">Measure costs</h1>
<p>analyzer.measure_cost(‘simple_sum’, lambda df: df[‘col1’] + df[‘col2’], data)
analyzer.measure_cost(‘complex_agg’, lambda df: df.groupby(‘id’).agg({‘col’: [‘mean’, ‘std’, ‘max’]}), data)</p>

<h1 id="get-recommendations">Get recommendations</h1>
<p>feature_importance = {‘simple_sum’: 0.8, ‘complex_agg’: 0.3}
recommended = analyzer.recommend_features(feature_importance)
``</p>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>

<p>✅ <strong>Feature engineering is critical</strong> - Often more impactful than model choice 
✅ <strong>Feature stores solve consistency</strong> - Same code for training and serving 
✅ <strong>Domain knowledge matters</strong> - Best features come from understanding the problem 
✅ <strong>Monitor features in production</strong> - Detect drift and data quality issues 
✅ <strong>Version features</strong> - Track changes, enable rollback 
✅ <strong>Document everything</strong> - Features are long-lived assets 
✅ <strong>Like tree traversal</strong> - Hierarchical features need DFS/BFS logic</p>

<hr />

<p><strong>Originally published at:</strong> <a href="https://www.arunbaby.com/ml-system-design/0007-feature-engineering/">arunbaby.com/ml-system-design/0007-feature-engineering</a></p>

<p><em>If you found this helpful, consider sharing it with others who might benefit.</em></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#data-processing" class="page__taxonomy-item p-category" rel="tag">data-processing</a><span class="sep">, </span>
    
      <a href="/tags/#feature-engineering" class="page__taxonomy-item p-category" rel="tag">feature-engineering</a><span class="sep">, </span>
    
      <a href="/tags/#feature-store" class="page__taxonomy-item p-category" rel="tag">feature-store</a><span class="sep">, </span>
    
      <a href="/tags/#ml-pipeline" class="page__taxonomy-item p-category" rel="tag">ml-pipeline</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#ml-system-design" class="page__taxonomy-item p-category" rel="tag">ml-system-design</a>
    
    </span>
  </p>


        
      </footer>

      <div class="page__related page__related--full">
  <h2 class="page__related-title">Related across topics</h2>
  <style>
    /* Make section span full content width and use 2 equal columns */
    .page__related--full { float: inline-start; width: 100%; padding: 0; }
    .cross-related-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 2rem; }
    @media (max-width: 768px) { .cross-related-grid { grid-template-columns: 1fr; } }
    /* Ensure archive cards stretch nicely in the grid */
    .cross-related-grid .list__item, .cross-related-grid .grid__item { width: auto; float: none; margin: 0; }
  </style>
  <div class="cross-related-grid">
    



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/dsa/0007-binary-tree-traversal/" rel="permalink">Binary Tree Traversal
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          26 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Master the fundamental patterns of tree traversal: the gateway to solving hundreds of tree problems in interviews.
</p>
  </article>
</div>




<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/speech-tech/0007-audio-preprocessing/" rel="permalink">Audio Preprocessing &amp; Signal Processing
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          15 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Clean audio is the foundation of robust speech systems, master preprocessing pipelines that handle real-world noise and variability.
</p>
  </article>
</div>




<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ai-agents/0007-building-your-first-agent/" rel="permalink">Building Your First Agent
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">“Hello World? No, Hello Agent.”
</p>
  </article>
</div>

  </div>
</div>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://twitter.com/intent/tweet?via=arunbaby0&text=Feature+Engineering+at+Scale%20https%3A%2F%2Fwww.arunbaby.com%2Fml-system-design%2F0007-feature-engineering%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.arunbaby.com%2Fml-system-design%2F0007-feature-engineering%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.arunbaby.com/ml-system-design/0007-feature-engineering/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ml-system-design/0006-model-evaluation-metrics/" class="pagination--pager" title="Model Evaluation Metrics">Previous</a>
    
    
      <a href="/ml-system-design/0008-model-serving-architecture/" class="pagination--pager" title="Model Serving Architecture">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/arunbaby0" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/arunbaby0/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://scholar.google.co.in/citations?user=6fSYWhkAAAAJ" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 1990 - 2143 <a href="https://www.arunbaby.com">Arun Baby</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0JRJPEC9SS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0JRJPEC9SS', { 'anonymize_ip': false});
</script>








  </body>
</html>
